<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>MySQL on feileo</title>
    <link>https://at7h.com/tags/mysql/</link>
    <description>Recent content in MySQL on feileo</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Tue, 18 Aug 2020 00:00:00 +0000</lastBuildDate>
    
	<atom:link href="https://at7h.com/tags/mysql/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Helo å¿«é€Ÿä¸Šæ‰‹æŒ‡å—</title>
      <link>https://at7h.com/posts/helo/</link>
      <pubDate>Tue, 18 Aug 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/helo/</guid>
      <description>å…¶ä¸­ï¼Œu.update(name=&amp;quot;Daisy&amp;rdquo;) ä¸ u.name = &amp;ldquo;Daisy&amp;rdquo; ç±»ä¼¼ï¼Œéƒ½æ˜¯åªåœ¨å†…å­˜é‡Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œä¸åŒçš„æ˜¯ u.update() è¿˜ä¼šè¿”å›ä¸€ä¸ªåŒ…å«æœ¬æ¬¡å˜æ›´çš„ä¸­é—´ç»“æœï¼Œå¯¹å…¶æ‰§è¡Œ await xxx.apply() åˆ™ä¼šå°†è¿™äº›å˜æ›´åº”ç”¨åˆ°æ•°æ®åº“é‡Œã€‚ Helo æ˜¯æœ¬äººä¸šä½™å¼€å‘çš„ä¸€ä¸ªç®€å•å°å‹ä½çº§åˆ«çš„å¼‚æ­¥(asyncio) Python ORMã€‚å®ƒå‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ¦‚å¿µï¼Œéå¸¸ç›´ç™½ï¼Œå®¹æ˜“ä¸Šæ‰‹ä½¿ç”¨ã€‚ æ­¤å¤„å»å¾€é¡¹ç›®ä»“åº“ ï¼Œæ¬¢è¿ä½¿ç”¨ã€æå‡ºæ„è§æˆ–è´¡çŒ®ä»£ç  ğŸ˜Š Helo å¯ä»¥åœ¨ä½ çš„å¼‚æ­¥åº”ç”¨ä¸­å¸®åŠ©ä½ è½»æ¾çš„æ„å»ºå‡ºå¯Œæœ‰è¡¨è¾¾åŠ›çš„å¸¸ç”¨ SQL è¯­å¥ï¼Œä½ åªéœ€ä»¥å‹å¥½çš„å¯¹è±¡åŒ– API æ¥æ“ä½œæ•°æ®ï¼Œè€Œä¸ç”¨å…³å¿ƒ SQL è¯­å¥ç¼–å†™ã€æ•°æ®å¤„ç†ç­‰ç»†èŠ‚ã€‚ è¯·æ³¨æ„ï¼šä½¿ç”¨å¼‚æ­¥ ORM å¹¶ä¸å®Œå…¨æ„å‘³ç€å¯ä»¥ä½¿ä½ çš„åº”ç”¨å˜å¿«ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¼šä½¿ä½ çš„åº”ç”¨å˜å¾—å¤æ‚ã€‚ç»§ç»­ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆé˜…è¯»ä¸‹ SQLAlchemy ä½œè€… Mike Bayer çš„ è¿™ç¯‡åšå®¢æ–‡ç« ã€‚ æœ¬ç¯‡ä¸Šæ‰‹æŒ‡å—ä¸»è¦ä»‹ç»ä»¥ä¸‹æ–¹é¢: å®‰è£… helo æ¨¡å‹å£°æ˜ å»ºç«‹è¿æ¥ æ•°æ®æ“ä½œ åœ¨ quart åº”ç”¨ä¸­ä½¿ç”¨ helo å…¶ä»–è¡¥å…… å¼€å§‹ä½¿ç”¨ å®‰è£… helo å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼: 1. å®‰è£… pypi çš„ç¨³å®šå‘å¸ƒç‰ˆæœ¬, åœ¨ç»ˆç«¯ä¸­è¿è¡Œæ­¤å‘½ä»¤: $ pip install helo 2. ä»æœ€æ–°çš„æºç å®‰è£… $ git clone https://github.com/at7h/helo.git $ cd helo $ python setup.py install å®‰è£…å®Œæˆåå°±å¼€å§‹ä¸‹é¢çš„å…¥å‘ä¹‹æ—…äº† ğŸ˜ˆ ã€‚ ä½¿ç”¨ helo, é¦–å…ˆä½ éœ€è¦å¼•å…¥ helo å¹¶ä½¿ç”¨ helo.G å®ä¾‹åŒ–ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå‡å®šç§°å…¶ä¸º db: import helo db = helo.G() db æ˜¯ä¸€ä¸ªå…¨å±€å•ä¾‹å¯¹è±¡ï¼Œä¸‹é¢çš„ä»‹ç»ä¸­æˆ‘ä»¬å°†å¤šæ¬¡ä½¿ç”¨åˆ°å®ƒã€‚ æ¨¡å‹å£°æ˜ ä½¿ç”¨ helo å£°æ˜æ¨¡å‹å¾ˆç®€å•ï¼Œåªéœ€ä» helo.Model ç»§æ‰¿å³å¯ã€‚ä¸‹é¢ç»™å‡ºå‡ ä¸ªæ¨¡å‹å£°æ˜çš„ç®€å•çš„ä¾‹å­ï¼š class Person(helo.Model): id = helo.BigAuto() name = helo.VarChar(length=45, null=False) class User(Person): email = helo.Email(default=&amp;#39;&amp;#39;) password = helo.VarChar(length=100, null=False) create_at = helo.Timestamp(default=helo.ON_CREATE) class Meta: indexes = [helo.K(&amp;#39;idx_ep&amp;#39;, [&amp;#39;email&amp;#39;, &amp;#39;password&amp;#39;])] class Employee(Person): department = helo.Smallint() salary = helo.Float(default=0) class Post(helo.Model): id = helo.Auto(comment=&amp;#39;auto increment pk&amp;#39;) title = helo.VarChar(length=100) content = helo.Text(encoding=helo.ENCODING.UTF8MB4) author = helo.Int(default=0) create_at = helo.Timestamp(default=helo.ON_CREATE) update_at = helo.Timestamp(default=helo.ON_UPDATE) class Meta: indexes = [ helo.K(&amp;#39;idx_title&amp;#39;, &amp;#39;title&amp;#39;), helo.K(&amp;#39;idx_author&amp;#39;, &amp;#39;author&amp;#39;), ] å†…éƒ¨ç±» Meta å¯ç”¨äºæŒ‡å®š db_name, table_name, engine, indexes, charset, comment ç­‰ Table çš„å…ƒå±æ€§ã€‚ class Meta: db = &amp;#39;db_name&amp;#39; name = &amp;#39;table_name&amp;#39; engine = helo.ENGINE.innodb charset = helo.ENCODING.utf8mb4 indexes = [] comment = &amp;#39;table comment&amp;#39; å…¶ä¸­ table_name é»˜è®¤ä¸º model ç±»åçš„ snake_case é£æ ¼åç§°ï¼Œengine é»˜è®¤ä¸º InnoDBï¼Œcharset é»˜è®¤ä¸º utf8mb4ã€‚ å»ºç«‹è¿æ¥ å‰é¢çš„æ¨¡å‹å£°æ˜åªæ˜¯å®šä¹‰äº†æ¨¡å‹ä¸çœŸå®è¡¨ç»“æ„çš„æ˜ å°„å…³ç³»ï¼Œå¹¶éå®é™…åœ¨æ•°æ®åº“ä¸­åˆ›å»ºäº†è¿™äº›è¡¨ç»“æ„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨ helo æ¥ä¸æ•°æ®åº“å»ºç«‹è¿æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª MySQL çš„æ•°æ®åº“å®ä¾‹ï¼š &amp;gt;&amp;gt;&amp;gt; await db.bind(&amp;#39;mysql://user:pwd@localhost:3306/helo&amp;#39;) æˆ–è€…ä¼ é€’é…ç½®å‚æ•°ï¼š &amp;gt;&amp;gt;&amp;gt; await db.bind(user=&amp;#39;user&amp;#39;, password=&amp;#39;pwd&amp;#39;, db=&amp;#39;helo&amp;#39;) å¦‚æœä½ è®¾ç½®äº†ç¯å¢ƒå˜é‡ HELO_DATABASE_URLï¼Œé‚£ä¹ˆä½ ä¸ç”¨å†ä¼ é€’ url: &amp;gt;&amp;gt;&amp;gt; await db.bind() å¦‚æœä½ æƒ³è‡ªå®šä¹‰ KEY çš„å€¼ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ– db æ—¶é€šè¿‡ env_key å‚æ•°æ¥è®¾ç½®: db = helo.G(env_key=&amp;quot;YOUR_ENV_KEY&amp;quot;) bind å®é™…ä¸Šä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼š &amp;gt;&amp;gt;&amp;gt; db.state {&amp;#39;minsize&amp;#39;: 1, &amp;#39;maxsize&amp;#39;: 15, &amp;#39;size&amp;#39;: 1, &amp;#39;freesize&amp;#39;: 1} bind ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå…³é”®å­—å‚æ•°æ¥å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰è®¾ç½®ï¼Œè¯¦è§ helo.db.Pool ç±»ã€‚ä¾‹å¦‚ï¼š &amp;gt;&amp;gt;&amp;gt; await db.bind(&amp;#39;mysql://user:pwd@127.0.0.1:3306/db&amp;#39;, maxsize=10, connect_timeout=15) å·²ç»åˆ›å»ºçš„è¿æ¥æ± å¯¹è±¡å°†æ˜¯ä¸€ä¸ªå…¨å±€çš„å•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ å·²ç»ä¸ºä½ çš„åº”ç”¨ç¨‹åºè°ƒç”¨ bind ç»‘å®šäº†æ•°æ®åº“ï¼Œåœ¨æ­¤ä¹‹å‰å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ unbind è¿›è¡Œè§£ç»‘ï¼Œä½ å°†ä¸èƒ½å†ç»§ç»­ä½¿ç”¨ bind å†æ¬¡ç»‘å®šå¦ä¸€ä¸ªæ•°æ®åº“ï¼Œå¦åˆ™ä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ª helo.err.DuplicateBinding é”™è¯¯ã€‚ å¦‚æœä½ éœ€è¦æ˜¾å¼åœ°æ–­å¼€ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œå…³é—­è¿æ¥æ± ï¼Œå¯ä»¥ä½¿ç”¨ unbind: &amp;gt;&amp;gt;&amp;gt; await db.unbind() åœ¨å°å‹çš„è„šæœ¬ä¸­ä½ å¯ä»¥ä½¿ç”¨ db.binder æ¥è‡ªåŠ¨å¤„ç†ä¸Šä¸‹æ–‡ï¼š &amp;gt;&amp;gt;&amp;gt; async with db.binder(): ... pass æ•°æ®æ“ä½œ ä¸æ•°æ®åº“å»ºç«‹äº†è¿æ¥ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®åº“åˆ›å»ºæˆ‘ä»¬çš„è¡¨ï¼Œä»¥ä¾¿äºæ¥ä¸‹æ¥è¿›è¡Œæ•°æ®çš„æ“ä½œã€‚ åœ¨çœŸæ­£çš„åº”ç”¨ä¸­ï¼Œæ•°æ®åº“è¡¨çš„è®¾è®¡åˆ›å»ºä¸ç»´æŠ¤æ˜¯å•ç‹¬åˆ†å¼€ï¼Œä¸€èˆ¬ç”±ä¸“é—¨çš„ DBA æ¥ç®¡ç†ã€‚å½“ç„¶ helo ä¹Ÿæä¾›äº†åŸºç¡€çš„ DDL æ”¯æŒã€‚ ä¸‹é¢æˆ‘ä»¬åœ¨æ•°æ®åº“åˆ›å»ºå®ƒä»¬ï¼š &amp;gt;&amp;gt;&amp;gt; await db.create_tables([User, Employee, Post]) åœ¨åº”ç”¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†æ‰€æœ‰çš„æ¨¡å‹å£°æ˜å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œåœ¨æ­¤å‡è®¾æ¨¡å—åä¸º modelsï¼Œåˆ™å¯ä»¥ä½¿ç”¨ create_all ä¸ºæ¨¡å—ä¸­æ‰€æœ‰çš„ model åˆ›å»ºè¡¨ï¼š &amp;gt;&amp;gt;&amp;gt; from your.application import models &amp;gt;&amp;gt;&amp;gt; await db.create_all(models) å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Model çš„æ–¹æ³•æ¥å•ç‹¬åˆ›å»º: &amp;gt;&amp;gt;&amp;gt; await User.create() Helo æä¾›äº†åŸºæœ¬çš„æ“ä½œæ•°æ®åº“ä¸­æ•°æ®çš„èƒ½åŠ›ï¼Œæ”¯æŒä¸°å¯Œçš„å¯ç»„åˆçš„é€»è¾‘è¿ç®—è¡¨è¾¾ï¼Œä½ å¯ä»¥è½»æ¾çš„å®Œæˆå¯Œæœ‰è¡¨è¾¾åŠ›çš„ queriesï¼Œä»¥å®ç°é€šè¿‡å¯¹è±¡åŒ–çš„ API æ¥æ„å»ºä½ æƒ³è¦çš„ SQL è¯­å¥(DML å’Œ DQL)çš„èƒ½åŠ›ã€‚ ä¸‹é¢ç¤ºä¾‹åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥çš„æ“ä½œã€‚ å¢ ä½¿ç”¨ helo ä½ å¯ä»¥æœ‰å¤šç§æ’å…¥æ•°æ®çš„æ–¹å¼é€‰æ‹©ï¼Œæˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ª User å¯¹è±¡å¼€å§‹: user = User(name=&amp;#39;at7h&amp;#39;, password=&amp;#39;1111&amp;#39;) print(user.name, user.password) # at7h, 1111 # Now user.id is None, because it is not saved to the database assert user.id is None æ­¤æ—¶çš„ user ä»…æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½ éœ€è¦é€šè¿‡ save æ–¹æ³•æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼š user_id = await user.save() assert user_id == user.id == 1 æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒï¼Œå¹¶ä¿å­˜æ›´æ”¹ï¼š user.name = &amp;#39;at8h&amp;#39; user.email = &amp;#39;g@at7h.com&amp;#39; user_id = await user.save() assert user_id == user.id == 1 è¯·æ³¨æ„ï¼š ç›®å‰ save æ“ä½œæ˜¯é€šè¿‡ MySQL REPLACE è¯­å¥å®ç°ï¼Œå…¶æ ¹æ®å¯¹è±¡çš„ PRIMARY KEY å±æ€§æˆ– UNIQUE KEY å±æ€§çš„å€¼æ¥å†³å®šæ˜¯å¦æ’å…¥æ–°è¡Œï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼è¯¥å®ç°è®¡åˆ’åœ¨åç»­ç‰ˆæœ¬ä¸­ä¼˜åŒ–ã€‚ æ¨èä½¿ç”¨ä¸‹é¢å‡ ç§æ–¹å¼æ¥æ’å…¥æ•°æ®ã€‚ æ–¹æ³• add, madd å¯ä»¥ç”¨æ¥æ·»åŠ å•æ¡æˆ–å¤šæ¡æ•°æ®ï¼Œå®ƒä»¬æ˜¯ insert, minsert çš„ç®€å•å¿«æ·æ–¹å¼ï¼š user_id = await User.add(name=&amp;#39;bobo&amp;#39;, password=&amp;#39;2222&amp;#39;) # Or: user_id = await User.add({&amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;2222&amp;#39;}) print(user_id) # 2 users = [{&amp;#39;name&amp;#39;: &amp;#39;mingz&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;3333&amp;#39;}, {&amp;#39;name&amp;#39;: &amp;#39;xy69z&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;4444&amp;#39;}] # Or using user object list: # users = [User(name=&amp;#39;mingz&amp;#39;, password=&amp;#39;3333&amp;#39;), # User(name=&amp;#39;xy69z&amp;#39;, password=&amp;#39;4444&amp;#39;)] count = await User.madd(users) print(count) # 2 æ–¹æ³• insert å’Œ minsert æ˜¯æœ€æ­£ç¡®çš„æ•°æ®æ’å…¥å§¿åŠ¿ï¼Œå®ƒä»¬å¯ä»¥èƒœä»»å¤šç§æ•°æ®å½¢å¼ï¼Œå®ƒä»¬å°†è¿”å›ä¸€ä¸ª Insert å¯¹è±¡ï¼Œè¦æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·ä¸è¦å¿˜äº†å†™ do() å“¦ ğŸ˜‰ï¼š ret = await User.insert(name=&amp;#39;poper&amp;#39;, password=&amp;#39;5555&amp;#39;).do() # Or: ret = await User.insert({&amp;#39;name&amp;#39;: &amp;#39;bingo&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;8888&amp;#39;}).do() assert ret.affected == 1 assert ret.last_id == 5 print(ret) # (1, 5) # Inserting multiple employees = [ {&amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;, &amp;#39;department&amp;#39;: 1}, {&amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;, &amp;#39;department&amp;#39;: 2}, ] ret = await Employee.minsert(employees).do() print(ret) # (2, 1) # Specify row tuples columns the tuple values correspond to posts = [ (&amp;#39;post1&amp;#39;, 1), (&amp;#39;post2&amp;#39;, 2), ] ret = await Post.minsert( posts, columns=[Post.title, Post.author] ).do() print(ret) # (2, 1) ä½¿ç”¨ insert_from æ”¯æŒè¡¨é—´æ•°æ®å¡«å……ï¼š select = User.select(User.name).where(User.id.in_([3, 4, 5])) ret = await Employee.insert_from(select, [Employee.name]).do() print(ret) # (3, 3) æŸ¥ Helo ä¹Ÿæœ‰å¤šç§è·å–æ•°æ®çš„æ–¹å¼é€‰æ‹©ï¼Œå¦‚ç®€å•è·å–å•æ¡æ•°æ®å¯ä»¥ä½¿ç”¨ get æ–¹æ³•ï¼š # By id user = await User.get(1) assert isinstance(user, User) print(user.id, user.name, user.password) # 1, at7h, 1111 # Or by query assert (await User.get(User.name == user.name)) == user è·å–å¤šæ¡æ•°æ®å¯ä»¥ä½¿ç”¨ mget æ–¹æ³•ï¼š # By id list uid_list = [1, 2, 3] users = await User.mget(uid_list) print(users.count) # 3 print(users) # [&amp;lt;User object at 1&amp;gt;, &amp;lt;User object at 2&amp;gt;, &amp;lt;User object at 3&amp;gt;] # Specify columns users = await User.mget(uid_list, columns=[User.id, User.name]) assert users[0].password is None # Or by query users = await User.mget((User.id &amp;lt; 2) | (User.name == &amp;#39;mingz&amp;#39;)) print(users) # [&amp;lt;User object at 1&amp;gt;, &amp;lt;User object at 3&amp;gt;] åŒæ ·çš„ï¼Œæ–¹æ³• get å’Œ mget ä¹Ÿæ˜¯ select çš„ç®€å•å¿«æ·ç‰ˆæœ¬ï¼Œå…¶åªé€‚åˆäºå·²çŸ¥ä¸»é”®æˆ–æŸ¥è¯¢æ¡ä»¶æ¯”è¾ƒç®€å•çš„åœºæ™¯ï¼Œæ›´å¤šçš„æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨ selectã€‚ ä½¿ç”¨ select æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ ä»¥å¯¹è±¡åŒ– API çš„æ–¹å¼è½»æ¾çš„æ„é€ ä½ çš„ DQLï¼Œå…¶æ”¯æŒä¸°å¯Œçš„å¯ç»„åˆçš„é€»è¾‘æ¡ä»¶è¡¨è¾¾å¼ã€‚ users = await User.select().order_by( User.id.desc() ).limit(3).offset(2).all() print(users) # [&amp;lt;User object at 5&amp;gt;, &amp;lt;User object at 4&amp;gt;, &amp;lt;User object at 3&amp;gt;] æ–¹æ³• all() ä»¥åŠä¸‹é¢æåˆ°çš„ get(), first(), rows(), paginate() ç­‰æ–¹æ³•ç±»ä¼¼äºä¸Šé¢æåˆ°çš„ do()ï¼Œéƒ½ç”¨äºé©±åŠ¨æ‰§è¡Œæ­¤æ¬¡æŸ¥è¯¢ï¼Œä¸è¦å¿˜äº†å“¦ã€‚ æ¯”å¦‚æˆ‘éœ€è¦çŸ¥é“æœ‰æ²¡æœ‰ä½¿ç”¨ gmail é‚®ç®±çš„ç”¨æˆ·ï¼š is_exist = await User.select().where( User.email.endswith(&amp;#39;gmail.com&amp;#39;) ).exist() print(is_exist) # False æ¯”å¦‚æˆ‘æƒ³çŸ¥é“ 2019 å¹´ 7 æœˆä»¥æ¥å…±æ–°å¢äº†å¤šå°‘ç”¨æˆ·ï¼š user_count = await User.select().where( User.create_at &amp;gt; datetime(2019, 7, 1) ).count() print(user_count) # 4 å†æ¯”å¦‚æˆ‘ä»¬éœ€è¦åˆ†é¡µçš„è·å–ä»Šå¹´å†™äº† Python(title) ç›¸å…³æ–‡ç« çš„ç”¨æˆ·ï¼š users = await User.select().where( User.id.in_( Post.select(Post.author).where( Post.update_at &amp;gt; datetime(2019, 1, 1), Post.title.contains(&amp;#39;Python&amp;#39;) ).order_by( Post.update_at.desc() ) ) ).paginate(1, 10) print(users) # [&amp;lt;User object at 1&amp;gt;] å†æ¯”å¦‚æˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªç”¨æˆ·éƒ½å†™äº†å¤šå°‘ç¯‡æ–‡ç« ï¼š user_posts = await User.select( User.name, helo.F.COUNT(helo.SQL(&amp;#39;1&amp;#39;)).as_(&amp;#39;posts&amp;#39;) ).join( Post, helo.JOINTYPE.LEFT, on=(User.id == Post.author) ).group_by( User.name ).rows(100) print(user_posts) # [{&amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;, &amp;#39;posts&amp;#39;: 1}] å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ helo.F æ¥ä½¿ç”¨ SQL å‡½æ•°ï¼Œæ¯”å¦‚æˆ‘éœ€è¦è®¡ç®—å‡ºæ¯ä¸ªæœˆæ‰€æœ‰é›‡å‘˜è–ªèµ„çš„æ€»å’Œï¼š salary_sum = await Employee.select( helo.F.SUM(Employee.salary).as_(&amp;#39;salary_sum&amp;#39;) ).scalar() print(salary_sum) # 30000.0 æ”¹ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å°è¯•å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®åšä¸€äº›ä¿®æ”¹æ“ä½œã€‚ æ¯”å¦‚ä½ è¦æ›´æ”¹æŸä¸€ä½é›‡å‘˜çš„è–ªèµ„ ğŸ˜‹ï¼š ret = await Employee.update(salary=20000).where( Employee.name == &amp;#39;at7h&amp;#39; ).do() print(ret.affected) # 1 æˆ–è€…ï¼Œæ•´ä½“æ¶¨å·¥èµ„å•¦ ğŸ‘ï¼š ret = await Employee.update( salary=Employee.salary + 1000 ).where( (Employee.department.in_([1, 2])) | (Employee.name == &amp;#39;at7h&amp;#39;) ).do() åˆ  æœ€åæˆ‘ä»¬æ¥å°è¯•åˆ é™¤è¡¨ä¸­çš„æ•°æ®ã€‚ ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ model å¯¹è±¡çš„ remove æ–¹æ³•æ¥åˆ é™¤å®ƒå¯¹åº”äºæ•°æ®åº“ä¸­è¿™ä¸€è¡Œçš„æ•°æ®ï¼š user = User(name=&amp;#39;at7h&amp;#39;, password=&amp;#39;1111&amp;#39;) await user.save() user = await User.get(user_id) print(user.id) # 1 await user.remove() user = await User.get(user_id) print(user) # None å¦ä¸€ç§æ›´ä¸ºé€šå¸¸çš„æ–¹å¼æ˜¯ä½¿ç”¨ delete æ–¹æ³•ï¼š ret = await Post.delete().where( Post.create_at &amp;lt; datetime(2010, 1, 1) ).limit( 100 ).do() è¯·æ³¨æ„ï¼š æ°¸è¿œä¸è¦å¿˜è®°å†™ where å­å¥ï¼Œæ˜¯ä¸æ˜¯æ•´ä¸ªè¡¨éƒ½ä¸æƒ³è¦äº† ğŸ˜Ÿ ï¼Ÿ Replace å¦å¤–ï¼Œhelo æ”¯æŒ MySQL REPLACE è¯­å¥ï¼Œæä¾›äº† replace å’Œ mreplace ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ç”¨æ³•ä¸ insert å’Œ minsert ç±»ä¼¼ã€‚å½“ç„¶ï¼Œåœ¨ä½¿ç”¨å®ƒä»¬ä¹‹å‰ä½ éœ€è¦äº†è§£ MySQL REPLACE è¯­å¥çš„å·¥ä½œåŸç†ã€‚ Quart åº”ç”¨ å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ quart, ä¸€ä¸ªæœ€å°çš„åº”ç”¨ç¤ºä¾‹æ˜¯: import quart import helo app = quart.Quart(__name__) app.config[&amp;#34;HELO_DATABASE_URL&amp;#34;] = &amp;#34;mysql://user:password@127.0.0.1:3306/db&amp;#34; db = helo.G(app) @app.route(&amp;#39;/api/users&amp;#39;) async def users(): await User.insert( name=&amp;#39;at7h&amp;#39;, email=&amp;#39;g@test.com&amp;#39;, password=&amp;#39;xxxx&amp;#39; ).do() user_list = await User.select().all(False) return quart.jsonify(user_list) app.run() æ­¤æ—¶ä½ ä¸éœ€è¦å†æ˜¾ç¤ºçš„æ‰§è¡Œ db.bindï¼Œbinding æ“ä½œå°†ä¼šåœ¨ä½ åº”ç”¨çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰è‡ªåŠ¨å®Œæˆã€‚ å¯åŠ¨æ­¤æœåŠ¡: $ curl http://127.0.0.1:5000/api/users [{&amp;#34;email&amp;#34;:&amp;#34;g@test.com&amp;#34;,&amp;#34;id&amp;#34;:1,&amp;#34;name&amp;#34;:&amp;#34;at7h&amp;#34;,&amp;#34;password&amp;#34;:&amp;#34;xxxx&amp;#34;}] å…¶ä»– Model Iteration Helo ä¸­çš„ Model å’Œ Select éƒ½æ”¯æŒè¿­ä»£ï¼Œhelo ä¼šè‡ªåŠ¨å¸®ä½ å¤„ç†åˆ†é¡µé—®é¢˜ï¼Œä»¥é¿å…é¢‘ç¹çš„ IO æ“ä½œå’Œè¿‡å¤§çš„æ•°æ®é‡è·å–ã€‚ async for post in Post: print(post) # &amp;lt;Post object at 1&amp;gt; # &amp;lt;Post object at 2&amp;gt; # &amp;lt;Post object at 3&amp;gt; # &amp;lt;Post object at 4&amp;gt; users = User.select().where(User.id &amp;lt; 5).order_by(User.id.desc()) async for user in users: print(user) # &amp;lt;User object at 4&amp;gt; # &amp;lt;User object at 3&amp;gt; # &amp;lt;User object at 2&amp;gt; # &amp;lt;User object at 1&amp;gt; Row Type å½“ä½ ä½¿ç”¨ select è·å–æ•°æ®æ—¶ï¼Œhelo é»˜è®¤ä¼šå°†è¡Œæ•°æ®åŒ…è£…æˆä¸ºå¯¹åº”çš„ Model å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œå½“ä½ ä½¿ç”¨äº† helo.F å‡½æ•°å’Œ join æ—¶å¯èƒ½ä¼šæ”¾å¼ƒåŠ è½½åˆ° Model å¯¹è±¡è€Œä½¿ç”¨åŸå§‹çš„ helo.adict å­—å…¸ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ wrap å‚æ•°æ¥æ˜¾å¼æŒ‡å®šä½¿ç”¨å­—å…¸ç±»å‹çš„ row typeã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™å¯èƒ½ä¼šæ˜¾è‘—æé«˜é€Ÿåº¦å¹¶å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚ users = await User.select(User.id, User.name).limit(2).all(wrap=False) print(users) # [{&amp;#39;id&amp;#39;: 1, &amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;}, {&amp;#39;id&amp;#39;: 2, &amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;}] assert users[0].name == &amp;#39;at7h&amp;#39; employee = await Employee.select().order_by( Employee.salary.desc() ).first(False) print(employee) # {&amp;#39;id&amp;#39;: 1, &amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;, &amp;#39;department&amp;#39;: 1, &amp;#39;salary&amp;#39;: 15000.0} SQL æ‰§è¡Œ SQL æœ‰æ—¶ä½ å¯èƒ½è¿«ä¸å¾—å·²æƒ³è¦æ‰§è¡Œä¸€äº›åŸå§‹çš„ SQL è¯­å¥ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ db.raw å‡½æ•°æ¥å®ç°ã€‚ await db.raw(&amp;#34;SELECT * FROM `user` WHERE `id` &amp;lt; %s;&amp;#34;, params=[10]) æŸ¥çœ‹ SQL ä¸ºæ–¹ä¾¿è°ƒè¯•ï¼Œæœ‰æ—¶å€™éœ€è¦æŸ¥çœ‹æ‰§è¡Œçš„ SQLï¼Œåœ¨ helo ä¸­ï¼Œä½ å¯ä»¥: ç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨åˆå§‹åŒ– db æ—¶ï¼Œè®¾ç½® debug ä¸º True å³å¯ï¼Œè¿™æ ·ä½ å°†åœ¨æ—¥å¿—è¾“å‡ºä¸­çœ‹åˆ°æ‰§è¡Œè¿‡çš„æ‰€æœ‰ SQL è¯­å¥ã€‚ db = helo.G(debug=True) ç¬¬äºŒç§æ–¹å¼ä¸»è¦æ˜¯æ–¹ä¾¿å­¦ä¹ å’Œè°ƒè¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨ repr å‡½æ•°(æˆ–åœ¨ REPR ç¯å¢ƒä¸­)å’Œ str å‡½æ•°æ¥æŸ¥çœ‹ Insert, Update, Select ç­‰å¯¹è±¡ï¼Œæˆ‘ä»¬æ‹¿ä¸Šé¢çš„ç¤ºä¾‹æ¥ä¸¾ä¸ªä¾‹å­ï¼š &amp;gt;&amp;gt;&amp;gt; q1 = Employee.update( ... salary=Employee.salary + 1000 ... ).where( ... (Employee.department.in_([1, 2])) | (Employee.name == &amp;#39;at7h&amp;#39;) ... ) &amp;gt;&amp;gt;&amp;gt; q1 Query(UPDATE `employee` SET `salary` = (`salary` + %s) WHERE ((`department` IN %s) OR (`name` = %s)); % ((1000.0,), (1, 2), &amp;#39;at7h&amp;#39;)) &amp;gt;&amp;gt;&amp;gt; q2 = User.select( ... User.name, helo.F.COUNT(helo.SQL(&amp;#39;1&amp;#39;)).as_(&amp;#39;posts&amp;#39;) ... ).join( ... Post, helo.JOINTYPE.LEFT, on=(User.id == Post.author) ... ).group_by( ... User.name ... ) &amp;gt;&amp;gt;&amp;gt; print(q2) SELECT `t1`.`name`, COUNT(1) AS `posts` FROM `user` AS `t1` LEFT JOIN `post` AS `t2` ON (`t1`.`id` = `t2`.`author`) GROUP BY `t1`.`name`; % () æœ¬ç¯‡ä¸Šæ‰‹æŒ‡å—å°±åˆ°æ­¤ç»“æŸã€‚ ååˆ†æ¬¢è¿å¤§å®¶çš„ä½¿ç”¨ï¼Œæœ‰ä»»ä½•é—®é¢˜å¯éšæ—¶ä¸æˆ‘äº¤æµæˆ–åˆ° é¡¹ç›®ä»“åº“ åé¦ˆï¼Œæ¬¢è¿ä»¥ä»»ä½•å½¢å¼æå‡ºä»»ä½•é—®é¢˜æˆ–å»ºè®®ã€‚ æ„Ÿè°¢ ğŸ¤</description>
    </item>
    
  </channel>
</rss>