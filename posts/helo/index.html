<!DOCTYPE html>
<html class="no-js" lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="baidu-site-verification" content="0iFDP8mhHL" />
	<title>
		
			
				Helo å¿«é€Ÿä¸Šæ‰‹æŒ‡å— -
			
			feileo
		 çš„åšå®¢
	</title>
	<script>
		(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");
	</script>
	<meta name="description" content="Helo æ˜¯æœ¬äººä¸šä½™å¼€å‘çš„ä¸€ä¸ªç®€å•å°å‹ä½çº§åˆ«å¼‚æ­¥(asyncio) Python ORMï¼Œå¯ä»¥åœ¨ä½ çš„å¼‚æ­¥åº”ç”¨ä¸­å¸®åŠ©ä½ è½»æ¾çš„æ„å»ºå‡ºå¯Œæœ‰è¡¨è¾¾åŠ›çš„å¸¸ç”¨ SQL è¯­å¥ï¼Œä½ åªéœ€é€šè¿‡å‹å¥½çš„å¯¹è±¡åŒ– API æ¥æ“ä½œä½ çš„æ•°æ®å³å¯ï¼Œè€Œä¸ç”¨...">
	
		<meta property="og:title" content="Helo å¿«é€Ÿä¸Šæ‰‹æŒ‡å—" />
<meta property="og:description" content="Helo æ˜¯æœ¬äººä¸šä½™å¼€å‘çš„ä¸€ä¸ªç®€å•å°å‹ä½çº§åˆ«å¼‚æ­¥(asyncio) Python ORMï¼Œå¯ä»¥åœ¨ä½ çš„å¼‚æ­¥åº”ç”¨ä¸­å¸®åŠ©ä½ è½»æ¾çš„æ„å»ºå‡ºå¯Œæœ‰è¡¨è¾¾åŠ›çš„å¸¸ç”¨ SQL è¯­å¥ï¼Œä½ åªéœ€é€šè¿‡å‹å¥½çš„å¯¹è±¡åŒ– API æ¥æ“ä½œä½ çš„æ•°æ®å³å¯ï¼Œè€Œä¸ç”¨..." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://at7h.com/posts/helo/" />
<meta property="article:published_time" content="2020-08-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-18T00:00:00+00:00" />

	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/img/favicon.ico">
	
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-155215466-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	<link rel="stylesheet" href="/highlight/styles/atom-one-dark.css">

	<script src="/js/jquery.min.js"></script>
	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	<script src="/highlight/highlight.pack.js" type='text/javascript'></script>
	
	<script type="text/javascript">
	$(document).ready(function(){
    hljs.initHighlightingOnLoad();
		
	});

	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
  	})();
	</script>
</head>

<body class="body">
	<div class="container container--outer">
		<header class="header">
    <div class="container">
        <div class="logo">
            <a class="logo__link" href="/" title="feileo" rel="home">
              <div class="logo__title">
								feileo  
							</div>
							
							<div class="logo__tagline">å…³æ³¨äº’è”ç½‘å¼€å‘æŠ€æœ¯ï¼Œè®°å½•ã€æ€»ç»“ä¸åˆ†äº« ğŸ‘£</div>
							
						</a>
						
        </div>
        

<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1"><svg t="1571404030009" class="meta__icon icon icon-list" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1829" width="20" height="20"><path d="M892.928 128q28.672 0 48.64 19.968t19.968 48.64l0 52.224q0 28.672-19.968 48.64t-48.64 19.968l-759.808 0q-28.672 0-48.64-19.968t-19.968-48.64l0-52.224q0-28.672 19.968-48.64t48.64-19.968l759.808 0zM892.928 448.512q28.672 0 48.64 19.968t19.968 48.64l0 52.224q0 28.672-19.968 48.64t-48.64 19.968l-759.808 0q-28.672 0-48.64-19.968t-19.968-48.64l0-52.224q0-28.672 19.968-48.64t48.64-19.968l759.808 0zM892.928 769.024q28.672 0 48.64 19.968t19.968 48.64l0 52.224q0 28.672-19.968 48.64t-48.64 19.968l-759.808 0q-28.672 0-48.64-19.968t-19.968-48.64l0-52.224q0-28.672 19.968-48.64t48.64-19.968l759.808 0z" p-id="1830" fill="#1e90ff"></path></svg></span>
	</button>
	<mul class="menu__list">
		
		<li class="menu__item">
			<a class="menu__link__home" href="/"><svg t="1571149675735" class="meta__icon icon icon-home" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3856" width="22" height="22"><path d="M230.4 992c-64 0-115.2-51.2-115.2-115.2L115.2 544 76.8 582.4C70.4 588.8 57.6 595.2 44.8 595.2c-12.8 0-25.6-6.4-32-12.8C6.4 569.6 0 556.8 0 544 0 537.6 6.4 524.8 12.8 512l467.2-467.2C486.4 38.4 499.2 32 512 32s25.6 6.4 32 12.8L1011.2 512C1017.6 524.8 1024 537.6 1024 544c0 12.8-6.4 25.6-12.8 32-6.4 6.4-19.2 12.8-32 12.8s-25.6-6.4-32-12.8L512 147.2 211.2 448l0 422.4c0 12.8 12.8 25.6 25.6 25.6l115.2 0 0-185.6c0-25.6 19.2-44.8 44.8-44.8l230.4 0c25.6 0 44.8 19.2 44.8 44.8s-19.2 44.8-44.8 44.8L441.6 755.2l0 185.6c0 25.6-19.2 44.8-44.8 44.8L230.4 985.6zM627.2 992c-25.6 0-44.8-19.2-44.8-44.8 0-25.6 19.2-44.8 44.8-44.8l160 0c12.8 0 25.6-12.8 25.6-25.6l0-256c0-25.6 19.2-44.8 44.8-44.8 25.6 0 44.8 19.2 44.8 44.8l0 256c0 64-51.2 115.2-115.2 115.2L627.2 992z" p-id="3857" fill="#ffffff"></path></svg></a>
		</li>
		
		
		
		<li class="menu__item">
			<a class="menu__link"
				href="/categories/python">Python</a>
		</li>
		
		
		
		<li class="menu__item">
			<a class="menu__link"
				href="/categories/golang">Golang</a>
		</li>
		
		
		
		
		
		
		
		<li class="menu__item">
			<a class="menu__link"
				href="/categories/vim">Vim</a>
		</li>
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		<li class="menu__item">
			<a class="menu__link" href="/categories/tool">æ•ˆç‡å·¥å…·</a>
			
		</li>
		
		
		
		
		
	</mul>
</nav>

    </div>
</header>



		<div class="wrapper flex">
			<div class="primary">
			

<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<div class="post__title">Helo å¿«é€Ÿä¸Šæ‰‹æŒ‡å—</div>
			<div class="post__meta meta">
					
<div class="meta__item-categories meta__item">
	<svg t="1571148699121" class="meta__icon icon icon-category" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5705" width="16" height="16"><path d="M853.333333 938.666667 42.666667 938.666667c-25.6 0-42.666667-17.066667-42.666667-42.666667L0 128c0-25.6 17.066667-42.666667 42.666667-42.666667l298.666667 0c25.6 0 42.666667 17.066667 42.666667 42.666667l0 42.666667 469.333333 0c25.6 0 42.666667 17.066667 42.666667 42.666667l0 170.666667c0 25.6-17.066667 42.666667-42.666667 42.666667s-42.666667-17.066667-42.666667-42.666667L810.666667 256 341.333333 256C315.733333 256 298.666667 238.933333 298.666667 213.333333L298.666667 170.666667 85.333333 170.666667l0 682.666667 768 0c25.6 0 42.666667 17.066667 42.666667 42.666667S878.933333 938.666667 853.333333 938.666667z" p-id="5706" fill="#515151"></path><path d="M853.333333 938.666667 42.666667 938.666667c-12.8 0-25.6-4.266667-34.133333-17.066667S0 900.266667 0 887.466667l128-512C132.266667 354.133333 149.333333 341.333333 170.666667 341.333333l810.666667 0c12.8 0 25.6 4.266667 34.133333 17.066667S1024 379.733333 1024 392.533333l-128 512C891.733333 925.866667 874.666667 938.666667 853.333333 938.666667zM98.133333 853.333333l721.066667 0 106.666667-426.666667L204.8 426.666667 98.133333 853.333333z" p-id="5707" fill="#515151"></path></svg>
	<span class="meta__text">
		
		<a class="meta__link" href="/categories/python" rel="category">
			
			Python
			
		</a>
		
	</span>
</div>

<div class="meta__item-datetime meta__item">
	<svg t="1571148896140" class="meta__icon icon icon-date" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8190" width="16" height="16"><path d="M883.278513 148.539035l-43.016723 0 0-12.780071c0-38.310537-31.199583-69.632917-69.323878-69.632917l-1.02433 0c-38.129412 0-69.323878 31.321356-69.323878 69.632917l0 12.780071L317.20292 148.539035l0-12.780071c0-38.310537-31.195489-69.632917-69.323878-69.632917l-1.055029 0c-38.127366 0-69.322855 31.321356-69.322855 69.632917l0 12.780071-42.924625 0c-38.127366 0-69.323878 31.351032-69.323878 69.609381l0 665.701614c0 38.309514 31.195489 69.632917 69.323878 69.632917l748.70198 0c38.127366 0 69.322855-31.323403 69.322855-69.632917l0-665.701614C952.601368 179.890067 921.405879 148.539035 883.278513 148.539035L883.278513 148.539035zM728.318232 135.758963c0-23.024389 18.632359-41.777499 41.594327-41.777499l1.02433 0c22.931269 0 41.593304 18.753109 41.593304 41.777499L812.530193 259.615852c0 23.024389-18.662035 41.778522-41.593304 41.778522l-1.02433 0c-22.961968 0-41.594327-18.754133-41.594327-41.778522L728.318232 135.758963 728.318232 135.758963zM205.23071 135.758963c0-23.024389 18.632359-41.777499 41.599444-41.777499l1.048889 0c22.903639 0 41.594327 18.753109 41.594327 41.777499L289.473369 259.615852c0 23.024389-18.691711 41.778522-41.594327 41.778522l-1.048889 0c-22.967084 0-41.599444-18.754133-41.599444-41.778522L205.23071 135.758963 205.23071 135.758963zM883.278513 897.807926l-748.70198 0c-7.519254 0-13.864776-6.468318-13.864776-13.957897L120.711757 394.394489l776.433578 0 0 489.455541C897.144312 891.338584 890.797767 897.807926 883.278513 897.807926L883.278513 897.807926zM222.614635 494.083955l127.918391 0 0 62.950727L222.614635 557.034682 222.614635 494.083955 222.614635 494.083955zM445.963493 494.083955l126.906342 0 0 62.950727L445.963493 557.034682 445.963493 494.083955 445.963493 494.083955zM668.299277 494.083955l124.873032 0 0 62.950727L668.299277 557.034682 668.299277 494.083955 668.299277 494.083955zM222.614635 622.00951l127.918391 0 0 61.927421L222.614635 683.936931 222.614635 622.00951 222.614635 622.00951zM445.963493 622.00951l126.906342 0 0 61.927421L445.963493 683.936931 445.963493 622.00951 445.963493 622.00951zM668.299277 622.00951l124.873032 0 0 61.927421L668.299277 683.936931 668.299277 622.00951 668.299277 622.00951zM222.614635 746.884588l127.918391 0 0 64.97278L222.614635 811.857369 222.614635 746.884588 222.614635 746.884588zM445.963493 746.884588l126.906342 0 0 64.97278L445.963493 811.857369 445.963493 746.884588 445.963493 746.884588zM668.299277 746.884588l124.873032 0 0 64.97278L668.299277 811.857369 668.299277 746.884588 668.299277 746.884588zM668.299277 746.884588" p-id="8191" fill="#515151"></path></svg>
	æ›´æ–°äº <time class="meta__text" datetime="2020-08-18T00:00:00">2020-08-18</time>
</div>

<div class="meta__item-word_count meta__item">
	<svg t="1571149110363" class="meta__icon icon icon-wordcount" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1792" width="16" height="16"><path d="M286.722048 405.987328l0 477.058048-132.51584 0L154.206208 405.987328 286.722048 405.987328M313.22624 352.980992 127.70304 352.980992c-14.636032 0-26.503168 11.867136-26.503168 26.503168L101.199872 909.54752c0 14.636032 11.867136 26.503168 26.503168 26.503168l185.5232 0c14.636032 0 26.503168-11.867136 26.503168-26.503168L339.729408 379.483136C339.729408 364.847104 327.862272 352.980992 313.22624 352.980992L313.22624 352.980992zM577.998848 563.557376l0 319.488L445.476864 883.045376l0-319.488L577.998848 563.557376M604.502016 510.543872l-185.52832 0c-14.636032 0-26.503168 11.859968-26.503168 26.510336L392.470528 909.54752c0 14.636032 11.867136 26.503168 26.503168 26.503168l185.52832 0c14.623744 0 26.504192-11.867136 26.504192-26.503168L631.006208 537.054208c0-14.623744-11.880448-26.497024-26.504192-26.497024l0 0L604.502016 510.543872zM869.792768 140.954624l0 742.090752L737.5104 883.045376l0-742.090752L869.792768 140.954624M896.29696 87.948288 711.007232 87.948288c-14.649344 0-26.503168 11.867136-26.503168 26.503168L684.504064 909.54752c0 14.636032 11.853824 26.503168 26.503168 26.503168L896.29696 936.050688c14.636032 0 26.503168-11.867136 26.503168-26.503168l0-795.096064C922.800128 99.815424 910.932992 87.948288 896.29696 87.948288L896.29696 87.948288z" p-id="1793" fill="#515151"></path></svg>
    çº¦ <span class="meta__text">3380</span> ä¸ªå­—
</div>

<div class="meta__item-reading_time meta__item">
	<svg t="1571149199980" class="meta__icon icon icon-time" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2748" width="16" height="16"><path d="M512 64C264.96 64 64 264.96 64 512s200.96 448 448 448 448-200.96 448-448S759.04 64 512 64zM512 895.712c-211.584 0-383.712-172.16-383.712-383.712C128.288 300.416 300.416 128.288 512 128.288c211.552 0 383.712 172.128 383.712 383.712C895.712 723.552 723.552 895.712 512 895.712z" p-id="2749" fill="#515151"></path><path d="M671.968 512 512 512 512 288.064c0-17.76-14.24-32.128-32-32.128s-32 14.4-32 32.128L448 544c0 17.76 14.272 32 32 32l191.968 0c17.76 0 32.128-14.24 32.128-32S689.728 512 671.968 512z" p-id="2750" fill="#515151"></path></svg>    
    é˜…è¯»çº¦éœ€ <span class="meta__text">
        
            7
         m</span>
</div>

						<div class="meta__item-page_pv meta__item">
    
    <span class="meta__text">
        <span id="busuanzi_container_page_pv">
            
        </span>
    </span>
</div>
				</div>
		</header>
		<div class="content post__content clearfix">
			<p><img src="https://cdn.at7h.com/img/helo.png" alt="helo&rsquo;s logo" title="helo's logo" /></p>
<p>å…¶ä¸­ï¼Œu.update(name=&quot;Daisy&rdquo;) ä¸ u.name = &ldquo;Daisy&rdquo; ç±»ä¼¼ï¼Œéƒ½æ˜¯åªåœ¨å†…å­˜é‡Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œä¸åŒçš„æ˜¯ u.update() è¿˜ä¼šè¿”å›ä¸€ä¸ªåŒ…å«æœ¬æ¬¡å˜æ›´çš„ä¸­é—´ç»“æœï¼Œå¯¹å…¶æ‰§è¡Œ await xxx.apply() åˆ™ä¼šå°†è¿™äº›å˜æ›´åº”ç”¨åˆ°æ•°æ®åº“é‡Œã€‚</p>
<p><strong>Helo</strong> æ˜¯æœ¬äººä¸šä½™å¼€å‘çš„ä¸€ä¸ªç®€å•å°å‹ä½çº§åˆ«çš„å¼‚æ­¥(<a href="https://docs.python.org/3.7/library/asyncio.html">asyncio</a>) Python ORMã€‚å®ƒå‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ¦‚å¿µï¼Œéå¸¸ç›´ç™½ï¼Œå®¹æ˜“ä¸Šæ‰‹ä½¿ç”¨ã€‚</p>
<blockquote>
<p>æ­¤å¤„å»å¾€<a href="https://github.com/at7h/helo">é¡¹ç›®ä»“åº“</a> ï¼Œæ¬¢è¿ä½¿ç”¨ã€æå‡ºæ„è§æˆ–è´¡çŒ®ä»£ç  ğŸ˜Š</p>
</blockquote>
<p>Helo å¯ä»¥åœ¨ä½ çš„å¼‚æ­¥åº”ç”¨ä¸­å¸®åŠ©ä½ è½»æ¾çš„æ„å»ºå‡ºå¯Œæœ‰è¡¨è¾¾åŠ›çš„å¸¸ç”¨ SQL è¯­å¥ï¼Œä½ åªéœ€ä»¥å‹å¥½çš„å¯¹è±¡åŒ– API æ¥æ“ä½œæ•°æ®ï¼Œè€Œä¸ç”¨å…³å¿ƒ SQL è¯­å¥ç¼–å†™ã€æ•°æ®å¤„ç†ç­‰ç»†èŠ‚ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼šä½¿ç”¨å¼‚æ­¥ ORM å¹¶ä¸å®Œå…¨æ„å‘³ç€å¯ä»¥ä½¿ä½ çš„åº”ç”¨å˜å¿«ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¼šä½¿ä½ çš„åº”ç”¨å˜å¾—å¤æ‚ã€‚ç»§ç»­ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆé˜…è¯»ä¸‹ SQLAlchemy ä½œè€… Mike Bayer çš„ <a href="https://techspot.zzzeek.org/2015/02/15/asynchronous-python-and-databases/">è¿™ç¯‡åšå®¢æ–‡ç« </a>ã€‚</p>
</blockquote>
<p>æœ¬ç¯‡ä¸Šæ‰‹æŒ‡å—ä¸»è¦ä»‹ç»ä»¥ä¸‹æ–¹é¢:</p>
<ul>
<li><a href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8">å®‰è£… helo</a></li>
<li><a href="#%E6%A8%A1%E5%9E%8B%E5%A3%B0%E6%98%8E">æ¨¡å‹å£°æ˜</a></li>
<li><a href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5">å»ºç«‹è¿æ¥</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C">æ•°æ®æ“ä½œ</a></li>
<li><a href="#quart-%E5%BA%94%E7%94%A8">åœ¨ quart åº”ç”¨ä¸­ä½¿ç”¨ helo</a></li>
<li><a href="#%E5%85%B6%E4%BB%96">å…¶ä»–è¡¥å……</a></li>
</ul>
<h1 id="å¼€å§‹ä½¿ç”¨">å¼€å§‹ä½¿ç”¨</h1>
<p>å®‰è£… <a href="https://github.com/at7h/helo">helo</a> å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼:</p>
<p><strong><em>1.</em></strong> å®‰è£… pypi çš„ç¨³å®šå‘å¸ƒç‰ˆæœ¬, åœ¨ç»ˆç«¯ä¸­è¿è¡Œæ­¤å‘½ä»¤:</p>
<pre><code class="language-console" data-lang="console">$ pip install helo
</code></pre><p><strong><em>2.</em></strong> ä»æœ€æ–°çš„æºç å®‰è£…</p>
<pre><code class="language-console" data-lang="console">$ git clone https://github.com/at7h/helo.git
$ cd helo
$ python setup.py install
</code></pre><p>å®‰è£…å®Œæˆåå°±å¼€å§‹ä¸‹é¢çš„å…¥å‘ä¹‹æ—…äº† ğŸ˜ˆ ã€‚</p>
<hr>
<p>ä½¿ç”¨ <a href="https://github.com/at7h/helo">helo</a>, é¦–å…ˆä½ éœ€è¦å¼•å…¥ <code>helo</code> å¹¶ä½¿ç”¨ <code>helo.G</code> å®ä¾‹åŒ–ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå‡å®šç§°å…¶ä¸º <code>db</code>:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">import</span> helo

db <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>G()
</code></pre></div><p><code>db</code> æ˜¯ä¸€ä¸ªå…¨å±€å•ä¾‹å¯¹è±¡ï¼Œä¸‹é¢çš„ä»‹ç»ä¸­æˆ‘ä»¬å°†å¤šæ¬¡ä½¿ç”¨åˆ°å®ƒã€‚</p>
<h1 id="æ¨¡å‹å£°æ˜">æ¨¡å‹å£°æ˜</h1>
<p>ä½¿ç”¨ <a href="https://github.com/at7h/helo">helo</a> å£°æ˜æ¨¡å‹å¾ˆç®€å•ï¼Œåªéœ€ä» <code>helo.Model</code> ç»§æ‰¿å³å¯ã€‚ä¸‹é¢ç»™å‡ºå‡ ä¸ªæ¨¡å‹å£°æ˜çš„ç®€å•çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">class</span> <span style="color:#268bd2">Person</span>(helo<span style="color:#719e07">.</span>Model):
    <span style="color:#b58900">id</span> <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>BigAuto()
    name <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>VarChar(length<span style="color:#719e07">=</span><span style="color:#2aa198">45</span>, null<span style="color:#719e07">=</span><span style="color:#268bd2">False</span>)

<span style="color:#719e07">class</span> <span style="color:#268bd2">User</span>(Person):
    email <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Email(default<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;&#39;</span>)
    password <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>VarChar(length<span style="color:#719e07">=</span><span style="color:#2aa198">100</span>, null<span style="color:#719e07">=</span><span style="color:#268bd2">False</span>)
    create_at <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Timestamp(default<span style="color:#719e07">=</span>helo<span style="color:#719e07">.</span>ON_CREATE)

    <span style="color:#719e07">class</span> <span style="color:#268bd2">Meta</span>:
        indexes <span style="color:#719e07">=</span> [helo<span style="color:#719e07">.</span>K(<span style="color:#2aa198">&#39;idx_ep&#39;</span>, [<span style="color:#2aa198">&#39;email&#39;</span>, <span style="color:#2aa198">&#39;password&#39;</span>])]

<span style="color:#719e07">class</span> <span style="color:#268bd2">Employee</span>(Person):
    department <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Smallint()
    salary <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Float(default<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>)

<span style="color:#719e07">class</span> <span style="color:#268bd2">Post</span>(helo<span style="color:#719e07">.</span>Model):
    <span style="color:#b58900">id</span> <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Auto(comment<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;auto increment pk&#39;</span>)
    title <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>VarChar(length<span style="color:#719e07">=</span><span style="color:#2aa198">100</span>)
    content <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Text(encoding<span style="color:#719e07">=</span>helo<span style="color:#719e07">.</span>ENCODING<span style="color:#719e07">.</span>UTF8MB4)
    author <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Int(default<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>)
    create_at <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Timestamp(default<span style="color:#719e07">=</span>helo<span style="color:#719e07">.</span>ON_CREATE)
    update_at <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>Timestamp(default<span style="color:#719e07">=</span>helo<span style="color:#719e07">.</span>ON_UPDATE)

    <span style="color:#719e07">class</span> <span style="color:#268bd2">Meta</span>:
        indexes <span style="color:#719e07">=</span> [
            helo<span style="color:#719e07">.</span>K(<span style="color:#2aa198">&#39;idx_title&#39;</span>, <span style="color:#2aa198">&#39;title&#39;</span>),
            helo<span style="color:#719e07">.</span>K(<span style="color:#2aa198">&#39;idx_author&#39;</span>, <span style="color:#2aa198">&#39;author&#39;</span>),
        ]
</code></pre></div><p>å†…éƒ¨ç±» <code>Meta</code> å¯ç”¨äºæŒ‡å®š <code>db_name</code>, <code>table_name</code>, <code>engine</code>, <code>indexes</code>, <code>charset</code>, <code>comment</code> ç­‰
<code>Table</code> çš„å…ƒå±æ€§ã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">class</span> <span style="color:#268bd2">Meta</span>:
    db <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;db_name&#39;</span>
    name <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;table_name&#39;</span>
    engine <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>ENGINE<span style="color:#719e07">.</span>innodb
    charset <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>ENCODING<span style="color:#719e07">.</span>utf8mb4
    indexes <span style="color:#719e07">=</span> []
    comment <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;table comment&#39;</span>
</code></pre></div><p>å…¶ä¸­ <code>table_name</code> é»˜è®¤ä¸º model ç±»åçš„ <a href="https://en.wikipedia.org/wiki/Snake_case">snake_case</a> é£æ ¼åç§°ï¼Œ<code>engine</code> é»˜è®¤ä¸º <code>InnoDB</code>ï¼Œ<code>charset</code> é»˜è®¤ä¸º <code>utf8mb4</code>ã€‚</p>
<h1 id="å»ºç«‹è¿æ¥">å»ºç«‹è¿æ¥</h1>
<p>å‰é¢çš„æ¨¡å‹å£°æ˜åªæ˜¯å®šä¹‰äº†æ¨¡å‹ä¸çœŸå®è¡¨ç»“æ„çš„æ˜ å°„å…³ç³»ï¼Œå¹¶éå®é™…åœ¨æ•°æ®åº“ä¸­åˆ›å»ºäº†è¿™äº›è¡¨ç»“æ„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨ <a href="https://github.com/at7h/helo">helo</a> æ¥ä¸æ•°æ®åº“å»ºç«‹è¿æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª MySQL çš„æ•°æ®åº“å®ä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>bind(<span style="color:#2aa198">&#39;mysql://user:pwd@localhost:3306/helo&#39;</span>)
</code></pre></div><p>æˆ–è€…ä¼ é€’é…ç½®å‚æ•°ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>bind(user<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;user&#39;</span>, password<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;pwd&#39;</span>, db<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;helo&#39;</span>)
</code></pre></div><p>å¦‚æœä½ è®¾ç½®äº†ç¯å¢ƒå˜é‡ <code>HELO_DATABASE_URL</code>ï¼Œé‚£ä¹ˆä½ ä¸ç”¨å†ä¼ é€’ url:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>bind()
</code></pre></div><blockquote>
<p>å¦‚æœä½ æƒ³è‡ªå®šä¹‰ KEY çš„å€¼ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ– <code>db</code> æ—¶é€šè¿‡ <code>env_key</code> å‚æ•°æ¥è®¾ç½®:</p>
<p><code>db = helo.G(env_key=&quot;YOUR_ENV_KEY&quot;)</code></p>
</blockquote>
<p><code>bind</code> å®é™…ä¸Šä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> db<span style="color:#719e07">.</span>state
{<span style="color:#2aa198">&#39;minsize&#39;</span>: <span style="color:#2aa198">1</span>, <span style="color:#2aa198">&#39;maxsize&#39;</span>: <span style="color:#2aa198">15</span>, <span style="color:#2aa198">&#39;size&#39;</span>: <span style="color:#2aa198">1</span>, <span style="color:#2aa198">&#39;freesize&#39;</span>: <span style="color:#2aa198">1</span>}
</code></pre></div><p><code>bind</code> ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå…³é”®å­—å‚æ•°æ¥å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰è®¾ç½®ï¼Œè¯¦è§ <a href="https://github.com/at7h/helo/blob/master/helo/db.py#L175">helo.db.Pool</a> ç±»ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>bind(<span style="color:#2aa198">&#39;mysql://user:pwd@127.0.0.1:3306/db&#39;</span>, maxsize<span style="color:#719e07">=</span><span style="color:#2aa198">10</span>, connect_timeout<span style="color:#719e07">=</span><span style="color:#2aa198">15</span>)
</code></pre></div><p>å·²ç»åˆ›å»ºçš„è¿æ¥æ± å¯¹è±¡å°†æ˜¯ä¸€ä¸ªå…¨å±€çš„å•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ å·²ç»ä¸ºä½ çš„åº”ç”¨ç¨‹åºè°ƒç”¨ <code>bind</code> ç»‘å®šäº†æ•°æ®åº“ï¼Œåœ¨æ­¤ä¹‹å‰å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ <code>unbind</code> è¿›è¡Œè§£ç»‘ï¼Œä½ å°†ä¸èƒ½å†ç»§ç»­ä½¿ç”¨ <code>bind</code> å†æ¬¡ç»‘å®šå¦ä¸€ä¸ªæ•°æ®åº“ï¼Œå¦åˆ™ä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ª <code>helo.err.DuplicateBinding</code> é”™è¯¯ã€‚</p>
<p>å¦‚æœä½ éœ€è¦æ˜¾å¼åœ°æ–­å¼€ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œå…³é—­è¿æ¥æ± ï¼Œå¯ä»¥ä½¿ç”¨ <code>unbind</code>:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>unbind()
</code></pre></div><p>åœ¨å°å‹çš„è„šæœ¬ä¸­ä½ å¯ä»¥ä½¿ç”¨ <code>db.binder</code> æ¥è‡ªåŠ¨å¤„ç†ä¸Šä¸‹æ–‡ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> async <span style="color:#719e07">with</span> db<span style="color:#719e07">.</span>binder():
<span style="color:#719e07">...</span>     <span style="color:#719e07">pass</span>
</code></pre></div><h1 id="æ•°æ®æ“ä½œ">æ•°æ®æ“ä½œ</h1>
<p>ä¸æ•°æ®åº“å»ºç«‹äº†è¿æ¥ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®åº“åˆ›å»ºæˆ‘ä»¬çš„è¡¨ï¼Œä»¥ä¾¿äºæ¥ä¸‹æ¥è¿›è¡Œæ•°æ®çš„æ“ä½œã€‚</p>
<p>åœ¨çœŸæ­£çš„åº”ç”¨ä¸­ï¼Œæ•°æ®åº“è¡¨çš„è®¾è®¡åˆ›å»ºä¸ç»´æŠ¤æ˜¯å•ç‹¬åˆ†å¼€ï¼Œä¸€èˆ¬ç”±ä¸“é—¨çš„ DBA æ¥ç®¡ç†ã€‚å½“ç„¶ helo ä¹Ÿæä¾›äº†åŸºç¡€çš„ DDL æ”¯æŒã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åœ¨æ•°æ®åº“åˆ›å»ºå®ƒä»¬ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>create_tables([User, Employee, Post])
</code></pre></div><p>åœ¨åº”ç”¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†æ‰€æœ‰çš„æ¨¡å‹å£°æ˜å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œåœ¨æ­¤å‡è®¾æ¨¡å—åä¸º <code>models</code>ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>create_all</code> ä¸ºæ¨¡å—ä¸­æ‰€æœ‰çš„ model åˆ›å»ºè¡¨ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> <span style="color:#719e07">from</span> your.application <span style="color:#719e07">import</span> models
<span style="color:#719e07">&gt;&gt;&gt;</span> await db<span style="color:#719e07">.</span>create_all(models)
</code></pre></div><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Model</code> çš„æ–¹æ³•æ¥å•ç‹¬åˆ›å»º:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> await User<span style="color:#719e07">.</span>create()
</code></pre></div><p><a href="https://github.com/at7h/helo">Helo</a> æä¾›äº†åŸºæœ¬çš„æ“ä½œæ•°æ®åº“ä¸­æ•°æ®çš„èƒ½åŠ›ï¼Œæ”¯æŒä¸°å¯Œçš„å¯ç»„åˆçš„é€»è¾‘è¿ç®—è¡¨è¾¾ï¼Œä½ å¯ä»¥è½»æ¾çš„å®Œæˆå¯Œæœ‰è¡¨è¾¾åŠ›çš„ queriesï¼Œä»¥å®ç°é€šè¿‡å¯¹è±¡åŒ–çš„ API æ¥æ„å»ºä½ æƒ³è¦çš„ SQL è¯­å¥(DML å’Œ DQL)çš„èƒ½åŠ›ã€‚</p>
<p>ä¸‹é¢ç¤ºä¾‹åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥çš„æ“ä½œã€‚</p>
<h2 id="å¢">å¢</h2>
<p>ä½¿ç”¨ <a href="https://github.com/at7h/helo">helo</a> ä½ å¯ä»¥æœ‰å¤šç§æ’å…¥æ•°æ®çš„æ–¹å¼é€‰æ‹©ï¼Œæˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ª User å¯¹è±¡å¼€å§‹:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user <span style="color:#719e07">=</span> User(name<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;at7h&#39;</span>, password<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;1111&#39;</span>)
<span style="color:#719e07">print</span>(user<span style="color:#719e07">.</span>name, user<span style="color:#719e07">.</span>password)  <span style="color:#586e75"># at7h, 1111</span>
<span style="color:#586e75"># Now user.id is None, because it is not saved to the database</span>
<span style="color:#719e07">assert</span> user<span style="color:#719e07">.</span>id <span style="color:#719e07">is</span> <span style="color:#268bd2">None</span>
</code></pre></div><p>æ­¤æ—¶çš„ user ä»…æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½ éœ€è¦é€šè¿‡ <code>save</code> æ–¹æ³•æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user_id <span style="color:#719e07">=</span> await user<span style="color:#719e07">.</span>save()
<span style="color:#719e07">assert</span> user_id <span style="color:#719e07">==</span> user<span style="color:#719e07">.</span>id <span style="color:#719e07">==</span> <span style="color:#2aa198">1</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒï¼Œå¹¶ä¿å­˜æ›´æ”¹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user<span style="color:#719e07">.</span>name <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;at8h&#39;</span>
user<span style="color:#719e07">.</span>email <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;g@at7h.com&#39;</span>
user_id <span style="color:#719e07">=</span> await user<span style="color:#719e07">.</span>save()
<span style="color:#719e07">assert</span> user_id <span style="color:#719e07">==</span> user<span style="color:#719e07">.</span>id <span style="color:#719e07">==</span> <span style="color:#2aa198">1</span>
</code></pre></div><blockquote>
<p>è¯·æ³¨æ„ï¼š ç›®å‰ <code>save</code> æ“ä½œæ˜¯é€šè¿‡ MySQL <code>REPLACE</code> è¯­å¥å®ç°ï¼Œå…¶æ ¹æ®å¯¹è±¡çš„ PRIMARY KEY å±æ€§æˆ– UNIQUE KEY å±æ€§çš„å€¼æ¥å†³å®šæ˜¯å¦æ’å…¥æ–°è¡Œï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼è¯¥å®ç°è®¡åˆ’åœ¨åç»­ç‰ˆæœ¬ä¸­ä¼˜åŒ–ã€‚</p>
</blockquote>
<p>æ¨èä½¿ç”¨ä¸‹é¢å‡ ç§æ–¹å¼æ¥æ’å…¥æ•°æ®ã€‚</p>
<p>æ–¹æ³• <code>add</code>, <code>madd</code> å¯ä»¥ç”¨æ¥æ·»åŠ å•æ¡æˆ–å¤šæ¡æ•°æ®ï¼Œå®ƒä»¬æ˜¯ <code>insert</code>, <code>minsert</code> çš„ç®€å•å¿«æ·æ–¹å¼ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user_id <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>add(name<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;bobo&#39;</span>, password<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;2222&#39;</span>)
<span style="color:#586e75"># Or: user_id = await User.add({&#39;name&#39;: &#39;bobo&#39;, &#39;password&#39;: &#39;2222&#39;})</span>
<span style="color:#719e07">print</span>(user_id)  <span style="color:#586e75"># 2</span>

users <span style="color:#719e07">=</span> [{<span style="color:#2aa198">&#39;name&#39;</span>: <span style="color:#2aa198">&#39;mingz&#39;</span>, <span style="color:#2aa198">&#39;password&#39;</span>: <span style="color:#2aa198">&#39;3333&#39;</span>},
         {<span style="color:#2aa198">&#39;name&#39;</span>: <span style="color:#2aa198">&#39;xy69z&#39;</span>, <span style="color:#2aa198">&#39;password&#39;</span>: <span style="color:#2aa198">&#39;4444&#39;</span>}]
<span style="color:#586e75"># Or using user object list:</span>
<span style="color:#586e75"># users = [User(name=&#39;mingz&#39;, password=&#39;3333&#39;),</span>
<span style="color:#586e75">#          User(name=&#39;xy69z&#39;, password=&#39;4444&#39;)]</span>
count <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>madd(users)
<span style="color:#719e07">print</span>(count)  <span style="color:#586e75"># 2</span>
</code></pre></div><p>æ–¹æ³• <code>insert</code> å’Œ <code>minsert</code> æ˜¯æœ€æ­£ç¡®çš„æ•°æ®æ’å…¥å§¿åŠ¿ï¼Œå®ƒä»¬å¯ä»¥èƒœä»»å¤šç§æ•°æ®å½¢å¼ï¼Œå®ƒä»¬å°†è¿”å›ä¸€ä¸ª <code>Insert</code> å¯¹è±¡ï¼Œè¦æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·ä¸è¦å¿˜äº†å†™ <code>do()</code> å“¦ ğŸ˜‰ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">ret <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>insert(name<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;poper&#39;</span>, password<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;5555&#39;</span>)<span style="color:#719e07">.</span>do()
<span style="color:#586e75"># Or: ret = await User.insert({&#39;name&#39;: &#39;bingo&#39;, &#39;password&#39;: &#39;8888&#39;}).do()</span>
<span style="color:#719e07">assert</span> ret<span style="color:#719e07">.</span>affected <span style="color:#719e07">==</span> <span style="color:#2aa198">1</span>
<span style="color:#719e07">assert</span> ret<span style="color:#719e07">.</span>last_id <span style="color:#719e07">==</span> <span style="color:#2aa198">5</span>
<span style="color:#719e07">print</span>(ret)  <span style="color:#586e75"># (1, 5)</span>

<span style="color:#586e75"># Inserting multiple</span>
employees <span style="color:#719e07">=</span> [
    {<span style="color:#2aa198">&#39;name&#39;</span>: <span style="color:#2aa198">&#39;at7h&#39;</span>, <span style="color:#2aa198">&#39;department&#39;</span>: <span style="color:#2aa198">1</span>},
    {<span style="color:#2aa198">&#39;name&#39;</span>: <span style="color:#2aa198">&#39;bobo&#39;</span>, <span style="color:#2aa198">&#39;department&#39;</span>: <span style="color:#2aa198">2</span>},
]
ret <span style="color:#719e07">=</span> await Employee<span style="color:#719e07">.</span>minsert(employees)<span style="color:#719e07">.</span>do()
<span style="color:#719e07">print</span>(ret)  <span style="color:#586e75"># (2, 1)</span>

<span style="color:#586e75"># Specify row tuples columns the tuple values correspond to</span>
posts <span style="color:#719e07">=</span> [
    (<span style="color:#2aa198">&#39;post1&#39;</span>, <span style="color:#2aa198">1</span>),
    (<span style="color:#2aa198">&#39;post2&#39;</span>, <span style="color:#2aa198">2</span>),
]
ret <span style="color:#719e07">=</span> await Post<span style="color:#719e07">.</span>minsert(
    posts, columns<span style="color:#719e07">=</span>[Post<span style="color:#719e07">.</span>title, Post<span style="color:#719e07">.</span>author]
)<span style="color:#719e07">.</span>do()
<span style="color:#719e07">print</span>(ret)  <span style="color:#586e75"># (2, 1)</span>
</code></pre></div><p>ä½¿ç”¨ <code>insert_from</code> æ”¯æŒè¡¨é—´æ•°æ®å¡«å……ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">select <span style="color:#719e07">=</span> User<span style="color:#719e07">.</span>select(User<span style="color:#719e07">.</span>name)<span style="color:#719e07">.</span>where(User<span style="color:#719e07">.</span>id<span style="color:#719e07">.</span>in_([<span style="color:#2aa198">3</span>, <span style="color:#2aa198">4</span>, <span style="color:#2aa198">5</span>]))
ret <span style="color:#719e07">=</span> await Employee<span style="color:#719e07">.</span>insert_from(select, [Employee<span style="color:#719e07">.</span>name])<span style="color:#719e07">.</span>do()
<span style="color:#719e07">print</span>(ret)  <span style="color:#586e75"># (3, 3)</span>
</code></pre></div><h2 id="æŸ¥">æŸ¥</h2>
<p><a href="https://github.com/at7h/helo">Helo</a> ä¹Ÿæœ‰å¤šç§è·å–æ•°æ®çš„æ–¹å¼é€‰æ‹©ï¼Œå¦‚ç®€å•è·å–å•æ¡æ•°æ®å¯ä»¥ä½¿ç”¨ <code>get</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#586e75"># By id</span>
user <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>get(<span style="color:#2aa198">1</span>)
<span style="color:#719e07">assert</span> <span style="color:#b58900">isinstance</span>(user, User)
<span style="color:#719e07">print</span>(user<span style="color:#719e07">.</span>id, user<span style="color:#719e07">.</span>name, user<span style="color:#719e07">.</span>password)  <span style="color:#586e75"># 1, at7h, 1111</span>

<span style="color:#586e75"># Or by query</span>
<span style="color:#719e07">assert</span> (await User<span style="color:#719e07">.</span>get(User<span style="color:#719e07">.</span>name <span style="color:#719e07">==</span> user<span style="color:#719e07">.</span>name)) <span style="color:#719e07">==</span> user
</code></pre></div><p>è·å–å¤šæ¡æ•°æ®å¯ä»¥ä½¿ç”¨ <code>mget</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#586e75"># By id list</span>
uid_list <span style="color:#719e07">=</span> [<span style="color:#2aa198">1</span>, <span style="color:#2aa198">2</span>, <span style="color:#2aa198">3</span>]
users <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>mget(uid_list)
<span style="color:#719e07">print</span>(users<span style="color:#719e07">.</span>count)  <span style="color:#586e75"># 3</span>
<span style="color:#719e07">print</span>(users)  <span style="color:#586e75"># [&lt;User object at 1&gt;, &lt;User object at 2&gt;, &lt;User object at 3&gt;]</span>
<span style="color:#586e75"># Specify columns</span>
users <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>mget(uid_list, columns<span style="color:#719e07">=</span>[User<span style="color:#719e07">.</span>id, User<span style="color:#719e07">.</span>name])
<span style="color:#719e07">assert</span> users[<span style="color:#2aa198">0</span>]<span style="color:#719e07">.</span>password <span style="color:#719e07">is</span> <span style="color:#268bd2">None</span>

<span style="color:#586e75"># Or by query</span>
users <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>mget((User<span style="color:#719e07">.</span>id <span style="color:#719e07">&lt;</span> <span style="color:#2aa198">2</span>) <span style="color:#719e07">|</span> (User<span style="color:#719e07">.</span>name <span style="color:#719e07">==</span> <span style="color:#2aa198">&#39;mingz&#39;</span>))
<span style="color:#719e07">print</span>(users)  <span style="color:#586e75"># [&lt;User object at 1&gt;, &lt;User object at 3&gt;]</span>
</code></pre></div><p>åŒæ ·çš„ï¼Œæ–¹æ³• <code>get</code> å’Œ <code>mget</code> ä¹Ÿæ˜¯ <code>select</code> çš„ç®€å•å¿«æ·ç‰ˆæœ¬ï¼Œå…¶åªé€‚åˆäºå·²çŸ¥ä¸»é”®æˆ–æŸ¥è¯¢æ¡ä»¶æ¯”è¾ƒç®€å•çš„åœºæ™¯ï¼Œæ›´å¤šçš„æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨ <code>select</code>ã€‚</p>
<p><strong>ä½¿ç”¨ <code>select</code> æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ ä»¥å¯¹è±¡åŒ– API çš„æ–¹å¼è½»æ¾çš„æ„é€ ä½ çš„ DQLï¼Œå…¶æ”¯æŒä¸°å¯Œçš„å¯ç»„åˆçš„é€»è¾‘æ¡ä»¶è¡¨è¾¾å¼ã€‚</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">users <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>order_by(
    User<span style="color:#719e07">.</span>id<span style="color:#719e07">.</span>desc()
)<span style="color:#719e07">.</span>limit(<span style="color:#2aa198">3</span>)<span style="color:#719e07">.</span>offset(<span style="color:#2aa198">2</span>)<span style="color:#719e07">.</span>all()
<span style="color:#719e07">print</span>(users) <span style="color:#586e75"># [&lt;User object at 5&gt;, &lt;User object at 4&gt;, &lt;User object at 3&gt;]</span>
</code></pre></div><blockquote>
<p>æ–¹æ³• <code>all()</code> ä»¥åŠä¸‹é¢æåˆ°çš„ <code>get()</code>, <code>first()</code>, <code>rows()</code>, <code>paginate()</code> ç­‰æ–¹æ³•ç±»ä¼¼äºä¸Šé¢æåˆ°çš„ <code>do()</code>ï¼Œéƒ½ç”¨äºé©±åŠ¨æ‰§è¡Œæ­¤æ¬¡æŸ¥è¯¢ï¼Œä¸è¦å¿˜äº†å“¦ã€‚</p>
</blockquote>
<p>æ¯”å¦‚æˆ‘éœ€è¦çŸ¥é“æœ‰æ²¡æœ‰ä½¿ç”¨ gmail é‚®ç®±çš„ç”¨æˆ·ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">is_exist <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>where(
    User<span style="color:#719e07">.</span>email<span style="color:#719e07">.</span>endswith(<span style="color:#2aa198">&#39;gmail.com&#39;</span>)
)<span style="color:#719e07">.</span>exist()
<span style="color:#719e07">print</span>(is_exist)  <span style="color:#586e75"># False</span>
</code></pre></div><p>æ¯”å¦‚æˆ‘æƒ³çŸ¥é“ 2019 å¹´ 7 æœˆä»¥æ¥å…±æ–°å¢äº†å¤šå°‘ç”¨æˆ·ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user_count <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>where(
    User<span style="color:#719e07">.</span>create_at <span style="color:#719e07">&gt;</span> datetime(<span style="color:#2aa198">2019</span>, <span style="color:#2aa198">7</span>, <span style="color:#2aa198">1</span>)
)<span style="color:#719e07">.</span>count()
<span style="color:#719e07">print</span>(user_count)  <span style="color:#586e75"># 4</span>
</code></pre></div><p>å†æ¯”å¦‚æˆ‘ä»¬éœ€è¦åˆ†é¡µçš„è·å–ä»Šå¹´å†™äº† Python(title) ç›¸å…³æ–‡ç« çš„ç”¨æˆ·ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">users <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>where(
    User<span style="color:#719e07">.</span>id<span style="color:#719e07">.</span>in_(
        Post<span style="color:#719e07">.</span>select(Post<span style="color:#719e07">.</span>author)<span style="color:#719e07">.</span>where(
            Post<span style="color:#719e07">.</span>update_at <span style="color:#719e07">&gt;</span> datetime(<span style="color:#2aa198">2019</span>, <span style="color:#2aa198">1</span>, <span style="color:#2aa198">1</span>),
            Post<span style="color:#719e07">.</span>title<span style="color:#719e07">.</span>contains(<span style="color:#2aa198">&#39;Python&#39;</span>)
        )<span style="color:#719e07">.</span>order_by(
            Post<span style="color:#719e07">.</span>update_at<span style="color:#719e07">.</span>desc()
        )
    )
)<span style="color:#719e07">.</span>paginate(<span style="color:#2aa198">1</span>, <span style="color:#2aa198">10</span>)
<span style="color:#719e07">print</span>(users)  <span style="color:#586e75"># [&lt;User object at 1&gt;]</span>
</code></pre></div><p>å†æ¯”å¦‚æˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªç”¨æˆ·éƒ½å†™äº†å¤šå°‘ç¯‡æ–‡ç« ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user_posts <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select(
    User<span style="color:#719e07">.</span>name, helo<span style="color:#719e07">.</span>F<span style="color:#719e07">.</span>COUNT(helo<span style="color:#719e07">.</span>SQL(<span style="color:#2aa198">&#39;1&#39;</span>))<span style="color:#719e07">.</span>as_(<span style="color:#2aa198">&#39;posts&#39;</span>)
)<span style="color:#719e07">.</span>join(
    Post, helo<span style="color:#719e07">.</span>JOINTYPE<span style="color:#719e07">.</span>LEFT, on<span style="color:#719e07">=</span>(User<span style="color:#719e07">.</span>id <span style="color:#719e07">==</span> Post<span style="color:#719e07">.</span>author)
)<span style="color:#719e07">.</span>group_by(
    User<span style="color:#719e07">.</span>name
)<span style="color:#719e07">.</span>rows(<span style="color:#2aa198">100</span>)
<span style="color:#719e07">print</span>(user_posts)  <span style="color:#586e75"># [{&#39;name&#39;: &#39;at7h&#39;, &#39;posts&#39;: 1}]</span>
</code></pre></div><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>helo.F</code> æ¥ä½¿ç”¨ SQL å‡½æ•°ï¼Œæ¯”å¦‚æˆ‘éœ€è¦è®¡ç®—å‡ºæ¯ä¸ªæœˆæ‰€æœ‰é›‡å‘˜è–ªèµ„çš„æ€»å’Œï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">salary_sum <span style="color:#719e07">=</span> await Employee<span style="color:#719e07">.</span>select(
    helo<span style="color:#719e07">.</span>F<span style="color:#719e07">.</span>SUM(Employee<span style="color:#719e07">.</span>salary)<span style="color:#719e07">.</span>as_(<span style="color:#2aa198">&#39;salary_sum&#39;</span>)
)<span style="color:#719e07">.</span>scalar()
<span style="color:#719e07">print</span>(salary_sum)  <span style="color:#586e75"># 30000.0</span>
</code></pre></div><h2 id="æ”¹">æ”¹</h2>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å°è¯•å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®åšä¸€äº›ä¿®æ”¹æ“ä½œã€‚</p>
<p>æ¯”å¦‚ä½ è¦æ›´æ”¹æŸä¸€ä½é›‡å‘˜çš„è–ªèµ„ ğŸ˜‹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">ret <span style="color:#719e07">=</span> await Employee<span style="color:#719e07">.</span>update(salary<span style="color:#719e07">=</span><span style="color:#2aa198">20000</span>)<span style="color:#719e07">.</span>where(
    Employee<span style="color:#719e07">.</span>name <span style="color:#719e07">==</span> <span style="color:#2aa198">&#39;at7h&#39;</span>
)<span style="color:#719e07">.</span>do()
<span style="color:#719e07">print</span>(ret<span style="color:#719e07">.</span>affected)  <span style="color:#586e75"># 1</span>
</code></pre></div><p>æˆ–è€…ï¼Œæ•´ä½“æ¶¨å·¥èµ„å•¦ ğŸ‘ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">ret <span style="color:#719e07">=</span> await Employee<span style="color:#719e07">.</span>update(
    salary<span style="color:#719e07">=</span>Employee<span style="color:#719e07">.</span>salary <span style="color:#719e07">+</span> <span style="color:#2aa198">1000</span>
)<span style="color:#719e07">.</span>where(
    (Employee<span style="color:#719e07">.</span>department<span style="color:#719e07">.</span>in_([<span style="color:#2aa198">1</span>, <span style="color:#2aa198">2</span>])) <span style="color:#719e07">|</span> (Employee<span style="color:#719e07">.</span>name <span style="color:#719e07">==</span> <span style="color:#2aa198">&#39;at7h&#39;</span>)
)<span style="color:#719e07">.</span>do()
</code></pre></div><h2 id="åˆ ">åˆ </h2>
<p>æœ€åæˆ‘ä»¬æ¥å°è¯•åˆ é™¤è¡¨ä¸­çš„æ•°æ®ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ model å¯¹è±¡çš„ <code>remove</code> æ–¹æ³•æ¥åˆ é™¤å®ƒå¯¹åº”äºæ•°æ®åº“ä¸­è¿™ä¸€è¡Œçš„æ•°æ®ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">user <span style="color:#719e07">=</span> User(name<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;at7h&#39;</span>, password<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;1111&#39;</span>)
await user<span style="color:#719e07">.</span>save()
user <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>get(user_id)
<span style="color:#719e07">print</span>(user<span style="color:#719e07">.</span>id)  <span style="color:#586e75"># 1</span>
await user<span style="color:#719e07">.</span>remove()
user <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>get(user_id)
<span style="color:#719e07">print</span>(user)  <span style="color:#586e75"># None</span>
</code></pre></div><p>å¦ä¸€ç§æ›´ä¸ºé€šå¸¸çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>delete</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">ret <span style="color:#719e07">=</span> await Post<span style="color:#719e07">.</span>delete()<span style="color:#719e07">.</span>where(
    Post<span style="color:#719e07">.</span>create_at <span style="color:#719e07">&lt;</span> datetime(<span style="color:#2aa198">2010</span>, <span style="color:#2aa198">1</span>, <span style="color:#2aa198">1</span>)
)<span style="color:#719e07">.</span>limit(
    <span style="color:#2aa198">100</span>
)<span style="color:#719e07">.</span>do()
</code></pre></div><blockquote>
<p>è¯·æ³¨æ„ï¼š æ°¸è¿œä¸è¦å¿˜è®°å†™ <code>where</code> å­å¥ï¼Œæ˜¯ä¸æ˜¯æ•´ä¸ªè¡¨éƒ½ä¸æƒ³è¦äº† ğŸ˜Ÿ ï¼Ÿ</p>
</blockquote>
<h2 id="replace">Replace</h2>
<p>å¦å¤–ï¼Œ<a href="https://github.com/at7h/helo">helo</a> æ”¯æŒ MySQL <code>REPLACE</code> è¯­å¥ï¼Œæä¾›äº† <code>replace</code> å’Œ <code>mreplace</code> ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ç”¨æ³•ä¸ <code>insert</code> å’Œ <code>minsert</code> ç±»ä¼¼ã€‚å½“ç„¶ï¼Œåœ¨ä½¿ç”¨å®ƒä»¬ä¹‹å‰ä½ éœ€è¦äº†è§£ MySQL <code>REPLACE</code> è¯­å¥çš„å·¥ä½œåŸç†ã€‚</p>
<h1 id="quart-åº”ç”¨">Quart åº”ç”¨</h1>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ <a href="https://github.com/pgjones/quart">quart</a>, ä¸€ä¸ªæœ€å°çš„åº”ç”¨ç¤ºä¾‹æ˜¯:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">import</span> quart
<span style="color:#719e07">import</span> helo

app <span style="color:#719e07">=</span> quart<span style="color:#719e07">.</span>Quart(__name__)
app<span style="color:#719e07">.</span>config[<span style="color:#2aa198">&#34;HELO_DATABASE_URL&#34;</span>] <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;mysql://user:password@127.0.0.1:3306/db&#34;</span>

db <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>G(app)


<span style="color:#268bd2">@app.route</span>(<span style="color:#2aa198">&#39;/api/users&#39;</span>)
async <span style="color:#719e07">def</span> <span style="color:#268bd2">users</span>():
    await User<span style="color:#719e07">.</span>insert(
        name<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;at7h&#39;</span>, email<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;g@test.com&#39;</span>, password<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;xxxx&#39;</span>
    )<span style="color:#719e07">.</span>do()
    user_list <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>all(<span style="color:#268bd2">False</span>)
    <span style="color:#719e07">return</span> quart<span style="color:#719e07">.</span>jsonify(user_list)


app<span style="color:#719e07">.</span>run()
</code></pre></div><p>æ­¤æ—¶ä½ ä¸éœ€è¦å†æ˜¾ç¤ºçš„æ‰§è¡Œ <code>db.bind</code>ï¼Œbinding æ“ä½œå°†ä¼šåœ¨ä½ åº”ç”¨çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰è‡ªåŠ¨å®Œæˆã€‚</p>
<p>å¯åŠ¨æ­¤æœåŠ¡:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://127.0.0.1:5000/api/users
<span style="color:#719e07">[{</span><span style="color:#2aa198">&#34;email&#34;</span>:<span style="color:#2aa198">&#34;g@test.com&#34;</span>,<span style="color:#2aa198">&#34;id&#34;</span>:1,<span style="color:#2aa198">&#34;name&#34;</span>:<span style="color:#2aa198">&#34;at7h&#34;</span>,<span style="color:#2aa198">&#34;password&#34;</span>:<span style="color:#2aa198">&#34;xxxx&#34;</span><span style="color:#719e07">}]</span>
</code></pre></div><h1 id="å…¶ä»–">å…¶ä»–</h1>
<h2 id="model-iteration">Model Iteration</h2>
<p><a href="https://github.com/at7h/helo">Helo</a> ä¸­çš„ <code>Model</code> å’Œ <code>Select</code> éƒ½æ”¯æŒè¿­ä»£ï¼Œ<a href="https://github.com/at7h/helo">helo</a> ä¼šè‡ªåŠ¨å¸®ä½ å¤„ç†åˆ†é¡µé—®é¢˜ï¼Œä»¥é¿å…é¢‘ç¹çš„ IO æ“ä½œå’Œè¿‡å¤§çš„æ•°æ®é‡è·å–ã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">async <span style="color:#719e07">for</span> post <span style="color:#719e07">in</span> Post:
    <span style="color:#719e07">print</span>(post)
<span style="color:#586e75"># &lt;Post object at 1&gt;</span>
<span style="color:#586e75"># &lt;Post object at 2&gt;</span>
<span style="color:#586e75"># &lt;Post object at 3&gt;</span>
<span style="color:#586e75"># &lt;Post object at 4&gt;</span>

users <span style="color:#719e07">=</span> User<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>where(User<span style="color:#719e07">.</span>id <span style="color:#719e07">&lt;</span> <span style="color:#2aa198">5</span>)<span style="color:#719e07">.</span>order_by(User<span style="color:#719e07">.</span>id<span style="color:#719e07">.</span>desc())
async <span style="color:#719e07">for</span> user <span style="color:#719e07">in</span> users:
    <span style="color:#719e07">print</span>(user)
<span style="color:#586e75"># &lt;User object at 4&gt;</span>
<span style="color:#586e75"># &lt;User object at 3&gt;</span>
<span style="color:#586e75"># &lt;User object at 2&gt;</span>
<span style="color:#586e75"># &lt;User object at 1&gt;</span>
</code></pre></div><h2 id="row-type">Row Type</h2>
<p>å½“ä½ ä½¿ç”¨ <code>select</code> è·å–æ•°æ®æ—¶ï¼Œ<a href="https://github.com/at7h/helo">helo</a> é»˜è®¤ä¼šå°†è¡Œæ•°æ®åŒ…è£…æˆä¸ºå¯¹åº”çš„ <code>Model</code> å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œå½“ä½ ä½¿ç”¨äº† <code>helo.F</code> å‡½æ•°å’Œ <code>join</code> æ—¶å¯èƒ½ä¼šæ”¾å¼ƒåŠ è½½åˆ° <code>Model</code> å¯¹è±¡è€Œä½¿ç”¨åŸå§‹çš„ <code>helo.adict</code> å­—å…¸ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>wrap</code> å‚æ•°æ¥æ˜¾å¼æŒ‡å®šä½¿ç”¨å­—å…¸ç±»å‹çš„ row typeã€‚<strong>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™å¯èƒ½ä¼šæ˜¾è‘—æé«˜é€Ÿåº¦å¹¶å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</strong></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">users <span style="color:#719e07">=</span> await User<span style="color:#719e07">.</span>select(User<span style="color:#719e07">.</span>id, User<span style="color:#719e07">.</span>name)<span style="color:#719e07">.</span>limit(<span style="color:#2aa198">2</span>)<span style="color:#719e07">.</span>all(wrap<span style="color:#719e07">=</span><span style="color:#268bd2">False</span>)
<span style="color:#719e07">print</span>(users)  <span style="color:#586e75"># [{&#39;id&#39;: 1, &#39;name&#39;: &#39;at7h&#39;}, {&#39;id&#39;: 2, &#39;name&#39;: &#39;bobo&#39;}]</span>
<span style="color:#719e07">assert</span> users[<span style="color:#2aa198">0</span>]<span style="color:#719e07">.</span>name <span style="color:#719e07">==</span> <span style="color:#2aa198">&#39;at7h&#39;</span>

employee <span style="color:#719e07">=</span> await Employee<span style="color:#719e07">.</span>select()<span style="color:#719e07">.</span>order_by(
    Employee<span style="color:#719e07">.</span>salary<span style="color:#719e07">.</span>desc()
)<span style="color:#719e07">.</span>first(<span style="color:#268bd2">False</span>)
<span style="color:#719e07">print</span>(employee)
<span style="color:#586e75"># {&#39;id&#39;: 1, &#39;name&#39;: &#39;at7h&#39;, &#39;department&#39;: 1, &#39;salary&#39;: 15000.0}</span>
</code></pre></div><h2 id="sql">SQL</h2>
<h3 id="æ‰§è¡Œ-sql">æ‰§è¡Œ SQL</h3>
<p>æœ‰æ—¶ä½ å¯èƒ½è¿«ä¸å¾—å·²æƒ³è¦æ‰§è¡Œä¸€äº›åŸå§‹çš„ SQL è¯­å¥ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ <code>db.raw</code> å‡½æ•°æ¥å®ç°ã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">await db<span style="color:#719e07">.</span>raw(<span style="color:#2aa198">&#34;SELECT * FROM `user` WHERE `id` &lt; </span><span style="color:#2aa198">%s</span><span style="color:#2aa198">;&#34;</span>, params<span style="color:#719e07">=</span>[<span style="color:#2aa198">10</span>])
</code></pre></div><h3 id="æŸ¥çœ‹-sql">æŸ¥çœ‹ SQL</h3>
<p>ä¸ºæ–¹ä¾¿è°ƒè¯•ï¼Œæœ‰æ—¶å€™éœ€è¦æŸ¥çœ‹æ‰§è¡Œçš„ SQLï¼Œåœ¨ <a href="https://github.com/at7h/helo">helo</a> ä¸­ï¼Œä½ å¯ä»¥:</p>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨åˆå§‹åŒ– <code>db</code> æ—¶ï¼Œè®¾ç½® <code>debug</code> ä¸º <code>True</code> å³å¯ï¼Œè¿™æ ·ä½ å°†åœ¨æ—¥å¿—è¾“å‡ºä¸­çœ‹åˆ°æ‰§è¡Œè¿‡çš„æ‰€æœ‰ SQL è¯­å¥ã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">db <span style="color:#719e07">=</span> helo<span style="color:#719e07">.</span>G(debug<span style="color:#719e07">=</span><span style="color:#268bd2">True</span>)
</code></pre></div><p>ç¬¬äºŒç§æ–¹å¼ä¸»è¦æ˜¯æ–¹ä¾¿å­¦ä¹ å’Œè°ƒè¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>repr</code> å‡½æ•°(æˆ–åœ¨ REPR ç¯å¢ƒä¸­)å’Œ <code>str</code> å‡½æ•°æ¥æŸ¥çœ‹ <code>Insert</code>, <code>Update</code>, <code>Select</code> ç­‰å¯¹è±¡ï¼Œæˆ‘ä»¬æ‹¿ä¸Šé¢çš„ç¤ºä¾‹æ¥ä¸¾ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#719e07">&gt;&gt;&gt;</span> q1 <span style="color:#719e07">=</span> Employee<span style="color:#719e07">.</span>update(
<span style="color:#719e07">...</span>     salary<span style="color:#719e07">=</span>Employee<span style="color:#719e07">.</span>salary <span style="color:#719e07">+</span> <span style="color:#2aa198">1000</span>
<span style="color:#719e07">...</span> )<span style="color:#719e07">.</span>where(
<span style="color:#719e07">...</span>    (Employee<span style="color:#719e07">.</span>department<span style="color:#719e07">.</span>in_([<span style="color:#2aa198">1</span>, <span style="color:#2aa198">2</span>])) <span style="color:#719e07">|</span> (Employee<span style="color:#719e07">.</span>name <span style="color:#719e07">==</span> <span style="color:#2aa198">&#39;at7h&#39;</span>)
<span style="color:#719e07">...</span> )
<span style="color:#719e07">&gt;&gt;&gt;</span> q1
Query(UPDATE <span style="color:#586e75">`employee`</span> SET <span style="color:#586e75">`salary`</span> <span style="color:#719e07">=</span> (<span style="color:#586e75">`salary`</span> <span style="color:#719e07">+</span> <span style="color:#719e07">%</span>s) WHERE ((<span style="color:#586e75">`department`</span> IN <span style="color:#719e07">%</span>s) OR (<span style="color:#586e75">`name`</span> <span style="color:#719e07">=</span> <span style="color:#719e07">%</span>s)); <span style="color:#719e07">%</span> ((<span style="color:#2aa198">1000.0</span>,), (<span style="color:#2aa198">1</span>, <span style="color:#2aa198">2</span>), <span style="color:#2aa198">&#39;at7h&#39;</span>))

<span style="color:#719e07">&gt;&gt;&gt;</span> q2 <span style="color:#719e07">=</span> User<span style="color:#719e07">.</span>select(
<span style="color:#719e07">...</span>     User<span style="color:#719e07">.</span>name, helo<span style="color:#719e07">.</span>F<span style="color:#719e07">.</span>COUNT(helo<span style="color:#719e07">.</span>SQL(<span style="color:#2aa198">&#39;1&#39;</span>))<span style="color:#719e07">.</span>as_(<span style="color:#2aa198">&#39;posts&#39;</span>)
<span style="color:#719e07">...</span> )<span style="color:#719e07">.</span>join(
<span style="color:#719e07">...</span>     Post, helo<span style="color:#719e07">.</span>JOINTYPE<span style="color:#719e07">.</span>LEFT, on<span style="color:#719e07">=</span>(User<span style="color:#719e07">.</span>id <span style="color:#719e07">==</span> Post<span style="color:#719e07">.</span>author)
<span style="color:#719e07">...</span> )<span style="color:#719e07">.</span>group_by(
<span style="color:#719e07">...</span>     User<span style="color:#719e07">.</span>name
<span style="color:#719e07">...</span> )
<span style="color:#719e07">&gt;&gt;&gt;</span> <span style="color:#719e07">print</span>(q2)
SELECT <span style="color:#586e75">`t1`</span><span style="color:#719e07">.</span><span style="color:#586e75">`name`</span>, COUNT(<span style="color:#2aa198">1</span>) AS <span style="color:#586e75">`posts`</span> FROM <span style="color:#586e75">`user`</span> AS <span style="color:#586e75">`t1`</span> LEFT JOIN <span style="color:#586e75">`post`</span> AS <span style="color:#586e75">`t2`</span> ON (<span style="color:#586e75">`t1`</span><span style="color:#719e07">.</span><span style="color:#586e75">`id`</span> <span style="color:#719e07">=</span> <span style="color:#586e75">`t2`</span><span style="color:#719e07">.</span><span style="color:#586e75">`author`</span>) GROUP BY <span style="color:#586e75">`t1`</span><span style="color:#719e07">.</span><span style="color:#586e75">`name`</span>; <span style="color:#719e07">%</span> ()
</code></pre></div><p>æœ¬ç¯‡ä¸Šæ‰‹æŒ‡å—å°±åˆ°æ­¤ç»“æŸã€‚</p>
<p><strong>ååˆ†æ¬¢è¿å¤§å®¶çš„ä½¿ç”¨ï¼Œæœ‰ä»»ä½•é—®é¢˜å¯éšæ—¶ä¸æˆ‘äº¤æµæˆ–åˆ° <a href="https://github.com/at7h/helo">é¡¹ç›®ä»“åº“</a> åé¦ˆï¼Œæ¬¢è¿ä»¥ä»»ä½•å½¢å¼æå‡ºä»»ä½•é—®é¢˜æˆ–å»ºè®®ã€‚</strong></p>
<p>æ„Ÿè°¢ ğŸ¤</p>

		</div>
		<br>
		
		
		<hr>
			<footer class="post__footer">
				
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/orm/" rel="tag">orm</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/asyncio/" rel="tag">asyncio</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/mysql/" rel="tag">MySQL</a></li>
	</ul>
</div>
			</footer>
		
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<a href="/about">
			<img alt="å…³äº feileo avatar" src="https://cdn.at7h.com/img/avatar.jpg" class="avatar" height="90"
				width="90">
		</a>
	</figure>
	<div class="authorbox__header">
		<a href="/about">
			<span class="authorbox__name">å…³äº feileo</span>
		</a>
	</div>
	<div class="authorbox__description">
		You may say I&#39;m a dreamer, but I&#39;m not the only one.
	</div>
	<div class="authorbox__description_sub">
		--John Winston Lennon ã€ŠImagineã€‹
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/posts/go-null/" rel="prev"><span class="post-nav__caption">Â«&thinsp;ä¸Šä¸€ç¯‡</span><p class="post-nav__post-title">Golang é›¶å€¼ã€ç©ºå€¼ä¸ç©ºç»“æ„</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/posts/gc-in-py/" rel="next"><span class="post-nav__caption">ä¸‹ä¸€ç¯‡&thinsp;Â»</span><p class="post-nav__post-title">GC æœºåˆ¶æ¢ç©¶ä¹‹ Python ç¯‡</p></a>
	</div>
</nav>

<section class="comments">
    <div id="utter-container"></div>
    <script src="https://utteranc.es/client.js"
        repo= 'feileo/feileo.github.io'
        issue-term= "pathname"
        theme= 'github-light'
        crossorigin= "anonymous",
        label='âœ¨ğŸ’¬âœ¨'
        async>
	</script> 
</section>



			</div>
			
		</div>
		<footer class="footer">
	<div>
		
		<div class="footer__copyright">
			<div class="footer__text">
				<p>æœ¬åšå®¢åŸºäº <a href="https://golang.google.cn/" target="_blank"> Golang </a> + <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> +  <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> æ„å»º</p>
        <p>æœ¬ç«™ç”± <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img width="50" src="https://cdn.at7h.com/img/upyun_logo.png"></a> æä¾› CDN åŠ é€Ÿ/é™æ€èµ„æºå­˜å‚¨æœåŠ¡</p>
				<p>ç”± <a href="https://utteranc.es/" target="_blank"><img width="19" src="https://cdn.at7h.com/img/utteranc.png"> utterances</a> æä¾›è¯„è®ºç³»ç»Ÿ</p>
				<p>
					<span id="busuanzi_container_site_pv">
						æœ¬ç«™è¿è¡Œè‡ª 2020-10-01,
						ç´¯è®¡ PV
						1<span id="busuanzi_value_site_pv"><img width="16" src="https://cdn.at7h.com/img/spinner.png" /></span>
					</span>,
					<span id="busuanzi_container_site_uv">
						UV <span id="busuanzi_value_site_uv"><img width="16" src="https://cdn.at7h.com/img/spinner.png" /></span>
					</span>
				</p>
		<p>
			<a target="_blank" href="/sitemap.xml">ç«™ç‚¹åœ°å›¾</a> &nbsp;Â·&nbsp; 
			<a target="_blank" href="/index.xml" type="application/rss+xml" title="rss"> RSS 
			</a>
		</p>
        <p>ç‰ˆæƒæ‰€æœ‰ &copy; 2021 at7h.com</p>
        

			</div>
		</div>
		<div class="footer__text__sub">
			<a target="_blank" href="http://beian.miit.gov.cn">äº¬ ICP å¤‡ 2020037066 å· - 1</a>
			<br>
			<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61092802000118">
				<img style="vertical-align: text-bottom;" width="18" src="https://cdn.at7h.com/img/beian.png">
				é™•å…¬ç½‘å®‰å¤‡ 61092802000118 å·
      </a>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
