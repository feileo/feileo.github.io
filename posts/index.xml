<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on feileo</title>
    <link>https://at7h.com/posts/</link>
    <description>Recent content in Posts on feileo</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 17 Sep 2020 00:00:00 +0000</lastBuildDate>
    
	<atom:link href="https://at7h.com/posts/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>èµ°è¿› Python ç±»çš„å†…éƒ¨</title>
      <link>https://at7h.com/posts/py-classes/</link>
      <pubDate>Thu, 17 Sep 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/py-classes/</guid>
      <description>è¿™ç¯‡æ–‡ç« å’Œå¤§å®¶ä¸€èµ·èŠä¸€èŠ Python 3.8 ä¸­ç±»å’Œå¯¹è±¡èƒŒåçš„ä¸€äº›æ¦‚å¿µå’Œå®ç°åŸç†ï¼Œä¸»è¦å°è¯•è§£é‡Š Python ç±»å’Œå¯¹è±¡å±æ€§çš„å­˜å‚¨ï¼Œå‡½æ•°å’Œæ–¹æ³•ï¼Œæè¿°å™¨ï¼Œå¯¹è±¡å†…å­˜å ç”¨çš„ä¼˜åŒ–æ”¯æŒï¼Œä»¥åŠç»§æ‰¿ä¸å±æ€§æŸ¥æ‰¾ç­‰ç›¸å…³é—®é¢˜ã€‚ è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼š class Employee: outsource = False def __init__(self, department, name): self.department = department self.name = name @property def inservice(self): return self.department is not None def __repr__(self): return f&amp;#34;&amp;lt;Employee: {self.department}-{self.name}&amp;gt;&amp;#34; employee = Employee(&amp;#39;IT&amp;#39;, &amp;#39;bobo&amp;#39;) employee å¯¹è±¡æ˜¯ Employee ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒæœ‰ä¸¤ä¸ªå±æ€§ department å’Œ nameï¼Œå…¶å€¼å±äºè¯¥å®ä¾‹ã€‚outsource æ˜¯ç±»å±æ€§ï¼Œæ‰€æœ‰è€…æ˜¯ç±»ï¼Œè¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡å…±äº«æ­¤å±æ€§å€¼ï¼Œè¿™è·Ÿå…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸€è‡´ã€‚ æ›´æ”¹ç±»å˜é‡ä¼šå½±å“åˆ°è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡ï¼š &amp;gt;&amp;gt;&amp;gt; e1 = Employee(&amp;#39;IT&amp;#39;, &amp;#39;bobo&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e2 = Employee(&amp;#39;HR&amp;#39;, &amp;#39;cici&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e1.outsource, e2.outsource (False, False) &amp;gt;&amp;gt;&amp;gt; Employee.outsource = True &amp;gt;&amp;gt;&amp;gt; e1.outsource, e2.outsource &amp;gt;&amp;gt;&amp;gt; (True, True) è¿™ä»…é™äºä»ç±»æ›´æ”¹ï¼Œå½“æˆ‘ä»¬ä»å®ä¾‹æ›´æ”¹ç±»å˜é‡æ—¶ï¼š &amp;gt;&amp;gt;&amp;gt; e1 = Employee(&amp;#39;IT&amp;#39;, &amp;#39;bobo&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e2 = Employee(&amp;#39;HR&amp;#39;, &amp;#39;cici&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e1.outsource, e2.outsource (False, False) &amp;gt;&amp;gt;&amp;gt; e1.outsource = True &amp;gt;&amp;gt;&amp;gt; e1.outsource, e2.outsource (True, False) æ˜¯çš„ï¼Œå½“ä½ è¯•å›¾ä»å®ä¾‹å¯¹è±¡ä¿®æ”¹ç±»å˜é‡æ—¶ï¼ŒPython ä¸ä¼šæ›´æ”¹è¯¥ç±»çš„ç±»å˜é‡å€¼ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªåŒåçš„å®ä¾‹å±æ€§ï¼Œè¿™æ˜¯éå¸¸æ­£ç¡®ä¸”å®‰å…¨çš„ã€‚åœ¨æœç´¢å±æ€§å€¼æ—¶ï¼Œå®ä¾‹å˜é‡ä¼šä¼˜å…ˆäºç±»å˜é‡ï¼Œè¿™å°†åœ¨ç»§æ‰¿ä¸å±æ€§æŸ¥æ‰¾ä¸€èŠ‚ä¸­è¯¦ç»†è§£é‡Šã€‚ å€¼å¾—ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå½“ç±»å˜é‡çš„ç±»å‹æ˜¯å¯å˜ç±»å‹æ—¶ï¼Œä½ æ˜¯ä»å®ä¾‹å¯¹è±¡ä¸­æ›´æ”¹çš„å®ƒä»¬çš„ï¼š &amp;gt;&amp;gt;&amp;gt; class S: ... L = [1, 2] ... &amp;gt;&amp;gt;&amp;gt; s1, s2 = S(), S() &amp;gt;&amp;gt;&amp;gt; s1.L, s2.L ([1, 2], [1, 2]) &amp;gt;&amp;gt;&amp;gt; t1.L.append(3) &amp;gt;&amp;gt;&amp;gt; t1.L, s2.L ([1, 2, 3], [1, 2, 3]) å¥½çš„å®è·µæ–¹å¼æ˜¯åº”å½“å°½é‡çš„é¿å…è¿™æ ·çš„è®¾è®¡ã€‚ å±æ€§çš„å­˜å‚¨ æœ¬å°èŠ‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ Python ä¸­çš„ç±»å±æ€§ã€æ–¹æ³•åŠå®ä¾‹å±æ€§æ˜¯å¦‚ä½•å…³è”å­˜å‚¨çš„ã€‚ å®ä¾‹å±æ€§ åœ¨ Python ä¸­ï¼Œæ‰€æœ‰å®ä¾‹å±æ€§éƒ½å­˜å‚¨åœ¨ __dict__ å­—å…¸ä¸­ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¸¸è§„çš„ dictï¼Œå¯¹äºå®ä¾‹å±æ€§çš„ç»´æŠ¤å³æ˜¯ä»è¯¥å­—å…¸ä¸­è·å–å’Œä¿®æ”¹ï¼Œå®ƒå¯¹å¼€å‘è€…æ˜¯å®Œå…¨å¼€æ”¾çš„ã€‚ &amp;gt;&amp;gt;&amp;gt; e = Employee(&amp;#39;IT&amp;#39;, &amp;#39;bobo&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e.__dict__ {&amp;#39;department&amp;#39;: &amp;#39;IT&amp;#39;, &amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;} &amp;gt;&amp;gt;&amp;gt; type(e.__dict__) dict &amp;gt;&amp;gt;&amp;gt; e.name is e.__dict__[&amp;#39;name&amp;#39;] True &amp;gt;&amp;gt;&amp;gt; e.__dict__[&amp;#39;department&amp;#39;] = &amp;#39;HR&amp;#39; &amp;gt;&amp;gt;&amp;gt; e.department &amp;#39;HR&amp;#39; æ­£å› ä¸ºå®ä¾‹å±æ€§æ˜¯é‡‡ç”¨å­—å…¸æ¥å­˜å‚¨ï¼Œæ‰€ä»¥ä»»ä½•æ—¶å€™æˆ‘ä»¬éƒ½å¯ä»¥æ–¹ä¾¿çš„ç»™å¯¹è±¡æ·»åŠ æˆ–åˆ é™¤å­—æ®µï¼š &amp;gt;&amp;gt;&amp;gt; e.age = 30 # å¹¶æ²¡æœ‰å®šä¹‰ age å±æ€§ &amp;gt;&amp;gt;&amp;gt; e.age 30 &amp;gt;&amp;gt;&amp;gt; e.__dict__ {&amp;#39;department&amp;#39;: &amp;#39;IT&amp;#39;, &amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;, &amp;#39;age&amp;#39;: 30} &amp;gt;&amp;gt;&amp;gt; del e.age &amp;gt;&amp;gt;&amp;gt; e.__dict__ {&amp;#39;department&amp;#39;: &amp;#39;IT&amp;#39;, &amp;#39;name&amp;#39;: &amp;#39;d&amp;#39;} æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»å­—å…¸ä¸­å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ–è€…é€šè¿‡ä¿å­˜å®ä¾‹çš„ __dict__ æ¥æ¢å¤å®ä¾‹ã€‚ &amp;gt;&amp;gt;&amp;gt; def new_employee_from(d): ... instance = object.__new__(Employee) ... instance.__dict__.update(d) ... return instance ... &amp;gt;&amp;gt;&amp;gt; e1 = new_employee_from({&amp;#39;department&amp;#39;: &amp;#39;IT&amp;#39;, &amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;}) &amp;gt;&amp;gt;&amp;gt; e1 &amp;lt;Employee: IT-bobo&amp;gt; &amp;gt;&amp;gt;&amp;gt; state = e1.__dict__.copy() &amp;gt;&amp;gt;&amp;gt; del e1 &amp;gt;&amp;gt;&amp;gt; e2 = new_employee_from(state) &amp;gt;&amp;gt;&amp;gt; e2 &amp;gt;&amp;gt;&amp;gt; &amp;lt;Employee: IT-bobo&amp;gt; å› ä¸º __dict__ çš„å®Œå…¨å¼€æ”¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­æ·»åŠ ä»»ä½• immutable ç±»å‹çš„ keyï¼Œæ¯”å¦‚æ•°å­—ï¼š &amp;gt;&amp;gt;&amp;gt; e.__dict__[1] = 1 &amp;gt;&amp;gt;&amp;gt; e.__dict__ {&amp;#39;department&amp;#39;: &amp;#39;IT&amp;#39;, &amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;, 1: 1} è¿™äº›éå­—ç¬¦ä¸²çš„å­—æ®µæ˜¯æˆ‘ä»¬æ— æ³•é€šè¿‡å®ä¾‹å¯¹è±¡è®¿é—®çš„ï¼Œä¸ºäº†ç¡®ä¿ä¸ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œé™¤éå¿…è¦çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬æœ€å¥½ä¸è¦ç›´æ¥å¯¹ __dict__ è¿›è¡Œå†™æ“ä½œï¼Œç”šè‡³ä¸è¦ç›´æ¥æ“ä½œ __dict__ã€‚ æ‰€ä»¥æœ‰ä¸€ç§è¯´æ³•æ˜¯ Python is a &amp;ldquo;consenting adults language&amp;rdquo;ã€‚ è¿™ç§åŠ¨æ€çš„å®ç°ä½¿å¾—æˆ‘ä»¬çš„ä»£ç éå¸¸çµæ´»ï¼Œå¾ˆå¤šæ—¶å€™éå¸¸çš„ä¾¿åˆ©ï¼Œä½†è¿™ä¹Ÿä»˜å‡ºäº†å­˜å‚¨å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ã€‚æ‰€ä»¥ Python ä¹Ÿæä¾›äº†å¦å¤–ä¸€ç§æœºåˆ¶(__slots__)æ¥æ”¾å¼ƒä½¿ç”¨ __dict__ï¼Œä»¥èŠ‚çº¦å†…å­˜ï¼Œæé«˜æ€§èƒ½ï¼Œè¯¦è§ __slots__ ä¸€èŠ‚ã€‚ ç±»å±æ€§ åŒæ ·çš„ï¼Œç±»å±æ€§ä¹Ÿåœ¨å­˜å‚¨åœ¨ç±»çš„ __dict__ å­—å…¸ä¸­ï¼š &amp;gt;&amp;gt;&amp;gt; Employee.__dict__ mappingproxy({&amp;#39;__module__&amp;#39;: &amp;#39;__main__&amp;#39;, &amp;#39;outsource&amp;#39;: True, &amp;#39;__init__&amp;#39;: &amp;lt;function __main__.Employee.__init__(self, department, name)&amp;gt;, &amp;#39;inservice&amp;#39;: &amp;lt;property at 0x108419ea0&amp;gt;, &amp;#39;__repr__&amp;#39;: &amp;lt;function __main__.Employee.__repr__(self)&amp;gt;, &amp;#39;__str__&amp;#39;: &amp;lt;function __main__.Employee.__str__(self)&amp;gt;, &amp;#39;__dict__&amp;#39;: &amp;lt;attribute &amp;#39;__dict__&amp;#39; of &amp;#39;Employee&amp;#39; objects&amp;gt;, &amp;#39;__weakref__&amp;#39;: &amp;lt;attribute &amp;#39;__weakref__&amp;#39; of &amp;#39;Employee&amp;#39; objects&amp;gt;, &amp;#39;__doc__&amp;#39;: None} &amp;gt;&amp;gt;&amp;gt; type(Employee.__dict__) mappingproxy ä¸å®ä¾‹å­—å…¸çš„ã€å¼€æ”¾ã€ä¸åŒï¼Œç±»å±æ€§ä½¿ç”¨çš„å­—å…¸æ˜¯ä¸€ä¸ª MappingProxyType å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸èƒ½ setattr çš„å­—å…¸ã€‚è¿™æ„å‘³ç€å®ƒå¯¹å¼€å‘è€…æ˜¯åªè¯»çš„ï¼Œå…¶ç›®çš„æ­£æ˜¯ä¸ºäº†ä¿è¯ç±»å±æ€§çš„é”®éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä»¥ç®€åŒ–å’ŒåŠ å¿«æ–°å‹ç±»å±æ€§çš„æŸ¥æ‰¾å’Œ __mro__ çš„æœç´¢é€»è¾‘ã€‚ &amp;gt;&amp;gt;&amp;gt; Employee.__dict__[&amp;#39;outsource&amp;#39;] = False TypeError: &amp;#39;mappingproxy&amp;#39; object does not support item assignment å› ä¸ºæ‰€æœ‰çš„æ–¹æ³•éƒ½å½’å±äºä¸€ä¸ªç±»ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿå­˜å‚¨åœ¨ç±»çš„å­—å…¸ä¸­ï¼Œä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°å·²æœ‰çš„ __init__ å’Œ __repr__ æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥å†æ·»åŠ å‡ ä¸ªæ¥éªŒè¯ï¼š class Employee: # ... @staticmethod def soo(): pass @classmethod def coo(cls): pass def foo(self): pass &amp;gt;&amp;gt;&amp;gt; Employee.__dict__ mappingproxy({&amp;#39;__module__&amp;#39;: &amp;#39;__main__&amp;#39;, &amp;#39;outsource&amp;#39;: False, &amp;#39;__init__&amp;#39;: &amp;lt;function __main__.Employee.__init__(self, department, name)&amp;gt;, &amp;#39;__repr__&amp;#39;: &amp;lt;function __main__.Employee.__repr__(self)&amp;gt;, &amp;#39;inservice&amp;#39;: &amp;lt;property at 0x108419ea0&amp;gt;, &amp;#39;soo&amp;#39;: &amp;lt;staticmethod at 0x1066ce588&amp;gt;, &amp;#39;coo&amp;#39;: &amp;lt;classmethod at 0x1066ce828&amp;gt;, &amp;#39;foo&amp;#39;: &amp;lt;function __main__.Employee.foo(self)&amp;gt;, &amp;#39;__dict__&amp;#39;: &amp;lt;attribute &amp;#39;__dict__&amp;#39; of &amp;#39;Employee&amp;#39; objects&amp;gt;, &amp;#39;__weakref__&amp;#39;: &amp;lt;attribute &amp;#39;__weakref__&amp;#39; of &amp;#39;Employee&amp;#39; objects&amp;gt;, &amp;#39;__doc__&amp;#39;: None}) ç»§æ‰¿ä¸å±æ€§æŸ¥æ‰¾ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œæ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•éƒ½å­˜å‚¨åœ¨ä¸¤ä¸ª __dict__ å­—å…¸ä¸­ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ Python æ˜¯å¦‚ä½•è¿›è¡Œå±æ€§æŸ¥æ‰¾çš„ã€‚ Python 3 ä¸­ï¼Œæ‰€æœ‰ç±»éƒ½éšå¼çš„ç»§æ‰¿è‡ª objectï¼Œæ‰€ä»¥æ€»ä¼šæœ‰ä¸€ä¸ªç»§æ‰¿å…³ç³»ï¼Œè€Œä¸” Python æ˜¯æ”¯æŒå¤šç»§æ‰¿çš„ï¼š &amp;gt;&amp;gt;&amp;gt; class A: ... pass ... &amp;gt;&amp;gt;&amp;gt; class B: ... pass ... &amp;gt;&amp;gt;&amp;gt; class C(B): ... pass ... &amp;gt;&amp;gt;&amp;gt; class D(A, C): ... pass ... &amp;gt;&amp;gt;&amp;gt; D.mro() [&amp;lt;class &amp;#39;__main__.D&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;__main__.A&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;__main__.C&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;__main__.B&amp;#39;&amp;gt;, &amp;lt;class &amp;#39;object&amp;#39;&amp;gt;] mro() æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•ï¼Œå®ƒè¿”å›ç±»çš„çº¿æ€§è§£æé¡ºåºã€‚ å±æ€§è®¿é—®çš„é»˜è®¤è¡Œä¸ºæ˜¯ä»å¯¹è±¡çš„å­—å…¸ä¸­è·å–ã€è®¾ç½®æˆ–åˆ é™¤å±æ€§ï¼Œä¾‹å¦‚å¯¹äº e.f çš„æŸ¥æ‰¾ç®€å•æè¿°æ˜¯: e.f çš„æŸ¥æ‰¾é¡ºåºä¼šä» e.__dict__[&#39;f&#39;] å¼€å§‹ï¼Œç„¶åæ˜¯ type(e).__dict__[&#39;f&#39;]ï¼Œæ¥ä¸‹æ¥ä¾æ¬¡æŸ¥æ‰¾ type(e) çš„åŸºç±»ï¼ˆ__mro__ é¡ºåºï¼Œä¸åŒ…æ‹¬å…ƒç±»ï¼‰ã€‚ å¦‚æœæ‰¾åˆ°çš„å€¼æ˜¯å®šä¹‰äº†æŸä¸ªæè¿°å™¨æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™ Python å¯èƒ½ä¼šé‡è½½é»˜è®¤è¡Œä¸ºå¹¶è½¬è€Œå‘èµ·è°ƒç”¨æè¿°å™¨æ–¹æ³•ã€‚è¿™å…·ä½“å‘ç”Ÿåœ¨ä¼˜å…ˆçº§é“¾çš„å“ªä¸ªç¯èŠ‚åˆ™è¦æ ¹æ®æ‰€å®šä¹‰çš„æè¿°å™¨æ–¹æ³•åŠå…¶è¢«è°ƒç”¨çš„æ–¹å¼æ¥å†³å®šã€‚ æ‰€ä»¥ï¼Œè¦ç†è§£æŸ¥æ‰¾çš„é¡ºåºï¼Œä½ å¿…é¡»è¦å…ˆäº†è§£æè¿°å™¨åè®®ã€‚ ç®€å•æ€»ç»“ï¼Œæœ‰ä¸¤ç§æè¿°å™¨ç±»å‹ï¼šæ•°æ®æè¿°å™¨å’Œå’Œéæ•°æ®æè¿°å™¨ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡é™¤äº†å®šä¹‰ __get__() ä¹‹å¤–è¿˜å®šä¹‰äº† __set__() æˆ– __delete__()ï¼Œåˆ™å®ƒä¼šè¢«è§†ä¸ºæ•°æ®æè¿°å™¨ã€‚ä»…å®šä¹‰äº† __get__() çš„æè¿°å™¨ç§°ä¸ºéæ•°æ®æè¿°å™¨ï¼ˆå®ƒä»¬é€šå¸¸è¢«ç”¨äºæ–¹æ³•ï¼Œä½†ä¹Ÿå¯ä»¥æœ‰å…¶ä»–ç”¨é€”) ç”±äºå‡½æ•°åªå®ç° __get__ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯éæ•°æ®æè¿°å™¨ã€‚ Python çš„å¯¹è±¡å±æ€§æŸ¥æ‰¾é¡ºåºå¦‚ä¸‹ï¼š ç±»å’Œçˆ¶ç±»å­—å…¸çš„æ•°æ®æè¿°å™¨ å®ä¾‹å­—å…¸ ç±»å’Œçˆ¶ç±»å­—å…¸ä¸­çš„éæ•°æ®æè¿°å™¨ è¯·è®°ä½ï¼Œæ— è®ºä½ çš„ç±»æœ‰å¤šå°‘ä¸ªç»§æ‰¿çº§åˆ«ï¼Œè¯¥ç±»å¯¹è±¡çš„å®ä¾‹å­—å…¸æ€»æ˜¯å­˜å‚¨äº†æ‰€æœ‰çš„å®ä¾‹å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯ super çš„æ„ä¹‰ä¹‹ä¸€ã€‚ ä¸‹é¢æˆ‘ä»¬å°è¯•ç”¨ä¼ªä»£ç æ¥æè¿°æŸ¥æ‰¾é¡ºåºï¼š def get_attribute(obj, name): class_definition = obj.__class__ descriptor = None for cls in class_definition.mro(): if name in cls.__dict__: descriptor = cls.__dict__[name] break if hasattr(descriptor, &amp;#39;__set__&amp;#39;): return descriptor, &amp;#39;data descriptor&amp;#39; if name in obj.__dict__: return obj.__dict__[name], &amp;#39;instance attribute&amp;#39; if descriptor is not None: return descriptor, &amp;#39;non-data descriptor&amp;#39; else: raise AttributeError &amp;gt;&amp;gt;&amp;gt; e = Employee(&amp;#39;IT&amp;#39;, &amp;#39;bobo&amp;#39;) &amp;gt;&amp;gt;&amp;gt; get_attribute(e, &amp;#39;outsource&amp;#39;) (False, &amp;#39;non-data descriptor&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e.outsource = True &amp;gt;&amp;gt;&amp;gt; get_attribute(e, &amp;#39;outsource&amp;#39;) (True, &amp;#39;instance attribute&amp;#39;) &amp;gt;&amp;gt;&amp;gt; get_attribute(e, &amp;#39;name&amp;#39;) (&amp;#39;bobo&amp;#39;, &amp;#39;instance attribute&amp;#39;) &amp;gt;&amp;gt;&amp;gt; get_attribute(e, &amp;#39;inservice&amp;#39;) (&amp;lt;property at 0x10c966d10&amp;gt;, &amp;#39;data descriptor&amp;#39;) &amp;gt;&amp;gt;&amp;gt; get_attribute(e, &amp;#39;foo&amp;#39;) (&amp;lt;function __main__.Employee.foo(self)&amp;gt;, &amp;#39;non-data descriptor&amp;#39;) ç”±äºè¿™æ ·çš„ä¼˜å…ˆçº§é¡ºåºï¼Œæ‰€ä»¥å®ä¾‹æ˜¯ä¸èƒ½é‡è½½ç±»çš„æ•°æ®æè¿°å™¨å±æ€§çš„ï¼Œæ¯”å¦‚ property å±æ€§ï¼š &amp;gt;&amp;gt;&amp;gt; class Manager(Employee): ... def __init__(self, *arg): ... self.inservice = True ... super().__init__(*arg) ... &amp;gt;&amp;gt;&amp;gt; m = Manager(&amp;#34;HR&amp;#34;, &amp;#34;cici&amp;#34;) AttributeError: can&amp;#39;t set attribute å‘èµ·æè¿°å™¨è°ƒç”¨ ä¸Šé¢è®²åˆ°ï¼Œåœ¨æŸ¥æ‰¾å±æ€§æ—¶ï¼Œå¦‚æœæ‰¾åˆ°çš„å€¼æ˜¯å®šä¹‰äº†æŸä¸ªæè¿°å™¨æ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™ Python å¯èƒ½ä¼šé‡è½½é»˜è®¤è¡Œä¸ºå¹¶è½¬è€Œå‘èµ·æè¿°å™¨æ–¹æ³•è°ƒç”¨ã€‚ æè¿°å™¨çš„ä½œç”¨å°±æ˜¯ç»‘å®šå¯¹è±¡å±æ€§ï¼Œæˆ‘ä»¬å‡è®¾ a æ˜¯ä¸€ä¸ªå®ç°äº†æè¿°å™¨åè®®çš„å¯¹è±¡ï¼Œå¯¹ e.a å‘èµ·æè¿°å™¨è°ƒç”¨æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š ç›´æ¥è°ƒç”¨ï¼šç”¨æˆ·çº§çš„ä»£ç ç›´æ¥è°ƒç”¨e.__get__(a)ï¼Œä¸å¸¸ç”¨ å®ä¾‹ç»‘å®šï¼šç»‘å®šåˆ°ä¸€ä¸ªå®ä¾‹ï¼Œe.a ä¼šè¢«è½¬æ¢ä¸ºè°ƒç”¨: type(e).__dict__[&#39;a&#39;].__get__(e, type(e)) ç±»ç»‘å®šï¼šç»‘å®šåˆ°ä¸€ä¸ªç±»ï¼ŒE.a ä¼šè¢«è½¬æ¢ä¸ºè°ƒç”¨: E.__dict__[&#39;a&#39;].__get__(None, E) åœ¨ç»§æ‰¿å…³ç³»ä¸­è¿›è¡Œç»‘å®šæ—¶ï¼Œä¼šæ ¹æ®ä»¥ä¸Šæƒ…å†µå’Œ __mro__ é¡ºåºæ¥å‘èµ·é“¾å¼è°ƒç”¨ã€‚ å‡½æ•°ä¸æ–¹æ³• æˆ‘ä»¬çŸ¥é“æ–¹æ³•æ˜¯å±äºç‰¹å®šç±»çš„å‡½æ•°ï¼Œå”¯ä¸€çš„ä¸åŒ(å¦‚æœå¯ä»¥ç®—æ˜¯ä¸åŒçš„è¯)æ˜¯æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¾€å¾€æ˜¯ä¸ºç±»æˆ–å®ä¾‹å¯¹è±¡ä¿ç•™çš„ï¼Œåœ¨ Python ä¸­ï¼Œæˆ‘ä»¬çº¦å®šä¸º cls æˆ– self, å½“ç„¶ä½ ä¹Ÿå¯ä»¥å–ä»»ä½•åå­—å¦‚ this(åªæ˜¯æœ€å¥½ä¸è¦è¿™æ ·åš)ã€‚ ä¸Šä¸€èŠ‚æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°å®ç°äº† __get__() æ–¹æ³•çš„å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯éæ•°æ®æè¿°å™¨ã€‚åœ¨ Python è®¿é—®(è°ƒç”¨)æ–¹æ³•æ”¯æŒä¸­æ­£æ˜¯é€šè¿‡è°ƒç”¨ __get__() å°†è°ƒç”¨çš„å‡½æ•°ç»‘å®šæˆæ–¹æ³•çš„ã€‚ åœ¨çº¯ Python ä¸­ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å¦‚ä¸‹(ç¤ºä¾‹æ¥è‡ªæè¿°å™¨ä½¿ç”¨æŒ‡å—): class Function: def __get__(self, obj, objtype=None): if obj is None: return self return types.MethodType(self, obj) # å°†å‡½æ•°ç»‘å®šä¸ºæ–¹æ³• åœ¨ Python 2 ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹æ³•: unbound method å’Œ bound methodï¼Œåœ¨ Python 3 ä¸­åªæœ‰åè€…ã€‚ bound method ä¸å®ƒä»¬ç»‘å®šçš„ç±»æˆ–å®ä¾‹æ•°æ®ç›¸å…³è”ï¼š &amp;gt;&amp;gt;&amp;gt; Employee.coo &amp;lt;bound method Employee.coo of &amp;lt;class &amp;#39;__main__.Employee&amp;#39;&amp;gt;&amp;gt; &amp;gt;&amp;gt;&amp;gt; Employee.foo &amp;lt;function __main__.Employee.foo(self)&amp;gt; &amp;gt;&amp;gt;&amp;gt; e = Employee(&amp;#39;IT&amp;#39;, &amp;#39;bobo&amp;#39;) &amp;gt;&amp;gt;&amp;gt; e.foo &amp;lt;bound method Employee.foo of &amp;lt;Employee: IT-bobo&amp;gt;&amp;gt; æˆ‘ä»¬å¯ä»¥ä»æ–¹æ³•æ¥è®¿é—®å®ä¾‹ä¸ç±»ï¼š &amp;gt;&amp;gt;&amp;gt; e.foo.__self__ &amp;lt;Employee: IT-bobo&amp;gt; &amp;gt;&amp;gt;&amp;gt; e.foo.__self__.__class__ __main__.Employee å€ŸåŠ©æè¿°ç¬¦åè®®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç±»çš„å¤–éƒ¨ä½œç”¨åŸŸæ‰‹åŠ¨ç»‘å®šä¸€ä¸ªå‡½æ•°åˆ°æ–¹æ³•ï¼Œä»¥è®¿é—®ç±»æˆ–å®ä¾‹ä¸­çš„æ•°æ®ï¼Œæˆ‘å°†ä»¥è¿™ä¸ªç¤ºä¾‹æ¥è§£é‡Šå½“ä½ çš„å¯¹è±¡è®¿é—®(è°ƒç”¨)ç±»å­—å…¸ä¸­å­˜å‚¨çš„å‡½æ•°æ—¶å°†å…¶ç»‘å®šæˆæ–¹æ³•(æ‰§è¡Œ)çš„è¿‡ç¨‹ï¼š ç°æœ‰ä»¥ä¸‹å‡½æ•°ï¼š &amp;gt;&amp;gt;&amp;gt; def f1(self): ... if isinstance(self, type): ... return self.outsource ... return self.name ... &amp;gt;&amp;gt;&amp;gt; bound_f1 = f1.__get__(e, Employee) # or bound_f1 = f1.__get__(e) &amp;gt;&amp;gt;&amp;gt; bound_f1 &amp;lt;bound method f1 of &amp;lt;Employee: IT-bobo&amp;gt;&amp;gt; &amp;gt;&amp;gt;&amp;gt; bound_f1.__self__ &amp;lt;Employee: IT-bobo&amp;gt; &amp;gt;&amp;gt;&amp;gt; bound_f1() &amp;#39;bobo&amp;#39; æ€»ç»“ä¸€ä¸‹ï¼šå½“æˆ‘ä»¬è°ƒç”¨ e.foo() æ—¶ï¼Œé¦–å…ˆä» Employee.__dict__[&#39;foo&#39;] ä¸­å¾—åˆ° foo å‡½æ•°ï¼Œåœ¨è°ƒç”¨è¯¥å‡½æ•°çš„ foo æ–¹æ³• foo.__get__(e) å°†å…¶è½¬æ¢æˆæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ foo() è·å¾—ç»“æœã€‚è¿™å°±å®Œæˆäº† e.foo() -&amp;gt; f(e) çš„è¿‡ç¨‹ã€‚ å¦‚æœä½ å¯¹æˆ‘çš„è§£é‡Šæ„Ÿåˆ°ç–‘æƒ‘ï¼Œæˆ‘å»ºè®®ä½ å¯ä»¥é˜…è¯»å®˜æ–¹çš„æè¿°å™¨ä½¿ç”¨æŒ‡å—ä»¥è¿›ä¸€æ­¥äº†è§£æè¿°å™¨åè®®ï¼Œåœ¨è¯¥æ–‡çš„å‡½æ•°å’Œæ–¹æ³•å’Œé™æ€æ–¹æ³•å’Œç±»æ–¹æ³•ä¸€èŠ‚ä¸­è¯¦ç»†äº†è§£å‡½æ•°ç»‘å®šä¸ºæ–¹æ³•çš„è¿‡ç¨‹ã€‚åŒæ—¶åœ¨ Python ç±»ä¸€æ–‡çš„æ–¹æ³•å¯¹è±¡ä¸€èŠ‚ä¸­ä¹Ÿæœ‰ç›¸å…³çš„è§£é‡Šã€‚ __slots__ Python çš„å¯¹è±¡å±æ€§å€¼éƒ½æ˜¯é‡‡ç”¨å­—å…¸å­˜å‚¨çš„ï¼Œå½“æˆ‘ä»¬å¤„ç†æ•°æˆåƒä¸Šä¸‡ç”šè‡³æ›´å¤šçš„å®ä¾‹æ—¶ï¼Œå†…å­˜æ¶ˆè€—å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºå­—å…¸å“ˆå¸Œè¡¨çš„å®ç°ï¼Œæ€»æ˜¯ä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»ºäº†å¤§é‡çš„å†…å­˜ã€‚æ‰€ä»¥ Python æä¾›äº†ä¸€ç§ __slots__ çš„æ–¹å¼æ¥ç¦ç”¨å®ä¾‹ä½¿ç”¨ __dict__ï¼Œä»¥ä¼˜åŒ–æ­¤é—®é¢˜ã€‚ é€šè¿‡ __slots__ æ¥æŒ‡å®šå±æ€§åï¼Œä¼šå°†å±æ€§çš„å­˜å‚¨ä»å®ä¾‹çš„ __dict__ æ”¹ä¸ºç±»çš„ __dict__ ä¸­ï¼š class Test: __slots__ = (&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;) def __init__(self, a, b): self.a = a self.b = b &amp;gt;&amp;gt;&amp;gt; t = Test(1, 2) &amp;gt;&amp;gt;&amp;gt; t.__dict__ AttributeError: &amp;#39;Test&amp;#39; object has no attribute &amp;#39;__dict__&amp;#39; &amp;gt;&amp;gt;&amp;gt; Test.__dict__ mappingproxy({&amp;#39;__module__&amp;#39;: &amp;#39;__main__&amp;#39;, &amp;#39;__slots__&amp;#39;: (&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;), &amp;#39;__init__&amp;#39;: &amp;lt;function __main__.Test.__init__(self, a, b)&amp;gt;, &amp;#39;a&amp;#39;: &amp;lt;member &amp;#39;a&amp;#39; of &amp;#39;Test&amp;#39; objects&amp;gt;, &amp;#39;b&amp;#39;: &amp;lt;member &amp;#39;b&amp;#39; of &amp;#39;Test&amp;#39; objects&amp;gt;, &amp;#39;__doc__&amp;#39;: None}) å…³äº __slots__ æˆ‘ä¹‹å‰ä¸“é—¨å†™è¿‡ä¸€ç¯‡æ–‡ç« åˆ†äº«è¿‡ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦è¯·ç§»æ­¥ç†è§£ Python ç±»å±æ€§ __slots__ ä¸€æ–‡ã€‚ è¡¥å…… __getattribute__ å’Œ __getattr__ ä¹Ÿè®¸ä½ è¿˜æœ‰ç–‘é—®ï¼Œé‚£å‡½æ•°çš„ __get__ æ–¹æ³•æ˜¯æ€ä¹ˆè¢«è°ƒç”¨çš„å‘¢ï¼Œè¿™ä¸­é—´è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ åœ¨ Python ä¸­ ä¸€åˆ‡çš†å¯¹è±¡ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„æ–¹æ³• __getattribute__(self, name)ã€‚ è¯¥æ–¹æ³•ä¼šåœ¨æˆ‘ä»¬ä½¿ç”¨ . è®¿é—® obj çš„å±æ€§æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œä¸ºäº†é˜²æ­¢é€’å½’è°ƒç”¨ï¼Œå®ƒæ€»æ˜¯å®ç°ä¸ºä»åŸºç±» object ä¸­è·å– object.__getattribute__(self, name), è¯¥æ–¹æ³•å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šé»˜è®¤ä» self çš„ __dict__ å­—å…¸ä¸­æŸ¥æ‰¾ name(é™¤äº†ç‰¹æ®Šæ–¹æ³•çš„æŸ¥æ‰¾)ã€‚ è¯å¤–ï¼šå¦‚æœè¯¥ç±»è¿˜å®ç°äº† __getattr__ï¼Œåˆ™åªæœ‰ __getattribute__ æ˜¾å¼åœ°è°ƒç”¨æˆ–æ˜¯å¼•å‘äº† AttributeError å¼‚å¸¸åæ‰ä¼šè¢«è°ƒç”¨ã€‚__getattr__ ç”±å¼€å‘è€…è‡ªå·±å®ç°ï¼Œåº”å½“è¿”å›å±æ€§å€¼æˆ–å¼•å‘ AttributeError å¼‚å¸¸ã€‚ è€Œæè¿°å™¨æ­£æ˜¯ç”± __getattribute__() æ–¹æ³•è°ƒç”¨ï¼Œå…¶å¤§è‡´é€»è¾‘ä¸ºï¼š def __getattribute__(self, key): v = object.__getattribute__(self, key) if hasattr(v, &amp;#39;__get__&amp;#39;): return v.__get__(self) return v è¯·æ³¨æ„ï¼šé‡å†™ __getattribute__() ä¼šé˜»æ­¢æè¿°å™¨çš„è‡ªåŠ¨è°ƒç”¨ã€‚ å‡½æ•°å±æ€§ å‡½æ•°ä¹Ÿæ˜¯ Python function å¯¹è±¡ï¼Œæ‰€ä»¥ä¸€æ ·ï¼Œå®ƒä¹Ÿå…·æœ‰ä»»æ„å±æ€§ï¼Œè¿™æœ‰æ—¶å€™æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨è·Ÿè¸ªè£…é¥°å™¨ï¼š def calltracker(func): @wraps(func) def wrapper(*args, **kwargs): wrapper.calls += 1 return func(*args, **kwargs) wrapper.calls = 0 return wrapper @calltracker def f(): return &amp;#39;f called&amp;#39; &amp;gt;&amp;gt;&amp;gt; f.calls 0 &amp;gt;&amp;gt;&amp;gt; f() &amp;#39;f called&amp;#39; &amp;gt;&amp;gt;&amp;gt; f.calls 1 å‚è€ƒ HowFunctionsToMethods Descriptor HowTo Guide Python Data model Understanding internals of Python classes</description>
    </item>
    
    <item>
      <title>GC æœºåˆ¶æ¢ç©¶ä¹‹ Python ç¯‡</title>
      <link>https://at7h.com/posts/gc-in-py/</link>
      <pubDate>Tue, 08 Sep 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/gc-in-py/</guid>
      <description>æœ¬æ–‡ä¸»è¦è®¨è®ºåƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰æœºåˆ¶åœ¨ Python 3.7 ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ ä¸åŒçš„ Python è§£é‡Šå™¨æœ‰å„è‡ª GC çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚ Jython è·‘åœ¨ JVM ä¸Šï¼Œé‡‡ç”¨äº†æ ‡å‡†çš„ Java GCï¼ŒPypy çš„ GC ä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤(Mark and Sweep)ç®—æ³•ï¼Œå®ƒæ¯” CPython çš„æ›´åŠ å¤æ‚å¹¶ä¸”æœ‰ç€ä¸€äº›é¢å¤–çš„ä¼˜åŒ–ã€‚ æœ¬æ–‡è®¨è®ºä¸»æµçš„ CPython è§£é‡Šå™¨ã€‚ é€šå¸¸ï¼Œä½ åœ¨ä½¿ç”¨ä¸€äº›é«˜çº§è¯­è¨€ï¼ˆPythonã€Golangã€Java ç­‰ï¼‰ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œä¸€èˆ¬æ— éœ€å…³å¿ƒå†…å­˜ç®¡ç†çš„é—®é¢˜ï¼Œå½“å¯¹è±¡ä¸å†éœ€è¦çš„æ—¶å€™ï¼ŒGC ä¼šè‡ªåŠ¨çš„æŠŠå®ƒä»¬å›æ”¶ã€‚ä½†æ˜¯äº†è§£ GC çš„å·¥ä½œåŸç†å¯ä»¥å¸®åŠ©ä½ ç¼–å†™æ›´å¥½ã€æ›´å¿«çš„ç¨‹åºï¼Œå¸®åŠ©ä½ æ’æŸ¥ä¸€äº›å¤æ‚çš„å†…å­˜é—®é¢˜ã€‚ å¸¸è§ GC ç®—æ³• ä¸šç•Œå¸¸è§çš„æ¯”è¾ƒçŸ¥åçš„åƒåœ¾å›æ”¶ç®—æ³•æœ‰ï¼š 1. å¼•ç”¨è®¡æ•°(Reference counting)ï¼šå¯¹æ¯ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œå½“å¼•ç”¨è®¡æ•°å™¨ä¸ºé›¶æ—¶å›æ”¶è¯¥å¯¹è±¡ã€‚ä»£è¡¨è¯­è¨€å¦‚ Pythonã€‚ ä¼˜ç‚¹ï¼šç®€å•æœ‰æ•ˆï¼Œå¯¹è±¡å¯ä»¥è¢«å¾ˆå¿«å›æ”¶ï¼Œä¸ä¼šå‡ºç°å†…å­˜è€—å°½æˆ–è¾¾åˆ°æŸä¸ªé˜€å€¼æ—¶æ‰å›æ”¶ã€‚ ç¼ºç‚¹ï¼šå¾ˆæ˜æ˜¾ï¼Œå¯¹æ¯ä¸ªå¯¹è±¡ç»´æŠ¤å¼•ç”¨è®¡æ•°æœ‰ä¸€å®šä»£ä»·ï¼Œè€Œä¸”è‡´å‘½çš„æ˜¯æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ 2. æ ‡è®°-æ¸…é™¤(Mark and Sweep)ï¼šä¸ºè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜è€Œæå‡ºï¼Œç®—æ³•ä»æ ¹å¯¹è±¡å¼€å§‹éå†ç¨‹åºæ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯è¾¾çš„å¯¹è±¡è¢«æ ‡è®°ï¼Œæœ€ç»ˆæ²¡è¢«æ ‡è®°çš„å¯¹è±¡è¢«åˆ é™¤å›æ”¶ã€‚ä»£è¡¨è¯­è¨€å¦‚ Golang(ä¸‰è‰²æ ‡è®°)ã€‚ ä¼˜ç‚¹ï¼šè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå¹¶ä¸”åœ¨ç®—æ³•æ‰§è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿé¢å¤–çš„å¼€é”€ã€‚ ç¼ºç‚¹ï¼šéœ€è¦ STW(stop the world)ï¼Œå³æ‰§è¡ŒæœŸé—´éœ€è¦ç¨‹åºæš‚åœï¼Œå¹¶ä¸”å®¹æ˜“åœ¨ç»è¿‡å¤šæ¬¡ã€æ ‡è®°-æ¸…é™¤ã€å¾ªç¯åå¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ã€‚ 3. åœæ­¢-å¤åˆ¶(Stop-and-Copy) ï¼šä¸æ ‡è®°-æ¸…é™¤ç®—æ³•ç±»ä¼¼ï¼Œå·®å¼‚åœ¨äºå¦‚ä½•å¤„ç†è¿™äº›å¯è¾¾çš„å­˜æ´»å¯¹è±¡ã€‚è¯¥ç®—æ³•å°†æ•´ä¸ªå †ç©ºé—´è¢«åˆ‡åˆ†æ´»åŠ¨åŒºå’Œç©ºé—²åŒºï¼Œåƒåœ¾æ”¶é›†æ—¶å°†æ‰€æœ‰çš„å¯è¾¾çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€åŒºï¼ŒåŸæœ¬åŠåŒºçš„å°±å¯ä»¥è¢«å›æ”¶ï¼Œç¨‹åºä¼šåœ¨æ–°çš„æ´»åŠ¨åŒºä¸­åˆ†é…å†…å­˜ã€‚ ä¼˜ç‚¹ï¼šè¿è¡Œé«˜æ•ˆä¸”ä¸å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼ŒåŸºæœ¬è§£å†³äº†æ ‡è®°-æ¸…é™¤å†…å­˜ç¢ç‰‡åŒ–çš„é—®é¢˜ã€‚ ç¼ºç‚¹ï¼šéœ€è¦ STWï¼Œæ”¶é›†å™¨å¿…é¡»å¤åˆ¶æ‰€æœ‰çš„æ´»åŠ¨å¯¹è±¡ï¼Œè¿™å¢åŠ äº†ç¨‹åºç­‰å¾…æ—¶é—´ï¼Œå¹¶ä¸”åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½ä½¿ç”¨æ•´ä¸ªå†…å­˜ç©ºé—´çš„ä¸€åŠã€‚ 3. æ ‡è®°-å‹ç¼©(Mark-and-Compact) ï¼šæ ‡è®°é˜¶æ®µä¸æ ‡è®°-æ¸…é™¤ç®—æ³•ç›¸åŒï¼Œå‹ç¼©ï¼ˆæ•´ç†ï¼‰é˜¶æ®µä¸æ˜¯ç›´æ¥æ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼ŒæŒ‰é¡ºåºæ’æ”¾æ›´æ–°å¯¹åº”çš„æŒ‡é’ˆï¼Œç„¶åæ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚ ä¼˜ç‚¹ï¼šé¿å…äº†æ ‡è®°-æ¸…é™¤çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†åœæ­¢å¤åˆ¶ç®—æ³•çš„å†…å­˜ç©ºé—´å‡åŠé—®é¢˜ã€‚ ç¼ºç‚¹ï¼šéœ€è¦ STWï¼Œä½æ•ˆï¼Œå› ä¸ºå¢åŠ äº† copy å’Œæ›´æ–°æŒ‡é’ˆçš„è¿‡ç¨‹ã€‚ 5. åˆ†ä»£æ”¶é›†(Generational Collection)ï¼šä¸å…¶è¯´æ˜¯ä¸€ç§æ–°ç®—æ³•ä¸å¦‚è¯´æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œç›®å‰å¾ˆæµè¡Œã€‚ç®—æ³•æŒ‰ç…§å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿çŸ­åˆ’åˆ†ä¸åŒçš„ä»£ç©ºé—´ï¼Œç”Ÿå‘½å‘¨æœŸé•¿çš„æ”¾å…¥è€å¹´ä»£ï¼ŒçŸ­çš„æ”¾å…¥æ–°ç”Ÿä»£ï¼Œä»è€ŒåŒºåˆ«ä¸åŒçš„å›æ”¶ç®—æ³•ç­–ç•¥å’Œé¢‘ç‡ï¼Œè®©å„ç®—æ³•å……åˆ†å‘æŒ¥ä¼˜åŠ¿ã€‚ä»£è¡¨è¯­è¨€å¦‚ Javaã€‚ ä¼˜ç‚¹ï¼šå¯ç»“åˆå…¶ä»–æ£€æµ‹ç®—æ³•ï¼Œå›æ”¶æ€§èƒ½å¥½ã€‚ ç¼ºç‚¹ï¼šç®—æ³•æ¯”è¾ƒå¤æ‚ã€‚ æ²¡æœ‰ç»å¯¹å¥½å’Œåçš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨çœŸæ­£è¯­è¨€å®ç°ä¸­ä¸€èˆ¬éƒ½æ˜¯å‡ ç§ç®—æ³•ç»“åˆä½¿ç”¨ï¼Œä¸‹é¢ä¸»è¦æ¥æ¢è®¨ Python ä¸­çš„åƒåœ¾å›æ”¶ç­–ç•¥ã€‚ GC in Python åœ¨ Python ä¸­ï¼Œä¸€åˆ‡çš†å¯¹è±¡ï¼ŒçŸ¥é“å®ƒä»¬ä»€ä¹ˆæ—¶å€™è¢«åˆ†é…å†…å­˜å¾ˆå®¹æ˜“ï¼Œå½“ä½ éœ€è¦çš„æ—¶å€™ä½ å¯ä»¥å¾ˆå®¹æ˜“åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ä½†å›æ”¶ç¡®æ˜¯æ¯”è¾ƒå¤æ‚çš„ä¸€ä»¶äº‹ï¼Œéœ€è¦ç¡®å®šä½ çš„å¯¹è±¡ç¡®å®æ˜¯ä¸å†éœ€è¦äº†ï¼Œè¿‡æ—©çš„æ¸…ç†å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¦‚æœä¸äºˆä»¥é‡Šæ”¾ï¼Œåˆ™ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚ åƒåœ¾å›æ”¶çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯ç¡®å®šå“ªäº›å¯¹è±¡å¯ä»¥è¢«æ”¶å›ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªæœ€ä½³çš„æ—¶é—´æ¥é‡Šæ”¾å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚æ ‡å‡†çš„ CPython GC æœ‰ä¸¤ä¸ªç»„ä»¶ï¼š å¼•ç”¨è®¡æ•°æ”¶é›†å™¨(reference counting collector)ï¼šä¸»è¦çš„ã€åŸºç¡€æ¨¡å—ã€ä¸å¯æ§ï¼Œä¸èƒ½ç¦ç”¨ã€‚ åˆ†ä»£åƒåœ¾æ”¶é›†å™¨(generational garbage collector)ï¼šè¾…åŠ©çš„ã€å¯ä»¥æ§åˆ¶ï¼Œå³ gc moduleã€‚ CPython çš„åƒåœ¾å›æ”¶ä¸»è¦æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æŠ€æœ¯ï¼Œå¼•ç”¨è®¡æ•°æ˜¯éå¸¸æœ‰æ•ˆå’Œç®€å•çš„ï¼Œä½†å®ƒä¸èƒ½æ£€æµ‹å¾ªç¯å¼•ç”¨(reference cycles)ï¼Œå› æ­¤ CPython åˆè®¾è®¡äº†ä¸€ä¸ªåˆ†ä»£åƒåœ¾æ”¶é›†å™¨ä½œä¸ºè¡¥å……ç®—æ³•æ¥ä¸“é—¨å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜.å› å®ƒåªå¤„ç†å¾ªç¯å¼•ç”¨ï¼Œä¹Ÿè¢«ç§°ä¸ºåˆ†ä»£å¾ªç¯(generational cyclic) GCã€‚Python ä¸­å¸¸è¯´çš„ GC å…¶å®å°±æ˜¯å®ƒï¼Œå…¶é»˜è®¤æƒ…å†µä¸‹æ˜¯å¯ç”¨çš„ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è§¦å‘å’Œç¦ç”¨å®ƒã€‚ CPython GC çš„ç­–ç•¥æ˜¯ï¼š å¯¹æ¯ä¸ªå¯¹è±¡ç»´æŠ¤å¼•ç”¨è®¡æ•° é€šè¿‡ä¸€ä¸ªè¾…åŠ©ç®—æ³•æ¥å®šæœŸæ£€æµ‹å¾ªç¯å¼•ç”¨ï¼Œé‡Šæ”¾æ— ç”¨å¯¹è±¡ å¼•å…¥åˆ†ä»£ç­–ç•¥æ¥ä¼˜åŒ–æ­¤æ£€æµ‹ï¼Œæé«˜æ€§èƒ½ å¼•ç”¨è®¡æ•° å¼•ç”¨è®¡æ•°æ˜¯ä¸€ç§ç®€å•çš„æŠ€æœ¯ï¼Œå½“ç¨‹åºä¸­æ²¡æœ‰å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œå°†å…¶é‡Šæ”¾ã€‚ Python ä¸­çš„æ¯ä¸ªå˜é‡éƒ½æ˜¯å¯¹çœŸå®å¯¹è±¡çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ï¼Œä¸ºäº†è·Ÿè¸ªå¼•ç”¨ï¼Œæ¯ä¸ªå¯¹è±¡ï¼ˆåŒ…æ‹¬æ•´æ•°ã€å­—ç¬¦ä¸²ï¼‰éƒ½ä¼šæœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°çš„é¢å¤–å­—æ®µï¼Œè¯¥å­—æ®µä¼šä¸€ç›´ç»´æŠ¤ï¼Œåœ¨åˆ›å»ºæˆ–åˆ é™¤æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨æ—¶ä¼šå¢åŠ æˆ–å‡å°‘ã€‚æœ‰å…³è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è§ Objects, Types and Reference Counts éƒ¨åˆ†ã€‚ å¯¼è‡´å¼•ç”¨è®¡æ•°å¢åŠ ä¸»è¦æœ‰ï¼š èµ‹å€¼è¿ç®—ç¬¦ å‚æ•°ä¼ é€’ å°†å¯¹è±¡ï¼ˆä½œä¸ºå…ƒç´ ï¼‰append åˆ°å®¹å™¨ä¸­ å¦‚æœå¯¹è±¡çš„å¼•ç”¨è®¡æ•°è¾¾åˆ°é›¶ï¼ŒCPython ä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡ç‰¹å®šçš„å†…å­˜é‡Šæ”¾å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åŒ…å«å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™å®ƒä»¬çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¼šè‡ªåŠ¨å‡å°‘ï¼Œå› æ­¤ï¼Œå¯ä»¥ä¾æ¬¡é‡Šæ”¾å…¶ä»–å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå½“åˆ é™¤ List æ—¶ï¼Œæ‰€æœ‰ List å…ƒç´ çš„å¼•ç”¨è®¡æ•°éƒ½ä¼šå‡å°‘ã€‚å¦‚æœå­˜åœ¨å¦ä¸€ä¸ªå˜é‡å¼•ç”¨äº† List ä¸­çš„æŸä¸ªé¡¹ç›®ï¼Œåˆ™è¯¥å…ƒç´ ä¸ä¼šè¢«é‡Šæ”¾ã€‚ åœ¨ Python ä¸­ï¼Œå…¨å±€å˜é‡ä¼šä¸€ç›´å­˜åœ¨ç›´åˆ° Python è¿›ç¨‹ç»“æŸä¸ºæ­¢ã€‚å› æ­¤ï¼Œç”±å…¨å±€å˜é‡å¼•ç”¨çš„å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¼šé™ä¸ºé›¶ï¼Œæ‰€æœ‰å…¨å±€å˜é‡éƒ½å­˜å‚¨åœ¨å­—å…¸ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ globals() å‡½æ•°æ¥è·å–å®ƒä»¬ã€‚ åœ¨æŸä¸€ä¸ªã€å—ã€ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå¦‚ functionã€class æˆ– withï¼ˆcontext&amp;rsquo;s enter/exit) è¯­å¥å…·æœ‰å±€éƒ¨ä½œç”¨åŸŸï¼Œå½“è§£é‡Šå™¨ä»è¯¥å—ä¸­é€€å‡ºæ—¶ï¼Œä¼šé‡Šæ”¾åœ¨è¯¥å—å†…éƒ¨åˆ›å»ºçš„å±€éƒ¨å˜é‡åŠå…¶å¼•ç”¨ã€‚åœ¨ Python ä¸­ï¼Œç”¨çš„æœ€å¤šçš„ã€å—ã€åº”è¯¥å°±æ˜¯å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰äº†ï¼Œè¿™æ˜¯å¤§å¤šæ•°åƒåœ¾æ”¶é›†å‘ç”Ÿçš„åœ°æ–¹ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ä¿æŒå‡½æ•°åŠŸèƒ½å•ä¸€ä¸€ä¸ªåŸå› å§ã€‚ åœ¨ Python ä¸­ï¼Œä½ å§‹ç»ˆå¯ä»¥ä½¿ç”¨ sys.getrefcount å‡½æ•°æ£€æŸ¥å¯¹è±¡å¼•ç”¨çš„æ•°é‡ã€‚æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š In [1]: import sys In [2]: sys.getrefcount? Docstring: getrefcount(object) -&amp;gt; integer Return the reference count of object. The count returned is generally one higher than you might expect, because it includes the (temporary) reference as an argument to getrefcount(). Type: builtin_function_or_method In [3]: l = [] In [4]: sys.getrefcount(l) Out[4]: 2 # å˜é‡ l å’Œ getrefcount ä¸­çš„ä¸´æ—¶å˜é‡ In [5]: def f(a): ...: print(&amp;#34;Here reference count is:&amp;#34;, sys.getrefcount(a)) ...: In [6]: f(l) Here reference count is: 4 In [7]: sys.getrefcount(l) Out[7]: 2 # å‡½æ•°ä½œç”¨åŸŸçš„è¢«é”€æ¯ æœ‰æ—¶æˆ‘ä»¬éœ€è¦åˆ»æ„çš„æ‰‹åŠ¨åˆ é™¤æŸä¸€å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ del è¯­å¥ï¼ˆå…¶åˆ é™¤å˜é‡åŠå…¶å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼‰ï¼Œè¿™åœ¨ REPL ç¯å¢ƒï¼ˆJupyter notebooksï¼ŒIPython ç­‰ï¼‰å·¥ä½œæ—¶é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæ‰€æœ‰å˜é‡éƒ½æ˜¯å…¨å±€èŒƒå›´çš„ã€‚ ä¸ªäººè§‰å¾—ï¼ŒCPython ä½¿ç”¨å¼•ç”¨è®¡æ•°ä¸»è¦æ˜¯å†å²åŸå› ï¼Œå…³äºè¿™ç§æŠ€æœ¯çš„å¼±ç‚¹å¾ˆå¤šäº‰è®ºã€‚å¾ˆå¤šäººè§‰å¾—ç°ä»£åƒåœ¾æ”¶é›†ç®—æ³•å¯ä»¥æ›´é«˜æ•ˆï¼Œæ— éœ€å¼•ç”¨è®¡æ•°ï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•æœ‰å¾ˆå¤šé—®é¢˜ï¼Œä¾‹å¦‚å¾ªç¯å¼•ç”¨ï¼Œçº¿ç¨‹é”å®šä»¥åŠå†…å­˜å’Œæ€§èƒ½çš„é¢å¤–å¼€é”€ã€‚ å¼•ç”¨è®¡æ•°åº”è¯¥ä¹Ÿæ˜¯ CPython æ— æ³•æ‘†è„± GIL çš„åŸå› ä¹‹ä¸€ã€‚ å¾ªç¯å¼•ç”¨ ä»¥ä¸‹æƒ…å†µä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨ï¼š å¯¹è±¡åŒ…å«æœ¬èº«çš„å¼•ç”¨ ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ ctypes æ¨¡å—æ¥è·Ÿè¸ªè®¿é—®å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œä»¥å±•ç¤ºä¸Šé¢ä¸¤ç§æƒ…å†µï¼š In [1]: import gc, ctypes In [2]: gc.disable() In [3]: class Object(ctypes.Structure): ...: _fields_ = [(&amp;#34;refcnt&amp;#34;, ctypes.c_long)] In [4]: l = [] ...: l.append(l) In [5]: lst_address = id(l) In [6]: del l In [7]: object_1 = {} ...: object_2 = {} ...: object_1[&amp;#39;obj2&amp;#39;] = object_2 ...: object_2[&amp;#39;obj1&amp;#39;] = object_1 In [8]: obj_address = id(object_1) In [9]: del object_1, object_2 In [10]: Object.from_address(obj_address).refcnt Out[10]: 1 In [11]: Object.from_address(lst_address).refcnt Out[11]: 1 ç¤ºä¾‹ä¸­ï¼Œdel è¯­å¥åˆ é™¤äº†å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¹è±¡è¢« del åï¼Œæˆ‘ä»¬ä¸èƒ½å†ä» Python ä»£ç ä¸­è®¿é—®è¿™äº›å¯¹è±¡ï¼Œä½†å®ƒä»¬ä»ä½äºå†…å­˜ä¸­ã€‚åœ¨ Python 2.0 ç‰ˆæœ¬ä»¥å‰ï¼Œå®ƒä»¬åœ¨ç¨‹åºè¿è¡Œä¸­æ°¸è¿œä¸ä¼šè¢«é‡Šæ”¾ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µå°±æ˜¯å› ä¸ºå®ƒä»¬ä»ç„¶ç›¸äº’å¼•ç”¨ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦ä½ å¯ä»¥ä½¿ç”¨ objgraph æ¨¡å—æ¥ç›´è§‚åœ°æ¢ç´¢è¿™ç§å¯¹è±¡å…³ç³»ã€‚ è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ ä¸ºäº†è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼ŒCPython å¼•å…¥äº†ä¸€ç§é™„åŠ çš„å¾ªç¯å¼•ç”¨æ£€æµ‹ç®—æ³•æ¥è´Ÿè´£å¤„ç†è¿™æ ·çš„é—®é¢˜ï¼ˆå³è‡ª Python 2.0 å¼€å§‹çš„ gc æ¨¡å—ï¼‰ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆå½“æ—¶ä¸é‡‡ç”¨ä¸Šæ–‡è¯´çš„å‡ ç§ä¼ ç»Ÿå›æ”¶ç®—æ³•ï¼ˆå¦‚ Mark and Sweep æˆ– Stop-and-Copy ç­‰ï¼‰å‘¢ï¼ŸåŸå› æ˜¯ç”±äº CPython æ‰©å±•æ¨¡å—çš„å·¥ä½œæ–¹å¼ï¼ŒCPython æ°¸è¿œæ— æ³•å®Œå…¨ç¡®å®šæ ¹é›†ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½é‡Šæ”¾ä»ç„¶åœ¨æŸä¸ªåœ°æ–¹æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼Œé€ æˆç¨‹åºå´©æºƒã€‚æ‰€ä»¥æœ€ç»ˆæ˜¯åœ¨å¼•ç”¨è®¡æ•°çš„åŸºç¡€ä¸Šï¼Œè®¾è®¡äº†ä¸€ç§å¯ä»¥æ£€æµ‹å¹¶å¤„ç†å¾ªç¯å¼•ç”¨çš„ç®—æ³•ã€‚ æç¤ºï¼šå¦‚æœä½ ä½¿ç”¨æœç´¢å¼•æ“æœç´¢è¿‡ç›¸å…³çš„æ–‡ç« ï¼Œä½ å¯èƒ½ä¼šå‘ç°å¾ˆå¤šæ–‡ç« éƒ½è®²ã€Python æ˜¯ä»¥å¼•ç”¨è®¡æ•°ä¸ºä¸»ï¼Œæ ‡è®°-æ¸…é™¤å’Œåˆ†ä»£æ”¶é›†ä¸ºè¾…çš„ã€æ”¶é›†ç­–ç•¥ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼ŒCPython ä¸­ä½¿ç”¨çš„å¾ªç¯å¼•ç”¨æ£€æµ‹ç®—æ³•ï¼ˆä¸‹ä¸€èŠ‚ä¸­ä»‹ç»ï¼‰å¹¶ä¸æ˜¯æ ‡è®°-æ¸…é™¤ã€‚ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ˜¯ Pypy çš„ GCã€‚ ä»æ¦‚å¿µæ¥è¯´ï¼ŒCPython GC ä¸ä¸Šè¿°çš„å‡ ç§ç®—æ³•åˆšå¥½ç›¸åï¼Œå®ƒè¯•å›¾æ‰¾å‡ºä¸å¯è¾¾çš„éæ´»åŠ¨å¯¹è±¡ï¼ŒCPython çš„å¼€å‘è€…è®¤ä¸ºè¿™å°†æ›´åŠ å®‰å…¨ï¼Œå³ä½¿ç®—æ³•å¤±è´¥ï¼ŒçŠ¶å†µä¹Ÿä¸ä¼šæ¯”æ²¡æœ‰åƒåœ¾å›æ”¶çš„æƒ…å†µæ›´ç³Ÿï¼ˆé™¤äº†æµªè´¹çš„æ—¶é—´å’Œç©ºé—´ï¼‰ã€‚ï¼ˆå°±æ˜¯æ„Ÿè§‰å¹¶ä¸æ˜¯é‚£ä¹ˆè‡ªä¿¡ ğŸ˜‚ å› ä¸ºå¾ªç¯å¼•ç”¨åªä¼šåœ¨å®¹å™¨ç±»å¯¹è±¡ä¸­å‘ç”Ÿï¼Œæ‰€ä»¥åªéœ€ä¸“æ³¨äºè·Ÿè¸ªæ‰€æœ‰çš„å®¹å™¨å¯¹è±¡ï¼Œè€Œä¸”ï¼ŒæŸäº›æƒ…å†µä¸‹çš„çš„å®¹å™¨å¯¹è±¡ä¹Ÿæ˜¯ä¸ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨çš„ï¼ˆä¾‹å¦‚åªåŒ…å«ä¸å¯å˜å¯¹è±¡çš„å­—å…¸ï¼‰ï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸€ç±»çš„å¯¹è±¡å¯ä»¥è¿›è¡Œå–æ¶ˆè·Ÿè¸ªçš„ä¼˜åŒ–ï¼Œå–æ¶ˆè·Ÿè¸ªä¸€èˆ¬ä¼šåœ¨ä»¥ä¸‹ä¸¤ä¸ªæ—¶æœºè¿›è¡Œï¼š åˆ›å»ºå®¹å™¨å¯¹è±¡æ—¶ å®¹å™¨å¯¹è±¡è¢«æ”¶é›†å™¨æ£€æŸ¥æ—¶ CPython GC æ£€æµ‹ç®—æ³•ä¸ä¼šè·Ÿè¸ªé™¤å…ƒç»„ä»¥å¤–çš„æ‰€æœ‰ä¸å¯å˜ç±»å‹ï¼Œå¹¶ä¸”ä½œä¸ºä¼˜åŒ–ç­–ç•¥ï¼ŒåªåŒ…å«ä¸å¯å˜å¯¹è±¡çš„å…ƒç»„å’Œå­—å…¸ä¹Ÿåœ¨æŸäº›æ¡ä»¶ä¸‹è¢«å–æ¶ˆè·Ÿè¸ªï¼ˆå…¶ä¸­å…ƒç»„å¯¹è±¡æ˜¯åœ¨ GC è¿‡ç¨‹ä¸­å†³å®šæ˜¯å¦ç»§ç»­è·Ÿè¸ªï¼Œè€Œå­—å…¸å¯¹è±¡ä¼šåœ¨åˆ›å»ºå’Œ GC è¿‡ç¨‹ä¸­å†³å®šï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ gc.is_tracked(obj) å‡½æ•°æ¥æŸ¥çœ‹å¯¹è±¡çš„è·Ÿè¸ªçŠ¶æ€ã€‚çœ‹å‡ ä¸ªä¾‹å­ï¼š In [1]: import gc In [2]: gc.is_tracked(1) Out[2]: False In [3]: gc.is_tracked(&amp;#39;s&amp;#39;) Out[3]: False In [4]: gc.is_tracked([]) Out[4]: True In [5]: gc.is_tracked({}) Out[5]: False In [6]: gc.is_tracked({&amp;#39;s1&amp;#39;: 1}) Out[6]: False In [7]: gc.is_tracked({&amp;#39;s1&amp;#39;: []}) Out[7]: True å†æ¥çœ‹ä¸€ä¸ªå¯¹äºå­—å…¸å’Œå…ƒç»„å¯¹è±¡ä¼˜åŒ–çš„ä¾‹å­: In [8]: d = {&amp;#39;s&amp;#39;: 1} In [9]: gc.is_tracked(d) Out[9]: False In [10]: d[&amp;#39;l&amp;#39;] = [] In [11]: gc.is_tracked(d) Out[11]: True In [12]: t = (1,2,3) In [13]: gc.is_tracked(t) Out[13]: True In [14]: gc.collect() Out[14]: 1015 In [15]: gc.is_tracked(t) Out[15]: False å¦‚ä½•æ‰¾åˆ°å¾ªç¯å¼•ç”¨ï¼Ÿ å…³äº CPython GC æ£€æµ‹å¾ªç¯å¼•ç”¨çš„å…·ä½“ç®—æ³•é€»è¾‘ï¼Œå¾ˆéš¾ç”¨å‡ æ®µè¯è§£é‡Šã€‚å…¶ä¸»è¦æ˜¯ç»´æŠ¤äº†ä¸¤ä¸ªåŒå‘é“¾è¡¨ï¼Œä¸€ä¸ªåŒ…å«æ‰€æœ‰è¦æ‰«æçš„å¯¹è±¡ï¼Œå¦ä¸€ä¸ªåŒ…å«ã€æš‚æ—¶ã€æ— æ³•è®¿é—®çš„æ‰€æœ‰å¯¹è±¡ã€‚æ¯ä¸ªè·Ÿè¸ªçš„å®¹å™¨çš„å¯¹è±¡éƒ½æœ‰é¢å¤–çš„ 2+1 ä¸ªå­—æ®µï¼Œå³ä¸¤ä¸ªé“¾è¡¨æŒ‡é’ˆå’Œä¸€ä¸ª gc_refs å­—æ®µï¼ˆåˆå§‹å€¼ä¸ºè¯¥å¯¹è±¡çš„å¼•ç”¨æ•°ï¼‰ã€‚ç„¶åå¯»æ‰¾å¾ªç¯å¼•ç”¨çš„å¤§è‡´æ€è·¯æ˜¯ï¼Œéå†æ‰€æœ‰è¦æ‰«æçš„å®¹å™¨å¯¹è±¡ï¼Œå¯¹äºæ¯ä¸ªå®¹å™¨å¯¹è±¡ï¼Œæ‰¾åˆ°å®ƒå¼•ç”¨çš„æ‰€æœ‰å®¹å™¨å¯¹è±¡ï¼Œå¹¶å‡å°å…¶ gc_refs å€¼ï¼Œç»è¿‡å®Œå…¨è¿­ä»£åï¼Œæ‰€æœ‰å¼•ç”¨è®¡æ•°å°äº 2 çš„å¯¹è±¡éƒ½å†æ— æ³•ä» Python è®¿é—®ï¼Œå› æ­¤å¯ä»¥å°†å…¶æ”¶é›†ã€‚ ä¸ºäº†å®Œå…¨ç†è§£å¾ªç¯å¼•ç”¨æŸ¥æ‰¾ç®—æ³•ï¼Œå»ºè®®æ„Ÿå…´è¶£çš„åŒå­¦ç»§ç»­é˜…è¯» dentifying reference cycles ä¸€èŠ‚ï¼Œæˆ–ä» CPython çš„æºç ä¸­æŸ¥çœ‹ collect å‡½æ•°ã€‚ ä½¿ç”¨åˆ†ä»£ç­–ç•¥ä¼˜åŒ– CPython GC æœ‰äº†ä¸Šè¿°å¾ªç¯å¼•ç”¨æ£€æµ‹ç®—æ³•ï¼Œå·²ç»å¯ä»¥æ£€æµ‹å¹¶å¤„ç†æ‰ç¨‹åºä¸­å¾ªç¯å¼•ç”¨çš„å¯¹è±¡äº†ã€‚æ¥ä¸‹æ¥å°±éœ€è¦å…³å¿ƒæ€§èƒ½é—®é¢˜äº†ï¼Œå› ä¸ºå®ƒæ˜¯å®šæœŸè¿è¡Œçš„ï¼Œæ‰€ä»¥ CPython çš„å¼€å‘è€…ä¸ºæ­¤ä¹Ÿå¼•å…¥äº†å¯å‘å¼çš„åˆ†ä»£ç­–ç•¥ã€‚ ä¸ºäº†ä½¿æ”¶é›†èŠ±è´¹çš„æ—¶é—´å°½å¯èƒ½çŸ­ ï¼ŒCPython GC å°†å®¹å™¨å¯¹è±¡åˆ†ä¸ºä¸‰ä»£ï¼Œæ¯ä¸ªæ–°å»ºçš„å¯¹è±¡éƒ½å½’äºæœ€å¹´è½»ç¬¬ä¸€ä»£ï¼Œå¦‚æœè¯¥å¯¹è±¡åœ¨ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¸­å¹¸å­˜ä¸‹æ¥ï¼Œæ²¡æœ‰è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ç§»è‡³è¾ƒé«˜(è€)çš„ä¸€ä»£â€”â€”ç¬¬äºŒä»£ã€‚ä¸é«˜(è€)ä¸–ä»£ç›¸æ¯”ï¼Œè¾ƒä½(å¹´è½»)ä¸–ä»£çš„åƒåœ¾æ”¶é›†é¢‘ç‡æ›´é«˜ï¼Œæ‰€ä»¥å¤§å¤šæ•°ä¸´æ—¶å¯¹è±¡(å±€éƒ¨å˜é‡ç­‰)çš„åˆ›å»ºå’Œæ¸…ç†éƒ½æ˜¯å¾ˆå¿«çš„ï¼Œç”±æ­¤æé«˜äº† GC çš„æ€§èƒ½å‡å°‘äº† GC çš„æš‚åœæ—¶é—´ã€‚ ä¸ºäº†å†³å®šä½•æ—¶æ‰§è¡Œ GCï¼Œæ¯ä¸ªä¸–ä»£éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„è®¡æ•°å™¨å’Œé˜ˆå€¼ï¼Œè®¡æ•°å™¨å­˜å‚¨å½“ä»£è‡ªä¸Šæ¬¡åƒåœ¾æ”¶é›†ä»¥æ¥åˆ†é…å¯¹è±¡æ•°é‡å‡å»è¢«é‡Šæ”¾å¯¹è±¡æ•°é‡çš„å·®å€¼ï¼Œè¿™å¾—ç›Šäºç®—æ³•å¯¹å®¹å™¨å¯¹è±¡çš„è·Ÿè¸ªã€‚æ¯å½“ä½ åˆ†é…ä¸€ä¸ªæ–°çš„å®¹å™¨å¯¹è±¡æ—¶ï¼ŒCPython éƒ½ä¼šæ£€æŸ¥ç¬¬ä¸€ä»£è®¡æ•°å™¨çš„å€¼æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œåˆ™åœ¨ç¬¬ä¸€ä»£ä¸­å¯åŠ¨ä¸€æ¬¡ GC(è¿è¡Œä¸Šè¿°ç®—æ³•)ï¼Œé‚£äº›ä¸ä¼šè¢«ä½¿ç”¨çš„å¯¹è±¡å°†ä¼šè¢«é‡Šæ”¾ï¼Œå…¶ä½™è¢«ç§»è‡³ç¬¬äºŒä»£ï¼Œæ›´æ–°è®¡æ•°å™¨ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å½“å‰å„ä»£çš„è®¡æ•°å™¨å€¼å¯ä»¥é€šè¿‡ gc.get_count() æŸ¥çœ‹ã€‚æ ‡å‡†é˜ˆå€¼å†…ç½®ä¸º(700, 10, 10)ï¼Œä½ å¯ä»¥ä½¿ç”¨ gc.get_threshold() æŸ¥çœ‹, è¿˜å¯ä»¥ä½¿ç”¨ gc.get_threshold å‡½æ•°è¿›è¡Œè°ƒæ•´ã€‚ æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ gc.collect(generation=None) æ‰‹åŠ¨è§¦å‘ GCã€‚ å¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥ç»§ç»­åœ¨ CPython çš„æºç ä¸­æŸ¥çœ‹ collect å‡½æ•°ï¼Œä»¥äº†è§£æ›´åŠ å…·ä½“çš„ç®—æ³•é€»è¾‘ã€‚ æ€»ç»“ CPython çš„å¤§éƒ¨åˆ†åƒåœ¾æ”¶é›†æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°å®Œæˆçš„ï¼Œæˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œå¹²æ¶‰è°ƒæ•´ï¼Œé€šè¿‡è¾…åŠ©çš„åˆ†ä»£ GC æ¥å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œå…¶å¯æ§ï¼Œå³ gc moduleã€‚å…³äºæ€§èƒ½ï¼š æ‰€æœ‰å¯¹è±¡(åŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²)éƒ½å¿…é¡»å®æ—¶æ­£ç¡®çš„ç»´æŠ¤å¼•ç”¨è®¡æ•°ï¼Œè¿™éœ€è¦é¢å¤–çš„å†…å­˜ä¸ CPU å¼€é”€ï¼Œå¦å¤–ç»´æŠ¤å®¹å™¨å¯¹è±¡çš„è·Ÿè¸ªå­—æ®µ(ä¹Ÿéœ€è¦é¢å¤–çš„å†…å­˜å’Œ CPU å¼€é”€ã€‚ WTP æ—¶é—´å…¶ä»–å®ç°ç›¸æ¯”ç›¸å¯¹è¾ƒå°‘ï¼Œè¿™å¾—ç›Šäºå¼•ç”¨è®¡æ•°ç­–ç•¥(åªè¦æ²¡æœ‰å¤ªå¤šçš„å¾ªç¯å¼•ç”¨)ï¼ŒCPython å¹¶æ²¡æœ‰å¯¹æ­¤è¿›è¡Œç‰¹æ®Šä¼˜åŒ–ï¼Œå¦‚ Golang çš„å†™å±éšœ(Write Barrier)ç­‰ã€‚ CPython GC å¹¶æ²¡æœ‰å°†æ‰€æœ‰æ´»åŠ¨çš„å¯è¾¾å¯¹è±¡æ‹·è´åˆ°å¦ä¸€æ•´å—å†…å­˜é‡æ–°ç¼–æ’ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šé€ æˆå†…å­˜ç¢ç‰‡ã€‚ æç¤ºæˆ–å»ºè®® 1. å¦‚æœä½ å¯ä»¥ä¿è¯ä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ï¼Œåˆ™å¯ä»¥é€šè¿‡ gc.disable å®Œå…¨ç¦ç”¨ GCï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¦ç”¨ GC å¹¶æ‰‹åŠ¨ gc.collect() å¾ˆæœ‰ç”¨ã€‚ 2. ä¸ºé¿å…äº§ç”Ÿå¾ªç¯å¼•ç”¨ï¼Œå¯è€ƒè™‘ä½¿ç”¨å¼±å¼•ç”¨ weakref ï¼Œweakref.ref ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå¹¶ä¸”å½“å¯¹è±¡åªå‰©å¼±å¼•ç”¨æ—¶ä¸ä¼šä¿æŒå…¶æ´»æ€§ï¼ˆå¯ä»¥è¢« GC æ­£å¸¸å›æ”¶ï¼‰ï¼Œå¹¶åœ¨å¯¹è±¡è¢«é‡Šæ”¾åå®‰å…¨è¿”å› Noneã€‚ 3. å¾ªç¯åœ¨ç°å®ç”Ÿæ´»ä¸­å¾ˆå®¹æ˜“å‘ç”Ÿã€‚é€šå¸¸ï¼Œæ‚¨ä¼šåœ¨å›¾å½¢ï¼Œé“¾æ¥åˆ—è¡¨æˆ–ç»“æ„ä¸­é‡åˆ°å®ƒä»¬ï¼Œåœ¨å…¶ä¸­éœ€è¦è·Ÿè¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚å¦‚æœæ‚¨çš„ç¨‹åºå·¥ä½œé‡å¤§ä¸”è¦æ±‚ä½å»¶è¿Ÿï¼Œåˆ™éœ€è¦å°½å¯èƒ½é¿å…å‚è€ƒå‘¨æœŸã€‚ æŸ¥æ‰¾æˆ–è°ƒè¯•åˆ†æå¾ªç¯å¼•ç”¨ 1. æ ‡å‡† gc æ¨¡å— æä¾›äº†æ¥å£å¯ä»¥å¸®åŠ©è°ƒè¯•ï¼Œä¾‹å¦‚ gc.set_debug(gc.DEBUG_SAVEALL)ï¼Œåˆ™æ‰¾åˆ°çš„æ‰€æœ‰çš„ä¸å¯è¾¾å¯¹è±¡å°†è¿½åŠ åˆ° gc.garbage åˆ—è¡¨ä¸­ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­æŸ¥çœ‹ã€‚ 2. å½“ä½ å‘ç°äº†å¾ªç¯å¼•ç”¨çš„å¯¹è±¡åï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸Šæ–‡ä¸­æåˆ°çš„ objgraph æ¥ç›´è§‚çš„æ¢ç´¢å®ƒä¸å…¶å®ƒå¯¹è±¡é—´çš„å…³ç³»ã€‚ å‚è€ƒ Design of CPythonâ€™s Garbage Collector Garbage collection in Python: things you need to know Garbage Collection for Python How does garbage collection in Python work? What are the pros and cons?</description>
    </item>
    
    <item>
      <title>Helo å¿«é€Ÿä¸Šæ‰‹æŒ‡å—</title>
      <link>https://at7h.com/posts/helo/</link>
      <pubDate>Tue, 18 Aug 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/helo/</guid>
      <description>å…¶ä¸­ï¼Œu.update(name=&amp;quot;Daisy&amp;rdquo;) ä¸ u.name = &amp;ldquo;Daisy&amp;rdquo; ç±»ä¼¼ï¼Œéƒ½æ˜¯åªåœ¨å†…å­˜é‡Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œä¸åŒçš„æ˜¯ u.update() è¿˜ä¼šè¿”å›ä¸€ä¸ªåŒ…å«æœ¬æ¬¡å˜æ›´çš„ä¸­é—´ç»“æœï¼Œå¯¹å…¶æ‰§è¡Œ await xxx.apply() åˆ™ä¼šå°†è¿™äº›å˜æ›´åº”ç”¨åˆ°æ•°æ®åº“é‡Œã€‚ Helo æ˜¯æœ¬äººä¸šä½™å¼€å‘çš„ä¸€ä¸ªç®€å•å°å‹ä½çº§åˆ«çš„å¼‚æ­¥(asyncio) Python ORMã€‚å®ƒå‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ¦‚å¿µï¼Œéå¸¸ç›´ç™½ï¼Œå®¹æ˜“ä¸Šæ‰‹ä½¿ç”¨ã€‚ æ­¤å¤„å»å¾€é¡¹ç›®ä»“åº“ ï¼Œæ¬¢è¿ä½¿ç”¨ã€æå‡ºæ„è§æˆ–è´¡çŒ®ä»£ç  ğŸ˜Š Helo å¯ä»¥åœ¨ä½ çš„å¼‚æ­¥åº”ç”¨ä¸­å¸®åŠ©ä½ è½»æ¾çš„æ„å»ºå‡ºå¯Œæœ‰è¡¨è¾¾åŠ›çš„å¸¸ç”¨ SQL è¯­å¥ï¼Œä½ åªéœ€ä»¥å‹å¥½çš„å¯¹è±¡åŒ– API æ¥æ“ä½œæ•°æ®ï¼Œè€Œä¸ç”¨å…³å¿ƒ SQL è¯­å¥ç¼–å†™ã€æ•°æ®å¤„ç†ç­‰ç»†èŠ‚ã€‚ è¯·æ³¨æ„ï¼šä½¿ç”¨å¼‚æ­¥ ORM å¹¶ä¸å®Œå…¨æ„å‘³ç€å¯ä»¥ä½¿ä½ çš„åº”ç”¨å˜å¿«ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¼šä½¿ä½ çš„åº”ç”¨å˜å¾—å¤æ‚ã€‚ç»§ç»­ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆé˜…è¯»ä¸‹ SQLAlchemy ä½œè€… Mike Bayer çš„ è¿™ç¯‡åšå®¢æ–‡ç« ã€‚ æœ¬ç¯‡ä¸Šæ‰‹æŒ‡å—ä¸»è¦ä»‹ç»ä»¥ä¸‹æ–¹é¢: å®‰è£… helo æ¨¡å‹å£°æ˜ å»ºç«‹è¿æ¥ æ•°æ®æ“ä½œ åœ¨ quart åº”ç”¨ä¸­ä½¿ç”¨ helo å…¶ä»–è¡¥å…… å¼€å§‹ä½¿ç”¨ å®‰è£… helo å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼: 1. å®‰è£… pypi çš„ç¨³å®šå‘å¸ƒç‰ˆæœ¬, åœ¨ç»ˆç«¯ä¸­è¿è¡Œæ­¤å‘½ä»¤: $ pip install helo 2. ä»æœ€æ–°çš„æºç å®‰è£… $ git clone https://github.com/at7h/helo.git $ cd helo $ python setup.py install å®‰è£…å®Œæˆåå°±å¼€å§‹ä¸‹é¢çš„å…¥å‘ä¹‹æ—…äº† ğŸ˜ˆ ã€‚ ä½¿ç”¨ helo, é¦–å…ˆä½ éœ€è¦å¼•å…¥ helo å¹¶ä½¿ç”¨ helo.G å®ä¾‹åŒ–ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå‡å®šç§°å…¶ä¸º db: import helo db = helo.G() db æ˜¯ä¸€ä¸ªå…¨å±€å•ä¾‹å¯¹è±¡ï¼Œä¸‹é¢çš„ä»‹ç»ä¸­æˆ‘ä»¬å°†å¤šæ¬¡ä½¿ç”¨åˆ°å®ƒã€‚ æ¨¡å‹å£°æ˜ ä½¿ç”¨ helo å£°æ˜æ¨¡å‹å¾ˆç®€å•ï¼Œåªéœ€ä» helo.Model ç»§æ‰¿å³å¯ã€‚ä¸‹é¢ç»™å‡ºå‡ ä¸ªæ¨¡å‹å£°æ˜çš„ç®€å•çš„ä¾‹å­ï¼š class Person(helo.Model): id = helo.BigAuto() name = helo.VarChar(length=45, null=False) class User(Person): email = helo.Email(default=&amp;#39;&amp;#39;) password = helo.VarChar(length=100, null=False) create_at = helo.Timestamp(default=helo.ON_CREATE) class Meta: indexes = [helo.K(&amp;#39;idx_ep&amp;#39;, [&amp;#39;email&amp;#39;, &amp;#39;password&amp;#39;])] class Employee(Person): department = helo.Smallint() salary = helo.Float(default=0) class Post(helo.Model): id = helo.Auto(comment=&amp;#39;auto increment pk&amp;#39;) title = helo.VarChar(length=100) content = helo.Text(encoding=helo.ENCODING.UTF8MB4) author = helo.Int(default=0) create_at = helo.Timestamp(default=helo.ON_CREATE) update_at = helo.Timestamp(default=helo.ON_UPDATE) class Meta: indexes = [ helo.K(&amp;#39;idx_title&amp;#39;, &amp;#39;title&amp;#39;), helo.K(&amp;#39;idx_author&amp;#39;, &amp;#39;author&amp;#39;), ] å†…éƒ¨ç±» Meta å¯ç”¨äºæŒ‡å®š db_name, table_name, engine, indexes, charset, comment ç­‰ Table çš„å…ƒå±æ€§ã€‚ class Meta: db = &amp;#39;db_name&amp;#39; name = &amp;#39;table_name&amp;#39; engine = helo.ENGINE.innodb charset = helo.ENCODING.utf8mb4 indexes = [] comment = &amp;#39;table comment&amp;#39; å…¶ä¸­ table_name é»˜è®¤ä¸º model ç±»åçš„ snake_case é£æ ¼åç§°ï¼Œengine é»˜è®¤ä¸º InnoDBï¼Œcharset é»˜è®¤ä¸º utf8mb4ã€‚ å»ºç«‹è¿æ¥ å‰é¢çš„æ¨¡å‹å£°æ˜åªæ˜¯å®šä¹‰äº†æ¨¡å‹ä¸çœŸå®è¡¨ç»“æ„çš„æ˜ å°„å…³ç³»ï¼Œå¹¶éå®é™…åœ¨æ•°æ®åº“ä¸­åˆ›å»ºäº†è¿™äº›è¡¨ç»“æ„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨ helo æ¥ä¸æ•°æ®åº“å»ºç«‹è¿æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª MySQL çš„æ•°æ®åº“å®ä¾‹ï¼š &amp;gt;&amp;gt;&amp;gt; await db.bind(&amp;#39;mysql://user:pwd@localhost:3306/helo&amp;#39;) æˆ–è€…ä¼ é€’é…ç½®å‚æ•°ï¼š &amp;gt;&amp;gt;&amp;gt; await db.bind(user=&amp;#39;user&amp;#39;, password=&amp;#39;pwd&amp;#39;, db=&amp;#39;helo&amp;#39;) å¦‚æœä½ è®¾ç½®äº†ç¯å¢ƒå˜é‡ HELO_DATABASE_URLï¼Œé‚£ä¹ˆä½ ä¸ç”¨å†ä¼ é€’ url: &amp;gt;&amp;gt;&amp;gt; await db.bind() å¦‚æœä½ æƒ³è‡ªå®šä¹‰ KEY çš„å€¼ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ– db æ—¶é€šè¿‡ env_key å‚æ•°æ¥è®¾ç½®: db = helo.G(env_key=&amp;quot;YOUR_ENV_KEY&amp;quot;) bind å®é™…ä¸Šä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼š &amp;gt;&amp;gt;&amp;gt; db.state {&amp;#39;minsize&amp;#39;: 1, &amp;#39;maxsize&amp;#39;: 15, &amp;#39;size&amp;#39;: 1, &amp;#39;freesize&amp;#39;: 1} bind ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå…³é”®å­—å‚æ•°æ¥å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰è®¾ç½®ï¼Œè¯¦è§ helo.db.Pool ç±»ã€‚ä¾‹å¦‚ï¼š &amp;gt;&amp;gt;&amp;gt; await db.bind(&amp;#39;mysql://user:pwd@127.0.0.1:3306/db&amp;#39;, maxsize=10, connect_timeout=15) å·²ç»åˆ›å»ºçš„è¿æ¥æ± å¯¹è±¡å°†æ˜¯ä¸€ä¸ªå…¨å±€çš„å•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ å·²ç»ä¸ºä½ çš„åº”ç”¨ç¨‹åºè°ƒç”¨ bind ç»‘å®šäº†æ•°æ®åº“ï¼Œåœ¨æ­¤ä¹‹å‰å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ unbind è¿›è¡Œè§£ç»‘ï¼Œä½ å°†ä¸èƒ½å†ç»§ç»­ä½¿ç”¨ bind å†æ¬¡ç»‘å®šå¦ä¸€ä¸ªæ•°æ®åº“ï¼Œå¦åˆ™ä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ª helo.err.DuplicateBinding é”™è¯¯ã€‚ å¦‚æœä½ éœ€è¦æ˜¾å¼åœ°æ–­å¼€ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œå…³é—­è¿æ¥æ± ï¼Œå¯ä»¥ä½¿ç”¨ unbind: &amp;gt;&amp;gt;&amp;gt; await db.unbind() åœ¨å°å‹çš„è„šæœ¬ä¸­ä½ å¯ä»¥ä½¿ç”¨ db.binder æ¥è‡ªåŠ¨å¤„ç†ä¸Šä¸‹æ–‡ï¼š &amp;gt;&amp;gt;&amp;gt; async with db.binder(): ... pass æ•°æ®æ“ä½œ ä¸æ•°æ®åº“å»ºç«‹äº†è¿æ¥ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®åº“åˆ›å»ºæˆ‘ä»¬çš„è¡¨ï¼Œä»¥ä¾¿äºæ¥ä¸‹æ¥è¿›è¡Œæ•°æ®çš„æ“ä½œã€‚ åœ¨çœŸæ­£çš„åº”ç”¨ä¸­ï¼Œæ•°æ®åº“è¡¨çš„è®¾è®¡åˆ›å»ºä¸ç»´æŠ¤æ˜¯å•ç‹¬åˆ†å¼€ï¼Œä¸€èˆ¬ç”±ä¸“é—¨çš„ DBA æ¥ç®¡ç†ã€‚å½“ç„¶ helo ä¹Ÿæä¾›äº†åŸºç¡€çš„ DDL æ”¯æŒã€‚ ä¸‹é¢æˆ‘ä»¬åœ¨æ•°æ®åº“åˆ›å»ºå®ƒä»¬ï¼š &amp;gt;&amp;gt;&amp;gt; await db.create_tables([User, Employee, Post]) åœ¨åº”ç”¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†æ‰€æœ‰çš„æ¨¡å‹å£°æ˜å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œåœ¨æ­¤å‡è®¾æ¨¡å—åä¸º modelsï¼Œåˆ™å¯ä»¥ä½¿ç”¨ create_all ä¸ºæ¨¡å—ä¸­æ‰€æœ‰çš„ model åˆ›å»ºè¡¨ï¼š &amp;gt;&amp;gt;&amp;gt; from your.application import models &amp;gt;&amp;gt;&amp;gt; await db.create_all(models) å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Model çš„æ–¹æ³•æ¥å•ç‹¬åˆ›å»º: &amp;gt;&amp;gt;&amp;gt; await User.create() Helo æä¾›äº†åŸºæœ¬çš„æ“ä½œæ•°æ®åº“ä¸­æ•°æ®çš„èƒ½åŠ›ï¼Œæ”¯æŒä¸°å¯Œçš„å¯ç»„åˆçš„é€»è¾‘è¿ç®—è¡¨è¾¾ï¼Œä½ å¯ä»¥è½»æ¾çš„å®Œæˆå¯Œæœ‰è¡¨è¾¾åŠ›çš„ queriesï¼Œä»¥å®ç°é€šè¿‡å¯¹è±¡åŒ–çš„ API æ¥æ„å»ºä½ æƒ³è¦çš„ SQL è¯­å¥(DML å’Œ DQL)çš„èƒ½åŠ›ã€‚ ä¸‹é¢ç¤ºä¾‹åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥çš„æ“ä½œã€‚ å¢ ä½¿ç”¨ helo ä½ å¯ä»¥æœ‰å¤šç§æ’å…¥æ•°æ®çš„æ–¹å¼é€‰æ‹©ï¼Œæˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ª User å¯¹è±¡å¼€å§‹: user = User(name=&amp;#39;at7h&amp;#39;, password=&amp;#39;1111&amp;#39;) print(user.name, user.password) # at7h, 1111 # Now user.id is None, because it is not saved to the database assert user.id is None æ­¤æ—¶çš„ user ä»…æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½ éœ€è¦é€šè¿‡ save æ–¹æ³•æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼š user_id = await user.save() assert user_id == user.id == 1 æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒï¼Œå¹¶ä¿å­˜æ›´æ”¹ï¼š user.name = &amp;#39;at8h&amp;#39; user.email = &amp;#39;g@at7h.com&amp;#39; user_id = await user.save() assert user_id == user.id == 1 è¯·æ³¨æ„ï¼š ç›®å‰ save æ“ä½œæ˜¯é€šè¿‡ MySQL REPLACE è¯­å¥å®ç°ï¼Œå…¶æ ¹æ®å¯¹è±¡çš„ PRIMARY KEY å±æ€§æˆ– UNIQUE KEY å±æ€§çš„å€¼æ¥å†³å®šæ˜¯å¦æ’å…¥æ–°è¡Œï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼è¯¥å®ç°è®¡åˆ’åœ¨åç»­ç‰ˆæœ¬ä¸­ä¼˜åŒ–ã€‚ æ¨èä½¿ç”¨ä¸‹é¢å‡ ç§æ–¹å¼æ¥æ’å…¥æ•°æ®ã€‚ æ–¹æ³• add, madd å¯ä»¥ç”¨æ¥æ·»åŠ å•æ¡æˆ–å¤šæ¡æ•°æ®ï¼Œå®ƒä»¬æ˜¯ insert, minsert çš„ç®€å•å¿«æ·æ–¹å¼ï¼š user_id = await User.add(name=&amp;#39;bobo&amp;#39;, password=&amp;#39;2222&amp;#39;) # Or: user_id = await User.add({&amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;2222&amp;#39;}) print(user_id) # 2 users = [{&amp;#39;name&amp;#39;: &amp;#39;mingz&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;3333&amp;#39;}, {&amp;#39;name&amp;#39;: &amp;#39;xy69z&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;4444&amp;#39;}] # Or using user object list: # users = [User(name=&amp;#39;mingz&amp;#39;, password=&amp;#39;3333&amp;#39;), # User(name=&amp;#39;xy69z&amp;#39;, password=&amp;#39;4444&amp;#39;)] count = await User.madd(users) print(count) # 2 æ–¹æ³• insert å’Œ minsert æ˜¯æœ€æ­£ç¡®çš„æ•°æ®æ’å…¥å§¿åŠ¿ï¼Œå®ƒä»¬å¯ä»¥èƒœä»»å¤šç§æ•°æ®å½¢å¼ï¼Œå®ƒä»¬å°†è¿”å›ä¸€ä¸ª Insert å¯¹è±¡ï¼Œè¦æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·ä¸è¦å¿˜äº†å†™ do() å“¦ ğŸ˜‰ï¼š ret = await User.insert(name=&amp;#39;poper&amp;#39;, password=&amp;#39;5555&amp;#39;).do() # Or: ret = await User.insert({&amp;#39;name&amp;#39;: &amp;#39;bingo&amp;#39;, &amp;#39;password&amp;#39;: &amp;#39;8888&amp;#39;}).do() assert ret.affected == 1 assert ret.last_id == 5 print(ret) # (1, 5) # Inserting multiple employees = [ {&amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;, &amp;#39;department&amp;#39;: 1}, {&amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;, &amp;#39;department&amp;#39;: 2}, ] ret = await Employee.minsert(employees).do() print(ret) # (2, 1) # Specify row tuples columns the tuple values correspond to posts = [ (&amp;#39;post1&amp;#39;, 1), (&amp;#39;post2&amp;#39;, 2), ] ret = await Post.minsert( posts, columns=[Post.title, Post.author] ).do() print(ret) # (2, 1) ä½¿ç”¨ insert_from æ”¯æŒè¡¨é—´æ•°æ®å¡«å……ï¼š select = User.select(User.name).where(User.id.in_([3, 4, 5])) ret = await Employee.insert_from(select, [Employee.name]).do() print(ret) # (3, 3) æŸ¥ Helo ä¹Ÿæœ‰å¤šç§è·å–æ•°æ®çš„æ–¹å¼é€‰æ‹©ï¼Œå¦‚ç®€å•è·å–å•æ¡æ•°æ®å¯ä»¥ä½¿ç”¨ get æ–¹æ³•ï¼š # By id user = await User.get(1) assert isinstance(user, User) print(user.id, user.name, user.password) # 1, at7h, 1111 # Or by query assert (await User.get(User.name == user.name)) == user è·å–å¤šæ¡æ•°æ®å¯ä»¥ä½¿ç”¨ mget æ–¹æ³•ï¼š # By id list uid_list = [1, 2, 3] users = await User.mget(uid_list) print(users.count) # 3 print(users) # [&amp;lt;User object at 1&amp;gt;, &amp;lt;User object at 2&amp;gt;, &amp;lt;User object at 3&amp;gt;] # Specify columns users = await User.mget(uid_list, columns=[User.id, User.name]) assert users[0].password is None # Or by query users = await User.mget((User.id &amp;lt; 2) | (User.name == &amp;#39;mingz&amp;#39;)) print(users) # [&amp;lt;User object at 1&amp;gt;, &amp;lt;User object at 3&amp;gt;] åŒæ ·çš„ï¼Œæ–¹æ³• get å’Œ mget ä¹Ÿæ˜¯ select çš„ç®€å•å¿«æ·ç‰ˆæœ¬ï¼Œå…¶åªé€‚åˆäºå·²çŸ¥ä¸»é”®æˆ–æŸ¥è¯¢æ¡ä»¶æ¯”è¾ƒç®€å•çš„åœºæ™¯ï¼Œæ›´å¤šçš„æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä½¿ç”¨ selectã€‚ ä½¿ç”¨ select æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ ä»¥å¯¹è±¡åŒ– API çš„æ–¹å¼è½»æ¾çš„æ„é€ ä½ çš„ DQLï¼Œå…¶æ”¯æŒä¸°å¯Œçš„å¯ç»„åˆçš„é€»è¾‘æ¡ä»¶è¡¨è¾¾å¼ã€‚ users = await User.select().order_by( User.id.desc() ).limit(3).offset(2).all() print(users) # [&amp;lt;User object at 5&amp;gt;, &amp;lt;User object at 4&amp;gt;, &amp;lt;User object at 3&amp;gt;] æ–¹æ³• all() ä»¥åŠä¸‹é¢æåˆ°çš„ get(), first(), rows(), paginate() ç­‰æ–¹æ³•ç±»ä¼¼äºä¸Šé¢æåˆ°çš„ do()ï¼Œéƒ½ç”¨äºé©±åŠ¨æ‰§è¡Œæ­¤æ¬¡æŸ¥è¯¢ï¼Œä¸è¦å¿˜äº†å“¦ã€‚ æ¯”å¦‚æˆ‘éœ€è¦çŸ¥é“æœ‰æ²¡æœ‰ä½¿ç”¨ gmail é‚®ç®±çš„ç”¨æˆ·ï¼š is_exist = await User.select().where( User.email.endswith(&amp;#39;gmail.com&amp;#39;) ).exist() print(is_exist) # False æ¯”å¦‚æˆ‘æƒ³çŸ¥é“ 2019 å¹´ 7 æœˆä»¥æ¥å…±æ–°å¢äº†å¤šå°‘ç”¨æˆ·ï¼š user_count = await User.select().where( User.create_at &amp;gt; datetime(2019, 7, 1) ).count() print(user_count) # 4 å†æ¯”å¦‚æˆ‘ä»¬éœ€è¦åˆ†é¡µçš„è·å–ä»Šå¹´å†™äº† Python(title) ç›¸å…³æ–‡ç« çš„ç”¨æˆ·ï¼š users = await User.select().where( User.id.in_( Post.select(Post.author).where( Post.update_at &amp;gt; datetime(2019, 1, 1), Post.title.contains(&amp;#39;Python&amp;#39;) ).order_by( Post.update_at.desc() ) ) ).paginate(1, 10) print(users) # [&amp;lt;User object at 1&amp;gt;] å†æ¯”å¦‚æˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªç”¨æˆ·éƒ½å†™äº†å¤šå°‘ç¯‡æ–‡ç« ï¼š user_posts = await User.select( User.name, helo.F.COUNT(helo.SQL(&amp;#39;1&amp;#39;)).as_(&amp;#39;posts&amp;#39;) ).join( Post, helo.JOINTYPE.LEFT, on=(User.id == Post.author) ).group_by( User.name ).rows(100) print(user_posts) # [{&amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;, &amp;#39;posts&amp;#39;: 1}] å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ helo.F æ¥ä½¿ç”¨ SQL å‡½æ•°ï¼Œæ¯”å¦‚æˆ‘éœ€è¦è®¡ç®—å‡ºæ¯ä¸ªæœˆæ‰€æœ‰é›‡å‘˜è–ªèµ„çš„æ€»å’Œï¼š salary_sum = await Employee.select( helo.F.SUM(Employee.salary).as_(&amp;#39;salary_sum&amp;#39;) ).scalar() print(salary_sum) # 30000.0 æ”¹ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å°è¯•å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®åšä¸€äº›ä¿®æ”¹æ“ä½œã€‚ æ¯”å¦‚ä½ è¦æ›´æ”¹æŸä¸€ä½é›‡å‘˜çš„è–ªèµ„ ğŸ˜‹ï¼š ret = await Employee.update(salary=20000).where( Employee.name == &amp;#39;at7h&amp;#39; ).do() print(ret.affected) # 1 æˆ–è€…ï¼Œæ•´ä½“æ¶¨å·¥èµ„å•¦ ğŸ‘ï¼š ret = await Employee.update( salary=Employee.salary + 1000 ).where( (Employee.department.in_([1, 2])) | (Employee.name == &amp;#39;at7h&amp;#39;) ).do() åˆ  æœ€åæˆ‘ä»¬æ¥å°è¯•åˆ é™¤è¡¨ä¸­çš„æ•°æ®ã€‚ ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ model å¯¹è±¡çš„ remove æ–¹æ³•æ¥åˆ é™¤å®ƒå¯¹åº”äºæ•°æ®åº“ä¸­è¿™ä¸€è¡Œçš„æ•°æ®ï¼š user = User(name=&amp;#39;at7h&amp;#39;, password=&amp;#39;1111&amp;#39;) await user.save() user = await User.get(user_id) print(user.id) # 1 await user.remove() user = await User.get(user_id) print(user) # None å¦ä¸€ç§æ›´ä¸ºé€šå¸¸çš„æ–¹å¼æ˜¯ä½¿ç”¨ delete æ–¹æ³•ï¼š ret = await Post.delete().where( Post.create_at &amp;lt; datetime(2010, 1, 1) ).limit( 100 ).do() è¯·æ³¨æ„ï¼š æ°¸è¿œä¸è¦å¿˜è®°å†™ where å­å¥ï¼Œæ˜¯ä¸æ˜¯æ•´ä¸ªè¡¨éƒ½ä¸æƒ³è¦äº† ğŸ˜Ÿ ï¼Ÿ Replace å¦å¤–ï¼Œhelo æ”¯æŒ MySQL REPLACE è¯­å¥ï¼Œæä¾›äº† replace å’Œ mreplace ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ç”¨æ³•ä¸ insert å’Œ minsert ç±»ä¼¼ã€‚å½“ç„¶ï¼Œåœ¨ä½¿ç”¨å®ƒä»¬ä¹‹å‰ä½ éœ€è¦äº†è§£ MySQL REPLACE è¯­å¥çš„å·¥ä½œåŸç†ã€‚ Quart åº”ç”¨ å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ quart, ä¸€ä¸ªæœ€å°çš„åº”ç”¨ç¤ºä¾‹æ˜¯: import quart import helo app = quart.Quart(__name__) app.config[&amp;#34;HELO_DATABASE_URL&amp;#34;] = &amp;#34;mysql://user:password@127.0.0.1:3306/db&amp;#34; db = helo.G(app) @app.route(&amp;#39;/api/users&amp;#39;) async def users(): await User.insert( name=&amp;#39;at7h&amp;#39;, email=&amp;#39;g@test.com&amp;#39;, password=&amp;#39;xxxx&amp;#39; ).do() user_list = await User.select().all(False) return quart.jsonify(user_list) app.run() æ­¤æ—¶ä½ ä¸éœ€è¦å†æ˜¾ç¤ºçš„æ‰§è¡Œ db.bindï¼Œbinding æ“ä½œå°†ä¼šåœ¨ä½ åº”ç”¨çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰è‡ªåŠ¨å®Œæˆã€‚ å¯åŠ¨æ­¤æœåŠ¡: $ curl http://127.0.0.1:5000/api/users [{&amp;#34;email&amp;#34;:&amp;#34;g@test.com&amp;#34;,&amp;#34;id&amp;#34;:1,&amp;#34;name&amp;#34;:&amp;#34;at7h&amp;#34;,&amp;#34;password&amp;#34;:&amp;#34;xxxx&amp;#34;}] å…¶ä»– Model Iteration Helo ä¸­çš„ Model å’Œ Select éƒ½æ”¯æŒè¿­ä»£ï¼Œhelo ä¼šè‡ªåŠ¨å¸®ä½ å¤„ç†åˆ†é¡µé—®é¢˜ï¼Œä»¥é¿å…é¢‘ç¹çš„ IO æ“ä½œå’Œè¿‡å¤§çš„æ•°æ®é‡è·å–ã€‚ async for post in Post: print(post) # &amp;lt;Post object at 1&amp;gt; # &amp;lt;Post object at 2&amp;gt; # &amp;lt;Post object at 3&amp;gt; # &amp;lt;Post object at 4&amp;gt; users = User.select().where(User.id &amp;lt; 5).order_by(User.id.desc()) async for user in users: print(user) # &amp;lt;User object at 4&amp;gt; # &amp;lt;User object at 3&amp;gt; # &amp;lt;User object at 2&amp;gt; # &amp;lt;User object at 1&amp;gt; Row Type å½“ä½ ä½¿ç”¨ select è·å–æ•°æ®æ—¶ï¼Œhelo é»˜è®¤ä¼šå°†è¡Œæ•°æ®åŒ…è£…æˆä¸ºå¯¹åº”çš„ Model å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œå½“ä½ ä½¿ç”¨äº† helo.F å‡½æ•°å’Œ join æ—¶å¯èƒ½ä¼šæ”¾å¼ƒåŠ è½½åˆ° Model å¯¹è±¡è€Œä½¿ç”¨åŸå§‹çš„ helo.adict å­—å…¸ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ wrap å‚æ•°æ¥æ˜¾å¼æŒ‡å®šä½¿ç”¨å­—å…¸ç±»å‹çš„ row typeã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™å¯èƒ½ä¼šæ˜¾è‘—æé«˜é€Ÿåº¦å¹¶å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚ users = await User.select(User.id, User.name).limit(2).all(wrap=False) print(users) # [{&amp;#39;id&amp;#39;: 1, &amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;}, {&amp;#39;id&amp;#39;: 2, &amp;#39;name&amp;#39;: &amp;#39;bobo&amp;#39;}] assert users[0].name == &amp;#39;at7h&amp;#39; employee = await Employee.select().order_by( Employee.salary.desc() ).first(False) print(employee) # {&amp;#39;id&amp;#39;: 1, &amp;#39;name&amp;#39;: &amp;#39;at7h&amp;#39;, &amp;#39;department&amp;#39;: 1, &amp;#39;salary&amp;#39;: 15000.0} SQL æ‰§è¡Œ SQL æœ‰æ—¶ä½ å¯èƒ½è¿«ä¸å¾—å·²æƒ³è¦æ‰§è¡Œä¸€äº›åŸå§‹çš„ SQL è¯­å¥ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ db.raw å‡½æ•°æ¥å®ç°ã€‚ await db.raw(&amp;#34;SELECT * FROM `user` WHERE `id` &amp;lt; %s;&amp;#34;, params=[10]) æŸ¥çœ‹ SQL ä¸ºæ–¹ä¾¿è°ƒè¯•ï¼Œæœ‰æ—¶å€™éœ€è¦æŸ¥çœ‹æ‰§è¡Œçš„ SQLï¼Œåœ¨ helo ä¸­ï¼Œä½ å¯ä»¥: ç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨åˆå§‹åŒ– db æ—¶ï¼Œè®¾ç½® debug ä¸º True å³å¯ï¼Œè¿™æ ·ä½ å°†åœ¨æ—¥å¿—è¾“å‡ºä¸­çœ‹åˆ°æ‰§è¡Œè¿‡çš„æ‰€æœ‰ SQL è¯­å¥ã€‚ db = helo.G(debug=True) ç¬¬äºŒç§æ–¹å¼ä¸»è¦æ˜¯æ–¹ä¾¿å­¦ä¹ å’Œè°ƒè¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨ repr å‡½æ•°(æˆ–åœ¨ REPR ç¯å¢ƒä¸­)å’Œ str å‡½æ•°æ¥æŸ¥çœ‹ Insert, Update, Select ç­‰å¯¹è±¡ï¼Œæˆ‘ä»¬æ‹¿ä¸Šé¢çš„ç¤ºä¾‹æ¥ä¸¾ä¸ªä¾‹å­ï¼š &amp;gt;&amp;gt;&amp;gt; q1 = Employee.update( ... salary=Employee.salary + 1000 ... ).where( ... (Employee.department.in_([1, 2])) | (Employee.name == &amp;#39;at7h&amp;#39;) ... ) &amp;gt;&amp;gt;&amp;gt; q1 Query(UPDATE `employee` SET `salary` = (`salary` + %s) WHERE ((`department` IN %s) OR (`name` = %s)); % ((1000.0,), (1, 2), &amp;#39;at7h&amp;#39;)) &amp;gt;&amp;gt;&amp;gt; q2 = User.select( ... User.name, helo.F.COUNT(helo.SQL(&amp;#39;1&amp;#39;)).as_(&amp;#39;posts&amp;#39;) ... ).join( ... Post, helo.JOINTYPE.LEFT, on=(User.id == Post.author) ... ).group_by( ... User.name ... ) &amp;gt;&amp;gt;&amp;gt; print(q2) SELECT `t1`.`name`, COUNT(1) AS `posts` FROM `user` AS `t1` LEFT JOIN `post` AS `t2` ON (`t1`.`id` = `t2`.`author`) GROUP BY `t1`.`name`; % () æœ¬ç¯‡ä¸Šæ‰‹æŒ‡å—å°±åˆ°æ­¤ç»“æŸã€‚ ååˆ†æ¬¢è¿å¤§å®¶çš„ä½¿ç”¨ï¼Œæœ‰ä»»ä½•é—®é¢˜å¯éšæ—¶ä¸æˆ‘äº¤æµæˆ–åˆ° é¡¹ç›®ä»“åº“ åé¦ˆï¼Œæ¬¢è¿ä»¥ä»»ä½•å½¢å¼æå‡ºä»»ä½•é—®é¢˜æˆ–å»ºè®®ã€‚ æ„Ÿè°¢ ğŸ¤</description>
    </item>
    
    <item>
      <title>Golang é›¶å€¼ã€ç©ºå€¼ä¸ç©ºç»“æ„</title>
      <link>https://at7h.com/posts/go-null/</link>
      <pubDate>Sat, 01 Aug 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/go-null/</guid>
      <description>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬è®¨è®ºä¸‹æœ‰å…³ Golang ä¸­çš„é›¶å€¼ï¼ˆThe zero valueï¼‰ã€ç©ºå€¼ï¼ˆnilï¼‰å’Œç©ºç»“æ„ï¼ˆThe empty structï¼‰çš„ç›¸å…³é—®é¢˜ä»¥åŠå®ƒä»¬çš„ä¸€äº›ç”¨é€”ã€‚ é›¶å€¼ é›¶å€¼æ˜¯æŒ‡å½“ä½ å£°æ˜å˜é‡ï¼ˆåˆ†é…å†…å­˜ï¼‰å¹¶æœªæ˜¾å¼åˆå§‹åŒ–æ—¶ï¼Œå§‹ç»ˆä¸ºä½ çš„å˜é‡è‡ªåŠ¨è®¾ç½®ä¸€ä¸ªé»˜è®¤åˆå§‹å€¼çš„ç­–ç•¥ã€‚ é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹æœ‰å…³é›¶å€¼ï¼ˆThe zero valueï¼‰çš„è§„èŒƒï¼š When storage is allocated for a variable, either through a declaration or a call of new, or when a new value is created, either through a composite literal or a call of make, and no explicit initialization is provided, the variable or value is given a default value. Each element of such a variable or value is set to the zero value for its type: false for booleans, 0 for numeric types, &amp;quot;&amp;rdquo; for strings, and nil for pointers, functions, interfaces, slices, channels, and maps. This initialization is done recursively, so for instance each element of an array of structs will have its fields zeroed if no value is specified. æ®æ­¤æˆ‘ä»¬å¯æ€»ç»“å‡ºï¼š å¯¹äºå€¼ç±»å‹ï¼šå¸ƒå°”ç±»å‹ä¸º false, æ•°å€¼ç±»å‹ä¸º 0ï¼Œå­—ç¬¦ä¸²ä¸º &amp;quot;&amp;quot;ï¼Œæ•°ç»„å’Œç»“æ„ä¼šé€’å½’åˆå§‹åŒ–å…¶å…ƒç´ æˆ–å­—æ®µï¼Œå³å…¶åˆå§‹å€¼å–å†³äºå…ƒç´ æˆ–å­—æ®µã€‚ å¯¹äºå¼•ç”¨ç±»å‹ï¼š å‡ä¸º nilï¼ŒåŒ…æ‹¬æŒ‡é’ˆ pointerï¼Œå‡½æ•° functionï¼Œæ¥å£ interfaceï¼Œåˆ‡ç‰‡ sliceï¼Œç®¡é“ channelï¼Œæ˜ å°„ mapã€‚ é€šå¸¸ï¼Œä¸ºä½ å£°æ˜çš„å˜é‡èµ‹äºˆä¸€ä¸ªé»˜è®¤å€¼æ˜¯æœ‰ç”¨çš„ï¼Œå°¤å…¶æ˜¯ä¸ºä½ æ•°ç»„å’Œç»“æ„ä¸­çš„å…ƒç´ æˆ–å­—æ®µè®¾ç½®é»˜è®¤å€¼ï¼Œè¿™æ˜¯ä¸€ç§ä¿è¯å®‰å…¨æ€§å’Œæ­£ç¡®æ€§çš„åšæ³•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è®©ä½ çš„ä»£ç ä¿æŒç®€æ´ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ï¼Œç»“æ„ä½“ Value ä¸­åŒ…å«ä¸¤ä¸ª unexported å­—æ®µï¼Œsync.Mutex ä¸­ä¹Ÿæœ‰ä¸¤ä¸ª unexported å­—æ®µã€‚å› ä¸ºæœ‰é»˜è®¤é›¶å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š package main import &amp;#34;sync&amp;#34; type Value struct { mu sync.Mutex val int } func (v *Value)Incr(){ defer v.mu.Unlock() v.mu.Lock() v.val++ } func main() { var i Value i.Incr() } å› ä¸ºåˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹çš„ï¼Œæ‰€ä»¥å…¶é›¶å€¼ä¹Ÿæ˜¯ nilï¼š package main import &amp;#34;fmt&amp;#34; import &amp;#34;strings&amp;#34; func main(){ var s []string fmt.Println(s, len(s), cap(s)) // [] 0 0 fmt.Println(s == nil) // true s = append(s, &amp;#34;Hello&amp;#34;) s = append(s, &amp;#34;World&amp;#34;) fmt.Println(strings.Join(s, &amp;#34;, &amp;#34;)) // Hello, World } ä¸‹é¢çš„æƒ…å†µéœ€è¦ç‰¹åˆ«æ³¨æ„ä¸‹ï¼Œæœ‰æ—¶å€™ä¸æ³¨æ„å°±å®¹æ˜“æ··æ·†ï¼Œ:= è¯­æ³•ç³–æ˜¯å£°æ˜å¹¶ä¸”åˆå§‹åŒ–å˜é‡çš„ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªçœŸæ­£çš„å®ä¾‹ï¼ˆä¸ºå…¶åˆ†é…äº†å†…å­˜åœ°å€çš„ï¼‰ï¼Œå¹¶ä¸æ˜¯é›¶å€¼ nilï¼š package main import &amp;#34;fmt&amp;#34; import &amp;#34;reflect&amp;#34; func main() { var s1 []string s2 := []string{} // æˆ–è€…ç­‰åŒäº var s2 = []string{} fmt.Println(s1 == nil) // true fmt.Println(s2 == nil) // false fmt.Println(reflect.DeepEqual(s1, s2)) // false fmt.Println(reflect.DeepEqual(s1, []string{})) // false fmt.Println(reflect.DeepEqual(s2, []string{})) // true } å¦å¤–ï¼Œå¯¹äºç©ºç»“æ„çš„ nil æ˜¯å¯ä»¥è°ƒç”¨è¯¥ç±»å‹çš„æ–¹æ³•çš„ï¼Œè¿™è¿˜å¯ä»¥ç”¨æ¥ç®€å•åœ°æä¾›é»˜è®¤å€¼ï¼š package main import &amp;#34;fmt&amp;#34; const defaultPath = &amp;#34;/usr/bin/&amp;#34; type Config struct { path string } func (c *Config) Path() string { if c == nil { return defaultPath } return c.path } func main() { var c1 *Config var c2 = &amp;amp;Config{ path: &amp;#34;/usr/local/bin/&amp;#34;, } fmt.Println(c1.Path(), c2.Path()) } nil å¯¹äºä¸€ä¸ªåˆšå¼€å§‹ä½¿ç”¨ Golang çš„å¼€å‘äººå‘˜ï¼Œåˆšå¼€å§‹æ¥è§¦ nil åº”è¯¥æ˜¯ä½¿ç”¨å®ƒæ¥æ£€æŸ¥é”™è¯¯ï¼Œå¤§è‡´åƒè¿™æ ·ï¼š func doSomething() error { return nil } func main(){ if doSomething() != nil { return err } } è¿™æ˜¯ Golang æƒ¯ç”¨çš„ï¼Œå®ƒé¼“åŠ±å¼€å‘äººå‘˜æ˜¾å¼çš„çš„å°†é”™è¯¯ä½œä¸ºè¿”å›å€¼æ¥å¤„ç†ã€‚ç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸‹è¿™ä¸ª nilï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„å®šä¹‰ï¼Œæ¯”å¦‚ Cã€C++ã€Java ç­‰ä¸­çš„ nullï¼ŒPython ä¸­çš„ Noneï¼Œä½†æ˜¯ Goalng ä¸­çš„ nil ä¸å®ƒä»¬æœ‰ç€å¾ˆå¤šåŒºåˆ«ã€‚ nil æ˜¯ Golang ä¸­é¢„å…ˆå£°æ˜çš„æ ‡è¯†ç¬¦ï¼ˆéå…³é”®å­—ä¿ç•™å­—ï¼‰ï¼Œå…¶ä¸»è¦ç”¨æ¥è¡¨ç¤ºå¼•ç”¨ç±»å‹çš„é›¶å€¼ï¼ˆæŒ‡é’ˆï¼Œæ¥å£ï¼Œå‡½æ•°ï¼Œæ˜ å°„ï¼Œåˆ‡ç‰‡å’Œé€šé“ï¼‰ï¼Œè¡¨ç¤ºå®ƒä»¬æœªåˆå§‹åŒ–çš„å€¼ã€‚ // [src/builtin/builtin.go](https://golang.org/src/builtin/builtin.go#L98) // // nil is a predeclared identifier representing the zero value for a // pointer, channel, func, interface, map, or slice type. var nil Type // Type must be a pointer, channel, func, interface, map, or slice type nil æ˜¯ Golang ä¸­å”¯ä¸€æ²¡æœ‰é»˜è®¤ç±»å‹çš„éç±»å‹åŒ–çš„å€¼ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„çŠ¶æ€ã€‚æ‰€ä»¥ä½ ä¸èƒ½åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š a := nil // cannot declare variable as untyped nil: a å°†ä¸€ä¸ªå¹¶æ²¡æœ‰ç±»å‹ nil çš„å€¼èµ‹ç»™ a æ˜¯ä¸å¯¹çš„ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“å®ƒè¯¥ç»™ a åˆ†é…ä»€ä¹ˆç±»å‹ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ Golang ä¸­æ¯”è¾ƒå‡ºåçš„ nil != nil çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¸€ä¸ªä¾‹å­ï¼š var p *int var i interface{} fmt.Println(p) // &amp;lt;nil&amp;gt; fmt.Println(i) // &amp;lt;nil&amp;gt; fmt.Println(p == i) // false Whyï¼Ÿä¸ºä»€ä¹ˆåŒæ ·éƒ½æ˜¯ nil å´ä¸ç›¸ç­‰å‘¢ï¼Ÿ å¸¦ç€é—®é¢˜ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¸‹é¢çš„ä¾‹å­ï¼ˆæ¥è‡ªå®˜æ–¹ Why is my nil error value not equal to nilï¼‰: func Foo() error { var err *MyError = nil if bad() { err = ErrBad } return err } func main() { err := Foo() fmt.Println(err) // &amp;lt;nil&amp;gt; fmt.Println(err == nil) // false } å…¶ç½ªé­ç¥¸é¦–å°±æ˜¯ interfaceï¼Œæ¥å£ç›¸å…³çš„å®ç°åŸç†ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ï¼Œåé¢å†å…·ä½“åˆ†äº«ã€‚å…¶å¤§è‡´åŸç†æ˜¯ï¼Œæ¥å£è¦ç¡®å®šä¸€ä¸ªå˜é‡éœ€è¦ä¸¤ä¸ªåŸºç¡€å±æ€§ï¼šType and Valueï¼Œä¸‹é¢æˆ‘ä»¬ç»™ä¸Šé¢çš„ä¸¤æ®µä»£ç åŠ ä¸Šæ³¨é‡Šï¼Œå°±æ˜ç™½äº†ï¼š var p *int // (T=*int,V=nil) var i interface{} // (T=nil,V=nil) fmt.Println(p == i) // (T=*int, V=nil) == (T=nil, V=nil) -&amp;gt; false func Foo() error { var err *PathError = nil // (T=*PathError, V=nil) if bad() { err = ErrBad } return err // è¿™å°†å§‹ç»ˆè¿”å› non-nil é”™è¯¯ } func main() { err := Foo() fmt.Println(err) // &amp;lt;nil&amp;gt; fmt.Println(err == nil) // (T=*PathError, V=nil) == (T=nil, V=nil) -&amp;gt; false } è¯·æ³¨æ„ï¼šä¸ºäº†é¿å…æ­¤é—®é¢˜ï¼Œè¿”å›é”™è¯¯æ—¶è¯·æ°¸è¿œä½¿ç”¨ error æ¥å£ï¼Œå¹¶ä¸”æ°¸è¿œä¸è¦åˆå§‹åŒ–å¯èƒ½ä»å‡½æ•°è¿”å›çš„ç©ºé”™è¯¯å˜é‡ã€‚ æˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­å†æ”¹æ”¹ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š var p *int // (T=*int, V=nil) var i interface{} // (T=nil, V=nil) fmt.Println(p == nil) // true fmt.Println(i == nil) // true i = p fmt.Println(i == nil) // (T=*int, V=nil) == (T=nil, V=nil) -&amp;gt; false è¿™ä¸ªé—®é¢˜çš„å®è´¨å°±æ˜¯ Go Tour ä¸­çš„ Interface values with nil underlying valuesã€‚ ç¤ºä¾‹ä¸­ i å¯ä»¥ä¼ é€’ç»™ä¸€ä¸ª interface{} ä½œä¸ºè¾“å…¥å‚æ•°çš„å‡½æ•°ï¼Œä½ åªæ£€æŸ¥ i == nil æ˜¯ä¸å¤Ÿçš„ã€‚æ‰€ä»¥å¯¹äºæ¥å£ç±»å‹çš„ç©ºæŒ‡é’ˆçš„åˆ¤æ–­ï¼Œæœ‰äº›æ—¶å€™ä½ å¹¶ä¸èƒ½å®‰å…¨çš„ä¾é  v == nilï¼Œå°½ç®¡è¿™ç§æ£€æŸ¥çš„å‘å¾ˆå°‘å‘ç”Ÿï¼Œä½†è¿™æœ‰æ—¶å€™å¯èƒ½ä¼šä½¿ä½ çš„ç¨‹åºå´©æºƒã€‚å¯¹æ­¤ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼è§£å†³ï¼Œä½ å¯ä»¥åˆ†åˆ«å°†ç±»å‹å’Œå€¼åˆ†åˆ«å’Œ nil æ¯”è¾ƒæˆ–è€…ä½¿ç”¨åå°„åŒ… reflectã€‚ è¯·è®°ä½ï¼šå¦‚æœæ¥å£ä¸­å·²å­˜å‚¨ä»»ä½•å…·ä½“å€¼ï¼Œé‚£ä¹ˆæ¥å£å°†ä¸ä¼šæ˜¯ nilï¼Œè¯¦è§åå°„å®šå¾‹ã€‚ è¿˜æœ‰å°±æ˜¯ï¼Œä¹Ÿè®¸ä½ ä¹Ÿæ„Ÿåˆ°å›°æƒ‘ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä¸ºä»€ä¹ˆä¸‹é¢çš„ç±»å‹å°±å¯ä»¥ç›´æ¥æ¯”è¾ƒå¹¶è·å¾—å‡†ç¡®çš„ç»“æœï¼š var p *int // (T=*int, V=nil) fmt.Println(p == nil) // true è¿™æ˜¯å› ä¸ºåœ¨è¿›è¡Œä¸Šé¢çš„æ¯”è¾ƒæ—¶ï¼Œå› ä¸ºç¼–è¯‘å™¨å·²ç»æ¸…æ¥šçš„çŸ¥é“äº† p çš„ç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¯ä»¥è½¬åŒ–ä¸º p == (*int)(nil)ã€‚ä½†æ˜¯å¯¹äºæ¥å£ï¼Œç¼–è¯‘å™¨æ˜¯æ²¡æ³•ç¡®å®šåº•å±‚ç±»å‹çš„ï¼Œå› ä¸ºå®ƒæ˜¯å¯ä»¥è¢«æ›´æ”¹çš„ã€‚ ç©ºç»“æ„ ç©ºç»“æ„æ˜¯æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç»“æ„ç±»å‹ï¼Œä¾‹å¦‚ï¼š type Q struct{} var q struct{} æ—¢ç„¶æ²¡æœ‰ä»»ä½•å­—æ®µï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªç»“æ„çš„å®ä¾‹çš„å¤§å°(å³æ‰€å å­˜å‚¨ç©ºé—´çš„å­—èŠ‚æ•°)æ˜¯ç”±å…¶å­—æ®µçš„å®½åº¦ï¼ˆsizeï¼‰å’Œå¯¹é½ï¼ˆalignmentï¼‰å…±åŒå†³å®šçš„ï¼Œè¿™æ ·æœ‰åŠ©äºå¯»å€é€Ÿåº¦ï¼ŒC è¯­è¨€ç­‰éƒ½æœ‰ç±»ä¼¼çš„ç­–ç•¥ï¼Œå…³äº Golang çš„å…·ä½“ç­–ç•¥è¯·é˜…è¯» Size and alignment guaranteesã€‚ å¾ˆæ˜¾ç„¶ï¼Œç©ºç»“æ„çš„å ç”¨ç©ºé—´å¤§å°ä¸ºé›¶å­—èŠ‚: var q struct {} fmt.Println(unsafe.Sizeof(q)) // 0 ç”±äºç©ºç»“æ„å ç”¨é›¶å­—èŠ‚ï¼Œå› æ­¤ä¸éœ€è¦å¡«å……å¯¹é½ï¼Œæ‰€ä»¥ç”±åµŒå¥—ç©ºç»“æ„çš„ç©ºç»“æ„ä¹Ÿä¸ä¼šå ç”¨å­˜å‚¨ç©ºé—´ã€‚ type Q struct { A struct{} B struct{ C struct{} } } var q Q fmt.Println(unsafe.Sizeof(q)) // 0 ç”±äºç©ºç»“æ„ä¸å ç”¨å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å£°æ˜ä»¥ç©ºç»“æ„ä½œä¸ºå…ƒç´ çš„æ•°ç»„æˆ–åˆ‡ç‰‡ï¼Œä¹Ÿæ˜¯ä¸å ç”¨ç©ºé—´çš„ï¼ˆOrthogonality in Goï¼‰ï¼š var x [1000000000]struct{} fmt.Println(unsafe.Sizeof(x)) // 0 var y = make([]struct{}ï¼Œ1000000000) fmt.Println(unsafe.Sizeof(x))// 24ï¼ŒèƒŒåå…³è”æ•°ç»„ä¸º 0 å¯¹äºç©ºç»“æ„ï¼ˆæˆ–è€…ç©ºæ•°ç»„ï¼‰ï¼Œå…¶å ç”¨çš„å­˜å‚¨å¤§å°ä¸ºé›¶ï¼Œæ‰€ä»¥ä¸¤ä¸ªä¸åŒçš„é›¶å¤§å°çš„å˜é‡åœ¨å†…å­˜ä¸­å¯èƒ½å…·æœ‰ç›¸åŒçš„åœ°å€ã€‚ æ¥çœ‹ä¸‹é¢å‡ ä¸ªç¤ºä¾‹ï¼š var a, b struct{} fmt.Println(&amp;amp;a == &amp;amp;b) // true c := make([]struct{}, 10) d := make([]struct{}, 20) fmt.Println(&amp;amp;c[0] == &amp;amp;d[1]) // true type Q struct{} func (q *Q)addr() { fmt.Printf(&amp;#34;%p\n&amp;#34;, q) } func main() { var a, b Q a.addr() // 0x5af5a60 b.addr() // 0x5af5a60 } e := struct{}{} // ä¸æ˜¯é›¶å€¼ï¼Œä¸€ä¸ªçœŸæ­£çš„å®ä¾‹ f := struct{}{} fmt.Println(e == f) // true è¯·æ³¨æ„ï¼Œè¿™ç§ç›¸ç­‰åªæ˜¯å¯èƒ½ï¼Œå¹¶ä¸æ˜¯ä¸€å®šçš„ã€‚ æ¯”å¦‚è¿™ä¸ªç¤ºä¾‹ï¼Œç›¸å…³é—®é¢˜è§£é‡Šè¯·çœ‹è¿™ä¸ª issueã€‚ è¯´äº†åŠå¤©ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œè²Œä¼¼è¿™äº›ä¹Ÿæ²¡ä»€ä¹ˆå®é™…çš„ç”¨é€”å•Šï¼Œä¸‹é¢åˆ—ä¸¾ä¸¤ä¸ªæ¯”è¾ƒå®ç”¨çš„å®è·µç”¨é€”ï¼š 1. ä½¿ç”¨ chan struct{} ä»£æ›¿ chan bool åœ¨ goroutines ä¹‹é—´ä¼ é€’ä¿¡å·ã€‚ä½¿ç”¨ bool å®¹æ˜“è®©äººä¸ç†è§£è¯¥å€¼ï¼Œtrue or falseï¼Œä½†æ˜¯ä½¿ç”¨ chan struct{} å°±å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬ä¸åœ¨ä¹å€¼ï¼Œåªå…³å¿ƒå‘ç”Ÿçš„äº‹å„¿ï¼Œæ›´å®¹æ˜“è¡¨è¾¾æ¸…æ¥šä¸€äº›ã€‚ 2. ä¸ºäº†é˜²æ­¢ unkeyed åˆå§‹åŒ–ç»“æ„ï¼Œå¯ä»¥æ·»åŠ  _ struct {} å­—æ®µï¼š type Q struct { X, Y int _ struct{} è¿™æ ·ä¸€æ¥ï¼Œä½¿ç”¨ Q{X: 1, Y: 1} å¯ä»¥ï¼Œä½†ä½¿ç”¨ Q{1, 1} å°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼štoo few values in struct initializerï¼ŒåŒæ—¶è¿™æ ·ä¹Ÿå¸®åŠ©äº† go ver ä»£ç æ£€æŸ¥ã€‚ å‚è€ƒ The Go Programming Language Specification Golang Frequently Asked Questions Why Golang Nil Is Not Always Nil? Nil Explained</description>
    </item>
    
    <item>
      <title>æ­¦å™¨ä¿®ç‚¼ä¹‹ Neo/vim ä¸ Tmux</title>
      <link>https://at7h.com/posts/my-dotfiles/</link>
      <pubDate>Sun, 26 Jul 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/my-dotfiles/</guid>
      <description>å¤äººäº‘ï¼šå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ ä¸€ç›´ä»¥æ¥ï¼Œæˆ‘éƒ½è§‰å¾—åº”è¯¥å¥½å¥½ä¿®ç‚¼ä¸€ä¸ªè‡ªå·±è¶æ‰‹çš„ã€æ­¦å™¨ã€ï¼Œè¿™ç¯‡æ–‡ç« è·Ÿå¤§å®¶è°ˆä¸€è°ˆæˆ‘çš„ä¸€ç‚¹ç‚¹ä¿®ç‚¼æ„Ÿå—ã€‚ ä½ å¯ä»¥é€‰æ‹©ä¿®ç‚¼ vimã€emacs ç­‰ç¼–è¾‘å™¨ï¼Œå¦‚æœä½ ä¸å–œæ¬¢æŠ˜è…¾ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ IDEã€‚è¿™ä¸ªè¯é¢˜è²Œä¼¼æ¯”è¾ƒæ•æ„Ÿï¼Œå¾ˆå¤šäººéƒ½åœ¨è®¨è®ºï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰å®Œå…¨æ˜¯ä¸ªäººå®¡ç¾æˆ–æ˜¯çˆ±å¥½è€Œå·²ï¼Œè¯´åˆ°åº•ã€æ­¦å™¨ã€åªæ˜¯è¾…åŠ©å·¥å…·ï¼Œåªè¦ç”¨çš„é¡ºæ‰‹ï¼Œèƒ½å¾ˆå¥½å¤Ÿæ»¡è¶³è‡ªå·±çš„åŠŸèƒ½ã€å®¡ç¾ç­‰éœ€æ±‚å³å¯ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯è‡ªå·±æœ¬èº«çš„ã€æ­¦åŠŸã€ï¼Œå¦‚æœä½ ã€æ­¦åŠŸã€è¶³å¤Ÿé«˜ï¼Œä¸éœ€è¦å€ŸåŠ©å·¥å…·å¸®åŠ©æé«˜æ•ˆç‡ï¼Œä¸è¦è¡¥å…¨ä¸è¦ lint è¿™é‚£çš„ï¼Œç”¨ã€è®°äº‹æœ¬ã€ä¹Ÿä¸è€½è¯¯ä½ å†™å‡ºç‰›é€¼çš„ä»£ç ã€‚ æˆ‘çš„é€‰æ‹©æ˜¯åšä¸ª vimerã€‚ä¿®ç‚¼è·¯ä¸”é•¿ï¼Œä¸‹é¢æ¥è°ˆä¸€ä¸‹æˆ‘è‡ªå·±çš„ä¸€ç‚¹å…¥å‘æ„Ÿå—å’Œå»ºè®®ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©é‚£äº›è¿˜åœ¨è¿·èŒ«çš„æƒ³è¦å…¥é—¨çš„ç«¥é‹ã€‚è€é¸Ÿå°±è·³è¿‡å§ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å…³æ³¨ä¸‹æˆ‘çš„é…ç½®ï¼Œææå»ºè®®ã€æ„è§ï¼Œäº¤æµäº¤æµï¼Œå…±åŒè¿›æ­¥ã€‚ å…¥å‘å»ºè®® ä½œä¸ºä¸€ä¸ªçˆ±ã€æŠ˜è…¾ã€çš„äººï¼Œå­¦ç”Ÿæ—¶ä»£ä¹Ÿç”¨è¿‡ä¸€äº›ä¸»æµçš„ IDEï¼Œæœ€åå¼ƒç”¨çš„åŸå› å°±æ˜¯è§‰å¾—å¤ªé‡äº†ï¼Œå¤ªå¤šçš„åŠŸèƒ½ç”¨ä¸ä¸Šï¼Œæ›´ä¸æƒ³é‚£ä¹ˆå¤šè¿™é‚£çš„çª—å£æŒ¡ä½æˆ‘çš„ä»£ç  ğŸ˜‚ã€‚åœ¨ç”¨äº†ä¸€æ®µæ—¶é—´ sublime ä¹‹åï¼Œæœ€ç»ˆå†³å®šå¼€å§‹å…¥å‘ vimï¼Œåæ¥å› ä¸ºå¼‚æ­¥ã€floating window ç­‰åˆ‡åˆ°äº† neovimï¼Œå½“ç„¶è¿™äº›ç°åœ¨ vim ä¹Ÿéƒ½æ”¯æŒäº†ï¼Œå†åæ¥æ¥è§¦åˆ° tmuxï¼Œå°±åœ†æ»¡äº† ğŸ˜ã€‚ Tmux æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ç»ˆç«¯å¤ç”¨è½¯ä»¶ï¼Œç”±äºå¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘çš„å¼€å‘éƒ½æ˜¯ç™»å½•è¿œç¨‹ä¸»æœºä¸Šè¿›è¡Œçš„ï¼Œè¿™æ—¶å€™ tmux ç¥å™¨ç®€ç›´å°±è®©ä½ çˆ½åˆ°èµ·é£ã€‚æœ¬åœ°å¼€å‘çš„è¯ï¼Œå¤šä¸ªé¡¹ç›®ç»ˆç«¯ä¹‹é—´åˆ‡æ¢ï¼Œä¹Ÿæ˜¯éå¸¸æœ‰ç”¨ã€‚è·Ÿ vim ç±»ä¼¼ï¼Œåˆšå¼€å§‹ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„ä¸Šæ‰‹ä½¿ç”¨å’Œé…ç½®éš¾åº¦ï¼Œä¸­é—´æ”¾å¼ƒäº†ä¸€æ¬¡ï¼Œä½†æ˜¯å…¥å‘ä¹‹åï¼Œå°±å°±å°±å°±ï¼Œçˆ½çš„é£èµ·~ ä½œä¸ºä¸€ä¸ªæµè¡Œäº†ä¸‰åå¤šå¹´çš„éå¸¸ä¼˜ç§€çš„ç¼–è¾‘å™¨ï¼Œæˆ‘æ˜¯éå¸¸å–œæ¬¢å®ƒçš„è®¾è®¡å“²å­¦çš„ï¼Œè¯´çš„ç›´ç™½ä¸€ç‚¹å°±æ˜¯å®ƒçš„å·¥ä½œæ¨¡å¼å§ã€‚è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹é¢å°±æ˜¯ï¼Œæ¯ä¸€æ¬¡ä½ åœ¨æŠ˜è…¾é…ç½®æŠ˜è…¾æ’ä»¶çš„æ—¶å€™ï¼Œå®ƒæ€»æ˜¯æ—¶ä¸æ—¶çš„èƒ½ç»™ä½ å¸¦æ¥æƒŠå–œï¼Œä¹Ÿè®¸å¾ˆå°çš„ä¸€ç‚¹æ”¹åŠ¨å´å¯ä»¥å¤§å¹…æé«˜ä½ ä½¿ç”¨çš„ã€å¹¸ç¦åº¦ã€ã€‚ å¾ˆå¤šäººè§‰å¾—å®ƒçš„ä¸Šæ‰‹éš¾åº¦æ¯”è¾ƒå¤§ï¼Œå­¦ä¹ æ›²çº¿æœ‰äº›é™¡å³­ï¼Œçœ‹åˆ«äººç”¨çš„å¾ˆæºœï¼Œè‡ªå·±ä¸Šæ‰‹å°±ä¸çŸ¥æ‰€æªï¼Œé‚£ä¹ˆå¤šå¿«æ·é”®ã€å‘½ä»¤æ€ä¹ˆè®°å¾—ä½ï¼Œé…ç½®å¥½éš¾æå“¦ç­‰ç­‰ï¼Œæ…¢æ…¢å°±å¼ƒå‘äº†ã€‚ ä¸ªäººè§‰å¾—æ˜¯è¿™æ ·ï¼Œåˆšå¼€å§‹çš„æ—¶å€™ä½ å¾—æƒ³æ¸…æ¥šä½ å­¦å®ƒçš„ç›®çš„ï¼Œæ˜¯çœŸæ­£çš„å–œæ¬¢æƒ³ä¿®ç‚¼è‡ªå·±çš„ã€æ­¦å™¨ã€ï¼Ÿè¿˜æ˜¯å°±æ˜¯çœ‹äººå®¶ç”¨å¥½æºœï¼Œä¹Ÿæƒ³å­¦ä¸Šä¸€æ‰‹è£…ä¸ª B å‘¢ï¼Ÿä¸€ç›´åœ¨è¯´ï¼Œå·¥å…·åªæ˜¯å·¥å…·ï¼Œè¾…åŠ©ä½ é«˜æ•ˆç‡çš„å†™ä»£ç è€Œå·²ï¼Œå¦‚æœä½ è‡ªèº«ã€æ­¦åŠŸã€è¶³å¤Ÿé«˜ï¼Œç”¨ã€è®°äº‹æœ¬ã€ä¹Ÿä¸è€½è¯¯ä½ å†™å‡ºç‰›é€¼çš„ä»£ç ï¼Œè¦æ¯›è¡¥å…¨è¦æ¯› Lintã€‚å°±æ˜¯è¯´ï¼Œé¦–å…ˆä½ å¾—ææ¸…æ¥šäº†æ˜¯ä¸ºäº†ä»€ä¹ˆï¼ŒIDE å¥½å¥½çš„ä¸ºå•¥éè¦è¾›è‹¦æŠ˜è…¾è¿™æ ·é‚£æ ·é…ç½®å‘¢ï¼Œå¾—æ˜ç™½ä½ æ˜¯ä¸ºäº†æ»¡è¶³ä»€ä¹ˆéœ€æ±‚è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚ Sorryï¼Œè²Œä¼¼è·‘é¢˜äº†ã€‚å›åˆ°æ­£é¢˜ï¼Œåˆšå¼€å§‹æ²¡åŠæ³•ï¼Œå°±æ˜¯ç¡¬ç€å¤´çš®ä¸Šï¼Œä¸Šæ‰‹ç”¨ï¼Œåˆšå¼€å§‹ä½ å¯èƒ½ï¼Œå“¦ä¸å¯¹ï¼Œæ˜¯è‚¯å®šæ˜¯è§‰å¾—çœŸéš¾ç”¨ï¼Œæ˜¯çš„ï¼Œæ²¡æœ‰ä»»ä½•é…ç½®çš„æƒ…å†µä¸‹ç¡®å®ä¸æ€ä¹ˆå¥½ç”¨ï¼Œæ‰€ä»¥ä½ å°±è¦æƒ³åŠæ³•è®©å®ƒã€å¥½ç”¨èµ·æ¥ã€ã€‚å¯¹äºé…ç½®ï¼Œæˆ‘æ˜¯å»ºè®®è‡ªå·±æ…¢æ…¢æ¥ã€æ”’ã€ä½ çš„è‡ªå·±é…ç½®ï¼Œä¸€è¡Œä¸€è¡Œè‡ªå·±æ¥æï¼Œè¿™ä¸ªé…ç½®æ˜¯å¹²å˜›çš„è¿™ä¸ªæ’ä»¶æ˜¯å¹²å˜›çš„ï¼Œææ¸…æ¥šï¼Œä¸€ç‚¹ä¸€ç‚¹æ¥ï¼Œç§¯ç´¯å½¢æˆä¸€å¥—é€‚åˆè‡ªå·±çš„é£æ ¼ã€‚å¯ä»¥å¹¶ä¸”é¼“åŠ±å»å‚è€ƒä¸€äº›åˆ«äººçš„ä¼˜ç§€çš„é…ç½®ã€è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¦å¼„æ‡‚ï¼Œä¸è¦ä¸€æŠŠæ¢­ç…§æ¬è¿‡æ¥ã€‚ å½“ç„¶ç°åœ¨æœ‰å¾ˆå¤šå¾ˆæˆç†Ÿçš„äº§å“çº§çš„è§£å†³æ–¹æ¡ˆæ¯”å¦‚ spaceVimï¼Œä½ å¯ä»¥ç›´æ¥æ‹¿æ¥æ ¹æ®æ•™ç¨‹å¿«é€Ÿçš„ä¸Šæ‰‹ç”¨èµ·æ¥ï¼Œä½†åˆšå¼€å§‹å®ƒå¯¹ä½ å°±åƒæ˜¯ä¸ªé»‘ç›’å­ï¼Œå“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œæˆ–è€…ä½ æƒ³ä¿®æ”¹ç‚¹ä¸œè¥¿éƒ½å¯èƒ½æ— ä»ä¸‹æ‰‹ã€‚ Vim é‡Œé¢çš„ä¸œè¥¿è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä¸ªäººè§‰å¾—ä½ æ˜¯æ—¥å¸¸ä½¿ç”¨çš„è¯ï¼Œè‚¯å®šæ˜¯æ¯”è¾ƒæ³¨é‡å®é™…çš„ä½¿ç”¨ï¼Œæ²¡å¿…è¦ä¸€å¼€å§‹å°±åƒå­¦ä¹ ä¸€é—¨è¯¾ç¨‹ä¸€æ ·ç³»ç»Ÿçš„å­¦ï¼Œä»Šå¤©å­¦å®Œæ˜å¤©ä¹Ÿè®¸å°±å¿˜äº†ï¼Œæ›´æ²¡å¿…è¦å»è®°é‚£äº›è¿™æ ·é‚£æ ·çš„å‘½ä»¤ã€å¿«æ·é”®ã€‚å°±ç›´æ¥ä¸Šæ‰‹å¹²å°±å®Œäº†ï¼ˆå½“ç„¶ä¹Ÿä¸æ˜¯è¯´ä¸€ç‚¹ä¹Ÿä¸çœ‹æ•™ç¨‹ï¼Œæœ€å¼€å§‹è‚¯å®šè¿˜æ˜¯è¦å…ˆçœ‹ä¸€äº›ç®€å•çš„å…¥é—¨å¸–å­ï¼Œå¿…å¤‡æŠ€èƒ½è¿˜æ˜¯è¦å­¦ä¸€ä¸‹å­çš„ï¼Œä¸ç„¶åˆšå¼€å§‹å°±æ²¡æ³•ç©å„¿ï¼‰ï¼Œé‡åˆ°ä¸ä¼šæçš„å°±æŸ¥ï¼ŒæŸ¥æ–‡æ¡£ï¼Œé—®æœç´¢å¼•æ“ï¼Œç”¨çš„å¤šäº†è‡ªç„¶å°±ä¼šäº†ï¼ŒæŒ‰çš„å¤šäº†è‡ªç„¶å°±è®°ä½äº†ï¼Œé•¿æœŸçš„è‚Œè‚‰è®°å¿†æ ¹æœ¬å°±ä¸éœ€è¦è¿‡è„‘å­æƒ³è¿™ä¸ªæ€ä¹ˆæŒ‰ï¼Œæ—¶é—´é•¿äº†ï¼Œä½ é‡åˆ°çš„é—®é¢˜ã€éœ€æ±‚å¤šäº†ï¼Œè‡ªç„¶å°±å…¥é—¨äº†ã€‚å¯¹æ’ä»¶ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸è¦ä¸€å¼€å§‹å°±å»å®Œå…¨ç…§æ¬åˆ«äººçš„é…ç½®ï¼Œä¸€å¤§å †æ’ä»¶ä¸€æŠŠæ¢­éƒ½è£…ä¸Šï¼Œä¹Ÿä¸çŸ¥é“ä¸€ä¸ªä¸ªæ˜¯å¹²å˜›çš„ï¼Œæœ€å¥½è¿˜æ˜¯æ ¹æ®è‡ªå·±çš„éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ¥ï¼Œå¥½å¥½çœ‹ä¸‹æ¯ä¸ªæ’ä»¶ä»“åº“çš„æ–‡æ¡£ï¼Œçœ‹ä¸‹æ€ä¹ˆä½¿ç”¨ã€‚ Tmux ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¯ä»¥é¢å…ˆçœ‹ä¸‹åŸºç¡€çš„ä¸€äº›å¸–å­æˆ–è€…å®˜æ–¹æ–‡æ¡£ï¼Œç„¶åä¸»è¦æ˜¯ä¸Šæ‰‹ç”¨ï¼Œå°±å¹²å°±å®Œäº†ã€‚é…ç½®ä¹Ÿä¸€æ ·ï¼Œä¹Ÿæ˜¯å»ºè®®è‡ªå·±æï¼Œä¸è¦ä¸€å¼€å§‹å…¨éƒ¨ç…§æ¬ï¼Œæ¯ä¸ªäººä¹ æƒ¯ä¸ä¸€æ ·ï¼Œåˆ«äººå–œæ¬¢çš„æœªå¿…å°±æ˜¯ä½ å–œæ¬¢çš„ï¼Œã€æ‹¿æ¥ã€å¯ä»¥ï¼Œä½†æ˜¯å‰ææ˜¯ä½ è¦èƒ½å¸æ”¶ç†è§£ï¼Œèƒ½é©¾é©­ã€‚ 1. Neo/vim ä¸‹æŸ¥çœ‹æ–‡æ¡£å¯ä»¥è¾“å…¥ : è¿›å…¥ COMMAND æ¨¡å¼ helpï¼Œè¿™é‡Œçš„æ–‡æ¡£ä¹Ÿå°±æ˜¯å®ƒçš„å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œæ˜¯ç¿»è¯‘ä¸­æ–‡æ–‡æ¡£ã€‚ 2. Tmux å¯ä»¥çœ‹å®˜æ–¹ä»“åº“çš„ Getting-Startedï¼Œåƒæˆ‘è¿™ç§è‹±æ–‡ä¸æ€ä¹ˆèƒ½çœ‹æ˜ç™½çš„è¿˜æ˜¯è¦å†å»æœä¸€äº›ç›¸å…³çš„ä»‹ç»æ–‡ç« çœ‹çœ‹ã€‚ ä¸è¦æ”¾å¼ƒï¼Œç¡¬ç€å¤´å‘å¹²ï¼Œç­‰çœŸæ­£ç”¨èµ·æ¥ä¹‹åï¼Œç›¸ä¿¡æˆ‘ï¼Œä½ è‚¯å®šä¼šçˆ±ä¸Šå®ƒä»¬çš„ ğŸ˜ ğŸ˜ ~ æˆ‘çš„åˆ†äº« æœ€åï¼Œåˆ†äº«ä¸‹æˆ‘çš„é…ç½®ï¼š https://github.com/at7h/dots å¯¹ä½ æœ‰ç”¨çš„è¯ï¼Œè¯·å¸®å¿™ç‚¹ä¸ª Starï¼Œæ„Ÿè°¢ ğŸ˜Š å½“ç„¶ï¼Œä¹Ÿååˆ†æ¬¢è¿å¤§å®¶æ¥äº¤æµè‡ªå·±çš„æƒ³æ³•ã€å¿ƒå¾—ã€é…ç½® â€¦â€¦ å¤§å®¶æœ‰é—®é¢˜æ¬¢è¿è¯„è®ºç•™è¨€ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</description>
    </item>
    
    <item>
      <title>ç†è§£ Python ç±»å±æ€§ __slots__</title>
      <link>https://at7h.com/posts/py-slots/</link>
      <pubDate>Sun, 19 Jul 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/py-slots/</guid>
      <description>ç½‘ç»œä¸Šæœ‰ä¸€ç¯‡æ¯”è¾ƒæœ‰åçš„æ–‡ç« å« Saving 9 GB of RAM with Pythonâ€™s __slots__ï¼Œæ–‡ç« ç¤ºä¾‹ä¸­ä»…å¯¹ Image ç±»æ·»åŠ äº†ä¸€ä¸ª __slots__å±æ€§å°±ä¸ºæœåŠ¡å™¨èŠ‚çœäº† 9G çš„å†…å­˜å ç”¨ã€‚å¦‚æœæœ‰åŒå­¦çœ‹è¿‡ä¸€äº›å¼€æºçš„ Python ORMï¼Œå¦‚ SQLAlchemy, peewee ç­‰ï¼Œæˆ–æ˜¯çœ‹è¿‡ä¸€äº›è¿›è¡Œ IO å¤„ç†çš„åŒ…ï¼Œä½ å°±ä¼šåœ¨å…¶ä¸­å‘ç°å¾ˆå¤š __slots__ çš„èº«å½±ã€‚ é‚£ä¹ˆï¼Œè¿™ä¸ª __slots__ åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ ä¸‹é¢çš„è§£é‡Šæ•´ç†è‡ª Python å®˜æ–¹æ–‡æ¡£ï¼š object.__slots__ æ˜¯ä¸€ä¸ªç±»å˜é‡ï¼Œå¯èµ‹å€¼ä¸ºå­—ç¬¦ä¸²ã€å¯è¿­ä»£å¯¹è±¡æˆ–ç”±å®ä¾‹ä½¿ç”¨çš„å˜é‡åæ„æˆçš„å­—ç¬¦ä¸²åºåˆ—ã€‚å…¶å…è®¸æˆ‘ä»¬æ˜¾å¼åœ°å£°æ˜æ•°æ®æˆå‘˜ï¼ˆå¦‚ç‰¹å¾å±æ€§ï¼‰ï¼Œä¸ºå·²å£°æ˜çš„å˜é‡ä¿ç•™ç©ºé—´ï¼Œå¹¶ç¦æ­¢ä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»º __dict__ å’Œ __weakref__ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š class X: def __init__(self, a, b): self.a = a self.b = b class Y: __slots__ = (&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;) def __init__(self, a, b): &amp;#34;&amp;#34;&amp;#34; æ­¤æ—¶å¦‚æœä½ å£°æ˜ä¸€ä¸ª __slots__ ä¸­æ²¡æœ‰çš„å±æ€§ï¼Œå¦‚ self.c = 1 pylint ç­‰å°±ä¼šæç¤ºé”™è¯¯ï¼š [pylint] [Error] Assigning to attribute &amp;#39;c&amp;#39; not defined in class slots å½“ç„¶å¦‚æœä½ æ‰§æ„è¦å†™çš„è¯ï¼Œåˆå§‹åŒ–å®ä¾‹çš„æ—¶å€™ä¼šå¼•å‘ AttributeErrorï¼š AttributeError: &amp;#39;Y&amp;#39; object has no attribute &amp;#39;c&amp;#39; &amp;#34;&amp;#34;&amp;#34; self.a = a self.b = b &amp;gt;&amp;gt;&amp;gt; import weakref &amp;gt;&amp;gt;&amp;gt; x = X(7, 8) &amp;gt;&amp;gt;&amp;gt; x.a 7 &amp;gt;&amp;gt;&amp;gt; x.c = 9 &amp;gt;&amp;gt;&amp;gt; x.__dict__ {&amp;#39;a&amp;#39;: 7, &amp;#39;b&amp;#39;: 8, &amp;#39;c&amp;#39;: 9} &amp;gt;&amp;gt;&amp;gt; rx = weakref.ref(x) &amp;gt;&amp;gt;&amp;gt; rx &amp;lt;weakref at 0x107a9e278; to &amp;#39;X&amp;#39; at 0x107618f98&amp;gt; &amp;gt;&amp;gt;&amp;gt; y = Y(7, 8) &amp;gt;&amp;gt;&amp;gt; y.a 7 &amp;gt;&amp;gt;&amp;gt; y.c = 9 AttributeError: &amp;#39;Y&amp;#39; object has no attribute &amp;#39;c&amp;#39; &amp;gt;&amp;gt;&amp;gt; y.__dict__ AttributeError: &amp;#39;Y&amp;#39; object has no attribute &amp;#39;__dict__&amp;#39; &amp;gt;&amp;gt;&amp;gt; ry = weakref.ref(y) TypeError: cannot create weak reference to &amp;#39;Y&amp;#39; object é‚£ä½¿ç”¨ __slots__ åˆ°åº•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼ŸğŸ¤” ç­”æ¡ˆæ˜¯ä¸ __dict__ ç›¸æ¯”ï¼Œä½¿ç”¨ __slots__ çš„æ–¹å¼å¯ä»¥æ˜¾è‘—åœ°èŠ‚çœå†…å­˜ç©ºé—´ï¼Œæå‡å±æ€§çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚ ä¹‹æ‰€ä»¥ä¼šåœ¨ ORM ç­‰é¡¹ç›®é‡Œé¢‘ç¹ä½¿ç”¨ï¼Œæ­£æ˜¯å› ä¸ºè¿™äº›é¡¹ç›®ä¸­å­˜åœ¨ç‰¹åˆ«å¤šå¤§é‡åˆ›å»ºå®ä¾‹çš„æ“ä½œï¼Œä½¿ç”¨ __slots__ ä¼šæ˜æ˜¾å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œæå‡é€Ÿåº¦ã€‚å¹¶ä¸”éšç€å®ä¾‹æ•°ç›®çš„å¢åŠ ï¼Œå…¶æ•ˆæœä¼šæ›´åŠ æ˜¾è‘—ã€‚ å‡ ç‚¹ç–‘é—® è‡³æ­¤ï¼Œä½ å¯èƒ½ä¼šæœ‰å‡ ç‚¹ç–‘é—®ï¼š ä¸ºä»€ä¹ˆ __slots__ å¯ä»¥èŠ‚çœå†…å­˜ï¼Œæé«˜é€Ÿåº¦çš„ï¼Ÿ å’‹é€šè¿‡ __slots__ æ¥å®ç°å±æ€§çš„å­˜å‚¨ä¸è®¿é—®çš„ï¼Ÿ ä½¿ç”¨äº† __slots__ çš„ç±»æ€ä¹ˆå®ç°åŠ¨æ€èµ‹å€¼ï¼Œå¦‚æœéœ€è¦å®ä¾‹å¼±å¼•ç”¨æ”¯æŒæ€ä¹ˆæï¼Ÿ ä½¿ç”¨äº† __slots__ çš„ç±»ç»§æ‰¿ä¸è¢«ç»§æ‰¿æ—¶çš„è¡¨ç°ï¼Ÿ é’ˆå¯¹è¿™å‡ ä¸ªé—®é¢˜ä½œç­”ï¼š 1. é€šå¸¸æƒ…å†µä¸‹ï¼Œç±»å®ä¾‹ä½¿ç”¨ __dict__æ¥å­˜å‚¨å…¶å±æ€§æ•°æ®ï¼Œå¥½å¤„æ˜¯å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„è®¾ç½®å®ä¾‹å±æ€§ï¼Œç„¶è€Œ dict å“ˆå¸Œè¡¨æœ¬èº«çš„æ•°æ®ç»“æ„å†³å®šäº†å®ƒéœ€è¦æ›´å¤šçš„å†…å­˜ï¼Œå½“åˆ›å»ºçš„å®ä¾‹è¶Šå¤šï¼Œæˆ–è€…å®ä¾‹çš„å±æ€§è¶Šå¤šæ—¶ï¼Œå†…å­˜çš„è€—è´¹å°†æ›´åŠ ä¸¥é‡ã€‚__slots__ ä¿è¯äº†è§£é‡Šå™¨åœ¨ç¼–è¯‘æ—¶æœŸå°±çŸ¥é“è¿™ä¸ªç±»å…·æœ‰ä»€ä¹ˆå±æ€§ï¼Œä»¥åˆ†é…å›ºå®šçš„ç©ºé—´æ¥å­˜å‚¨å·²çŸ¥çš„å±æ€§ã€‚ 2. ä½¿ç”¨ __slots__ æ—¶ï¼Œä¼šå°†å±æ€§çš„å­˜å‚¨ä»å®ä¾‹çš„ __dict__ æ”¹ä¸ºç±»çš„ __dict__ ä¸­ï¼š &amp;gt;&amp;gt;&amp;gt; Y.__dict__ mappingproxy({&amp;#39;__module__&amp;#39;: &amp;#39;__main__&amp;#39;, &amp;#39;__slots__&amp;#39;: (&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;), &amp;#39;__init__&amp;#39;: &amp;lt;function __main__.Y.__init__(self, a, b)&amp;gt;, &amp;#39;a&amp;#39;: &amp;lt;member &amp;#39;a&amp;#39; of &amp;#39;Y&amp;#39; objects&amp;gt;, &amp;#39;b&amp;#39;: &amp;lt;member &amp;#39;b&amp;#39; of &amp;#39;Y&amp;#39; objects&amp;gt;, &amp;#39;__doc__&amp;#39;: None}) å±æ€§çš„è®¿é—®æ˜¯é€šè¿‡åœ¨ç±»å±‚çº§ä¸Šä¸ºæ¯ä¸ª slot å˜é‡åˆ›å»ºå’Œ å®ç°æè¿°å™¨(descriptor) å®ç°çš„ï¼Œè¯¥æè¿°å™¨çŸ¥é“å±æ€§å€¼åœ¨å®ä¾‹åˆ—è¡¨ä¸­çš„å”¯ä¸€ä½ç½®ã€‚å…³äºæè¿°å™¨ä¸å±æ€§çš„è®¿é—®åœ¨æˆ‘çš„ èµ°è¿› Python ç±»çš„å†…éƒ¨ ä¸€æ–‡ä¸­å‡æœ‰è¯¦ç»†çš„è§£é‡Šï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯å‰å»é˜…è¯»ã€‚å¦å¤–ï¼Œè¿™ç¯‡ how __slots__ are implemented ä¹Ÿè®¸å¯ä»¥å¸®åŠ©ä½ çš„ç†è§£ï¼Œå°½ç®¡æˆ‘çœ‹å®ƒå†™äºå¾ˆå¤šå¹´å‰ï¼Œä½†è‡³ä»Šä¾ç„¶æœ‰å€Ÿé‰´æ„ä¹‰ã€‚ 3.. æ€ä¹ˆå®ç°åŠ¨æ€èµ‹å€¼å’Œå¼±å¼•ç”¨æ”¯æŒï¼Ÿç­”æ¡ˆæ˜¯ï¼šåœ¨ __slots__ ä¸­åŠ ä¸Š __dict__ å’Œ __weakref__ã€‚ class Y: __slots__ = (&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;, &amp;#39;__dict__&amp;#39;, &amp;#39;__weakref__&amp;#39;) def __init__(self, a, b): self.a = a self.b = b &amp;gt;&amp;gt;&amp;gt; import weakref &amp;gt;&amp;gt;&amp;gt; y = Y(7, 8) &amp;gt;&amp;gt;&amp;gt; y.a 7 &amp;gt;&amp;gt;&amp;gt; y.b 8 &amp;gt;&amp;gt;&amp;gt; y.c = 9 &amp;gt;&amp;gt;&amp;gt; y.__dict__ {&amp;#39;c&amp;#39;: 9} &amp;gt;&amp;gt;&amp;gt; ry = weakref.ref(y) &amp;gt;&amp;gt;&amp;gt; ry &amp;lt;weakref at 0x107d17d68; to &amp;#39;Y&amp;#39; at 0x107a4d480&amp;gt; 4. å½“ç±»ç»§æ‰¿è‡ªä¸€ä¸ªæœªå®šä¹‰ __slots__ çš„ç±»æ—¶ï¼Œå®ä¾‹çš„ __dict__ å’Œ __weakref__ å±æ€§å°†æ€»æ˜¯å¯è®¿é—®çš„ã€‚ class X: def __init__(self): self.a = 7 class Y(X): __slots__ = (&amp;#39;b&amp;#39;, &amp;#39;c&amp;#39;) def __init__(self): super().__init__() self.b = 8 self.c = 9 &amp;gt;&amp;gt;&amp;gt; y = Y() &amp;gt;&amp;gt;&amp;gt; y.a 7 &amp;gt;&amp;gt;&amp;gt; y.b 8 &amp;gt;&amp;gt;&amp;gt; y.__dict__ {&amp;#39;a&amp;#39;: 7} 5. åœ¨çˆ¶ç±»ä¸­å£°æ˜çš„ __slots__ åœ¨å…¶å­ç±»ä¸­åŒæ ·å¯ç”¨ã€‚ä¸è¿‡ï¼Œå­ç±»å°†ä¼šè·å¾— __dict__ å’Œ __weakref__ï¼Œé™¤éå®ƒä»¬ä¹Ÿå®šä¹‰äº† __slots__ ã€‚ class X: __slots__=(&amp;#39;a&amp;#39;, &amp;#39;b&amp;#39;) def __init__(self): self.a = 7 self.b = 8 class Y(X): &amp;#34;&amp;#34;&amp;#34;æ²¡æœ‰å®šä¹‰ __slots__&amp;#34;&amp;#34;&amp;#34; class Z(X): __slots__ = () &amp;gt;&amp;gt;&amp;gt; y = Y() &amp;gt;&amp;gt;&amp;gt; y.a 7 &amp;gt;&amp;gt;&amp;gt; y.b 8 &amp;gt;&amp;gt;&amp;gt; y.c = 9 &amp;gt;&amp;gt;&amp;gt; y.__dict__ {&amp;#39;c&amp;#39;: 9} &amp;gt;&amp;gt;&amp;gt; z = Z() &amp;gt;&amp;gt;&amp;gt; z.a 7 &amp;gt;&amp;gt;&amp;gt; z.b 8 &amp;gt;&amp;gt;&amp;gt; z.c = 9 AttributeError: &amp;#39;Z&amp;#39; object has no attribute &amp;#39;c&amp;#39; æ‰€ä»¥ï¼Œç”± 4ï¼Œ5 å¯çŸ¥å¦‚æœéœ€è¦ä½¿ç”¨ __slots__, é‚£ä¹ˆä»åŸºç±»åˆ°æ¯ä¸ªç»§æ‰¿çš„å­ç±»éƒ½è¦å®šä¹‰ __slots__ã€‚ æ³¨æ„äº‹é¡¹ éç©ºçš„ __slots__ ä¸é€‚ç”¨äºæ´¾ç”Ÿè‡ªã€Œå¯å˜é•¿åº¦ã€å†…ç½®ç±»å‹ï¼ˆå¦‚ intã€str å’Œ tuple çš„æ´¾ç”Ÿç±»ï¼‰ã€‚ __class__ èµ‹å€¼ä»…åœ¨ä¸¤ä¸ªç±»å…·æœ‰ç›¸åŒçš„ __slots__ æ—¶æ‰ä¼šèµ·ä½œç”¨ã€‚ ç»“è®º å°½ç®¡ __slots__ å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œæé«˜å±æ€§çš„è®¿é—®é€Ÿåº¦ï¼Œä½†ä¹Ÿå­˜åœ¨å±€é™æ€§å’Œå‰¯ä½œç”¨ï¼Œå¹¶ä¸æ˜¯ç”¨äº†å°±æ˜¯å¥½çš„ï¼Œé‚£ä¹ˆåˆ°åº•è¾¾åˆ°å¤šå¤§çš„å®ä¾‹è§„æ¨¡çš„ç±»æ¨èä½¿ç”¨å‘¢ï¼Ÿè¿™ä¸ªæˆ‘ä¹Ÿæ²¡æœ‰å…·ä½“åšè¿‡å®éªŒï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæœç´¢ç›¸å…³è®ºæ–‡ã€‚åœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œè¡¡é‡æ–¹å¼ä¹Ÿä¼šä¸åŒï¼Œç»ä¸ä¼šæ˜¯è¯´ç”¨ __slots__ å°±æ˜¯å¥½çš„ï¼Œå¿…é¡»æ˜¯éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æ¥å†³å®šã€‚</description>
    </item>
    
    <item>
      <title>Python å¯è¿­ä»£å¯¹è±¡, è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨</title>
      <link>https://at7h.com/posts/iter/</link>
      <pubDate>Tue, 14 Jul 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/iter/</guid>
      <description>è¿™ç¯‡æ–‡ç« ä¸»è¦è®¨è®ºä¸‹ Python ä¸­çš„å®¹å™¨è¿­ä»£åè®®ï¼Œå®ƒçš„å®ç°ç»Ÿä¸€çº¦å®šäº†å®¹å™¨å¯¹è±¡çš„è¿­ä»£æ–¹æ¡ˆï¼Œå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰ç±»å¯¹è¿­ä»£çš„æ”¯æŒã€‚åœ¨ Python ä¸­æœ‰å¾ˆå¤šçš„åè®®ï¼Œæ¯”å¦‚è¿­ä»£å™¨åè®®ï¼Œæè¿°å™¨åè®®ç­‰ç­‰ï¼Œè¿™äº›åè®®æ¯”è¾ƒç±»ä¼¼äºå…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸­æ¥å£çš„æ¦‚å¿µã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»å†…å®¹ä¸ºå¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ã€‚ å¯è¿­ä»£å¯¹è±¡(iterable) ä»¥é€šä¿—ç®€å•çš„æ–¹å¼æ¥è®²ï¼Œå¯è¿­ä»£å¯¹è±¡å°±æ˜¯èƒ½å¤Ÿé€ä¸€è¿”å›å…¶æˆå‘˜é¡¹çš„å¯¹è±¡ï¼Œå…¶å¯ç”¨äº for å¾ªç¯ä»¥åŠè®¸å¤šå…¶ä»–éœ€è¦ä¸€ä¸ªåºåˆ—çš„åœ°æ–¹ zipã€map ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼š åºåˆ—(sequence)ç±»å‹ï¼š å¦‚ list, str, tuple, bytes ç­‰ éåºåˆ—ç±»å‹ç±»å‹å¦‚ï¼šdict, æ–‡ä»¶å¯¹è±¡ç­‰ ä¸¥æ ¼æ¥è¯´ï¼Œå¯è¿­ä»£å¯¹è±¡æ˜¯ä»»ä½•å®ç°äº† __iter__() æ–¹æ³•æˆ–è€…å®ç°äº†åºåˆ—(Sequence)è¯­ä¹‰ä¸­çš„ __getitem__() æ–¹æ³•çš„ä»»æ„è‡ªå®šä¹‰ç±»å¯¹è±¡ã€‚ é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥è®¨è®ºä¸‹è¿™ä¸¤ç§å®ç°æ–¹æ¡ˆã€‚ 1. å®ç° __iter__ è¿™ç§æ–¹å¼æ˜¯ä½ å¿…é¡»ä¸ºä½ çš„ç±»å®ç° __iter__()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚ 2. å®ç° __getitem__ åºåˆ—(Sequence)çš„è¿­ä»£é€šè¿‡å®ç° __getitem__() æ–¹æ³•æ¥ä½¿ç”¨æ•´æ•°ç´¢å¼•è¿›è¡Œé«˜æ•ˆçš„å…ƒç´ è®¿é—®ã€‚åŒæ—¶ï¼Œä½ å¿…é¡»ä¸ºå…¶å®šä¹‰ä¸€ä¸ªè¿”å›åºåˆ—é•¿åº¦çš„ __len__() æ–¹æ³•ã€‚ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ list, str, tuple, bytesã€‚åºåˆ—æ•°æ®ç»“æ„çš„å­˜å‚¨æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå…¶ç›´æ¥ä½¿ç”¨æ•´æ•°ç´¢å¼•è¿›è¡Œå¯»å€ï¼ŒæŸ¥æ‰¾å…ƒç´ éå¸¸é«˜æ•ˆï¼Œä½†æ˜¯æ’å…¥åˆ é™¤å…ƒç´ æ—¶æ•ˆç‡ä½ä¸‹ã€‚ æœ‰çš„ç«¥é‹ä¼šè¯´ï¼Œdict ä¹Ÿå®ç°äº† __getitem__ å’Œ __len__ åè®®ï¼Œä¸ºæ¯› dict ä¸å±äºåºåˆ—ï¼ŸåŸå› æ˜¯å®ƒå¹¶ä¸æ˜¯é€šè¿‡æ•´æ•°ç´¢å¼•æ¥é¡ºåºè¿­ä»£ï¼Œè€Œæ˜¯é€šè¿‡ä»»æ„çš„ä¸å¯å˜é”®(immutable key) æ¥è¿›è¡Œé€ä¸ªæŸ¥æ‰¾çš„ã€‚æ‰€ä»¥ dict çš„è¿­ä»£è¿˜æ˜¯å› ä¸ºå…¶å®ç°äº† __iter__ã€‚ å·¥ä½œæ–¹å¼ å½“æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ x ä½œä¸ºå‚æ•°ä¼ ç»™å†…ç½®å‡½æ•° iter() æ—¶ï¼Œå®ƒä¼šè¿”å›è¯¥å¯¹è±¡çš„è¿­ä»£å™¨ä»¥ä¾›è¿­ä»£ã€‚ä½†é€šå¸¸æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆæï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ for å¯¹å¯è¿­ä»£å¯¹è±¡è¿›è¡Œéå†æ—¶ï¼Œfor è¯­å¥ä¼šä¸ºä½ è‡ªåŠ¨å¤„ç†é‚£äº›æ“ä½œï¼Œå³è‡ªåŠ¨è°ƒç”¨ iter(x) æ¥è·å–è¿­ä»£å™¨ï¼Œè‹¥å¯¹è±¡æ²¡æœ‰å®ç°__iter__()æ–¹æ³•ï¼Œè€Œå®ç°äº†æ–¹å¼äºŒçš„ __getitem__ å’Œ __len__ åè®®ï¼Œå…¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¹¶å°è¯•ä»ç´¢å¼• 0 å¼€å§‹è·å–å…ƒç´ ï¼Œè‹¥å°è¯•å¤±è´¥ï¼Œä¼šå¼•å‘ä¸€ä¸ª TypeErrorã€‚ ç±»å‹æ–­è¨€ åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ collections.abc.Iterableã€‚ In [1]: from collections.abc import Iterable In [2]: isinstance([1, 2, 3], Iterable) Out[2]: True In [3]: isinstance(1, Iterable) Out[3]: False In [4]: isinstance(&amp;#39;1&amp;#39;, Iterable) Out[4]: True In [5]: isinstance({}, Iterable) Out[5]: True è¿­ä»£å™¨(iterator) ä¸Šé¢å¤šæ¬¡æåˆ°äº†è¿­ä»£å™¨ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿå³å®ç°äº†è¿­ä»£å™¨åè®®çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨åè®®ç”± __iter__() å’Œ __next__() å…±åŒç»„æˆã€‚ä»¥ Golang æ¥å£çš„æ€ç»´ç†è§£å°±æ˜¯ä»»ä½•å®ç°äº†è¿™ä¿©æ–¹æ³•çš„å¯¹è±¡å°±æ˜¯è¿­ä»£å™¨ã€‚ æ˜¯çš„ï¼Œåˆæœ‰ __iter__()ï¼Œæ‰€ä»¥è¿­ä»£å™¨å¿…å®šä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚åœ¨è¿­ä»£å™¨ä¸­: __iter__() å¿…é¡»è¿”å›è¿­ä»£å™¨å¯¹è±¡æœ¬èº«ã€‚ __next__() åº”ä»å®¹å™¨ä¸­è¿”å›ä¸‹ä¸€é¡¹ï¼Œå¦‚æœå·²ç»æ²¡æœ‰æ•°æ®é¡¹å¯è¿”å›æ—¶ï¼Œåˆ™éœ€å¼•å‘ StopIteration å¼‚å¸¸ï¼Œç»§ç»­è°ƒç”¨å…¶ __next__() åº”å†æ¬¡å¼•å‘ StopIteration å¼‚å¸¸ã€‚ æ‰€ä»¥ä¸€ä¸ªè¿­ä»£å™¨åº”æœ‰çš„æ ·å­åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š class Iterator: def __iter__(self): return self def __next__(self): pass å·¥ä½œæ–¹å¼ è¿­ä»£å™¨ç”¨æ¥è¡¨ç¤ºä¸€è¿ä¸²æ•°æ®æµçš„å¯¹è±¡ï¼Œå½“ for è¯­å¥è‡ªåŠ¨è¿”å›å¯è¿­ä»£å¯¹è±¡çš„è¿­ä»£å™¨æ—¶ï¼Œfor å°†é‡å¤è°ƒç”¨å…¶ __next__() æ–¹æ³•å°†é€ä¸ªè¿”å›æµä¸­çš„é¡¹ï¼Œç›´åˆ°è¿­ä»£å™¨å¼•å‘ StopIteration å¼‚å¸¸åç»ˆæ­¢å¾ªç¯ã€‚æ­¤æ—¶è¯¥è¿­ä»£å™¨æ•°æ®é¡¹å·²è€—å°½ï¼Œä¸èƒ½å†ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è¿­ä»£å™¨ä¼ ç»™ next() å‡½æ•°æ¥æ¨¡æ‹Ÿ: In [11]: iterator = iter([1, 2, 3]) # æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ In [12]: for i in iterator: ...: print(i) ...: 1 2 3 In [13]: next(iterator) # è¯¥è¿­ä»£å™¨å·²è€—å°½ --------------------------------------------------------------------------- StopIteration Traceback (most recent call last) &amp;lt;ipython-input-13-4ce711c44abc&amp;gt; in &amp;lt;module&amp;gt; ----&amp;gt; 1 next(iterator) StopIteration: In [14]: iterator = iter([1, 2, 3]) In [15]: next(iterator) Out[15]: 1 In [16]: next(iterator) Out[16]: 2 In [17]: next(iterator) Out[17]: 3 In [18]: next(iterator) --------------------------------------------------------------------------- StopIteration Traceback (most recent call last) &amp;lt;ipython-input-18-4ce711c44abc&amp;gt; in &amp;lt;module&amp;gt; ----&amp;gt; 1 next(iterator) StopIteration: ç±»å‹ åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯ä»¥ä½¿ç”¨ collections.abc.Iteratorã€‚ In [31]: from collections.abc import Iterator In [32]: iterator = iter([1, 2, 3]) In [33]: isinstance(iterator, Iterator) Out[33]: True In [34]: isinstance([],Iterator) Out[34]: False ç»ƒä¹  é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä½ å¯èƒ½æˆ–å¤šæˆ–å°‘çš„äº†è§£äº†ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡ iterableï¼Œä»€ä¹ˆæ˜¯è¿­ä»£å™¨ iteratorã€‚ä¸€å¥è¯ç®€å•çš„æ€»ç»“å°±æ˜¯ï¼Œå½“æˆ‘ä»¬å¯¹å¯è¿­ä»£å¯¹è±¡è¿›è¡Œè¿­ä»£æ—¶ï¼Œå°±ä»å¯è¿­ä»£å¯¹è±¡è·å–è¿­ä»£å™¨è¿›è¡Œè¿­ä»£ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸€ä¸ªéå¸¸ç®€å•çš„ä¸€æ®µæ–‡æœ¬å¤„ç†çš„ç¤ºä¾‹ï¼Œä»ä¸‹é¢ä¸€æ®µ HTML æ–‡æœ¬ä¸­æå–å‡ºæ‰€æœ‰ a æ ‡ç­¾çš„ hrefã€‚ TEXT = (&amp;#39;&amp;lt;div&amp;gt;&amp;lt;a href=&amp;#34;https://blog.python.org&amp;#34; title=&amp;#34;More News&amp;#34;&amp;gt;More&amp;lt;/a&amp;gt;&amp;lt;ul class=&amp;#34;menu&amp;#34;&amp;gt;&amp;#39; &amp;#39;&amp;lt;li&amp;gt;&amp;lt;a href=&amp;#34;http://feedproxy.google.com/~r/PythonSoftwareFoundationNew/~3/T3r7qZxo-xg&amp;#39; &amp;#39;/python-software-foundation-fellow.html&amp;#34;&amp;gt;Python Software Foundation Fellow Members for&amp;#39; &amp;#39;Q3 2019&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt; &amp;lt;a href=&amp;#34;http://feedproxy.google.com/~r/PythonSoftwareFoundationNews&amp;#39; &amp;#39;/~3/lE0u-5MIUQc/why-sponsor-pycon-2020.html&amp;#34;&amp;gt;Why Sponsor PyCon 2020?&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li&amp;gt;&amp;lt;a href=&amp;#39; &amp;#39;&amp;#34;http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/jAMRqiPhWSs/seeking-developers&amp;#39; &amp;#39;-for-paid-contract.html&amp;#34;&amp;gt;Developers for Paid Contract Improving pip&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/div&amp;gt;&amp;#39;) class LinkFinder: PATTERN = &amp;#34;(?&amp;lt;=href=\&amp;#34;).+?(?=\&amp;#34;)|(?&amp;lt;=href=\&amp;#39;).+?(?=\&amp;#39;)&amp;#34; def __init__(self, text): self.links = re.findall(self.PATTERN, text) def __iter__(self): return LinkIiterator(self.links) class LinkIiterator: def __init__(self, links): self.links = links self.index = 0 def __iter__(self): return self def __next__(self): try: link = self.links[self.index] except IndexError: raise StopIteration self.index += 1 return link ç¨ç¨éªŒè¯ä¸€ä¸‹: In [39]: for link in LinkFinder(TEXT): ...: print(link) ...: https://blog.python.org http://feedproxy.google.com/~r/PythonSoftwareFoundationNew/~3/T3r7qZxo-xg/python-software-foundation-fellow.html http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/lE0u-5MIUQc/why-sponsor-pycon-2020.html http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/jAMRqiPhWSs/seeking-developers-for-paid-contract.html ç”Ÿæˆå™¨(generator) çœ‹å®Œä¸Šé¢çš„ä¾‹å­ï¼Œæœ‰åŒå­¦å¯èƒ½ä¼šæƒ³ï¼Œèƒ½ä¸èƒ½çœæ‰ LinkIiterator å‘¢ï¼Ÿæœ‰æ²¡æœ‰ä¸€ç§æœºåˆ¶èƒ½å¤Ÿè®© __iter__() è¿”å›çš„å¯¹è±¡è‡ªåŠ¨æä¾› __iter__() å’Œ __next__() æ–¹æ³•å‘¢ï¼Ÿ æœ‰ï¼Œé‚£å°±æ˜¯ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ ä¸€ä¸ªåŒ…å« yield çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°(é€šå¸¸ç§°å…¶ä¸ºç”Ÿæˆå™¨)ï¼Œå½“å…¶è¢«è°ƒç”¨çš„æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç§°ä¸ºç”Ÿæˆå™¨è¿­ä»£å™¨(generator iterator)ã€‚yield è¡¨è¾¾å¼ä¼šäº§ç”Ÿä¸€ç³»åˆ—å€¼æ¥ä¾›ç»™ for å¾ªç¯ä½¿ç”¨æˆ–æ˜¯é€šè¿‡ next() å‡½æ•°é€ä¸€è·å–ã€‚æ¯ä¸ª yield ä¼šä¸´æ—¶æš‚åœå¤„ç†ï¼Œè®°ä½å½“å‰ä½ç½®æ‰§è¡ŒçŠ¶æ€(åŒ…æ‹¬å±€éƒ¨å˜é‡ï¼ŒæŒ‡ä»¤æŒ‡é’ˆï¼Œå†…éƒ¨æ±‚å€¼æ ˆå’Œä»»ä½•å¼‚å¸¸å¤„ç†çš„çŠ¶æ€ç­‰)ï¼Œå½“è¯¥ç”Ÿæˆå™¨è¿­ä»£å™¨æ¢å¤æ—¶ï¼Œå®ƒä¼šä»ç¦»å¼€ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œè¿™ä¸æ¯æ¬¡è°ƒç”¨éƒ½ä»æ–°å¼€å§‹çš„æ™®é€šå‡½æ•°å·®åˆ«å¾ˆå¤§ã€‚å› æœ¬æ–‡ä¸»è¦è®²è¿­ä»£åè®®ï¼Œæ‰€ä»¥å…³äºç”Ÿæˆå™¨çš„å®ç°éƒ¨åˆ†æš‚ä¸å…·ä½“è®¨è®ºã€‚ ç”Ÿæˆå™¨æœºåˆ¶æä¾›äº†ä¸€ç§å®ç°è¿­ä»£å™¨åè®®çš„ä¾¿æ·æ–¹å¼ã€‚ å³å¦‚æœæˆ‘ä»¬æŠŠå®¹å™¨å¯¹è±¡ __iter__() æ–¹æ³•å®ç°ä¸ºä¸€ä¸ªç”Ÿæˆå™¨ï¼Œé‚£ä¹ˆå®ƒå°†è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨è¿­ä»£å™¨å¯¹è±¡(generator iterator)ï¼Œè¯¥å¯¹è±¡æä¾› __iter__() å’Œ __next__() æ–¹æ³•ä»¥ä¾›è¿­ä»£ã€‚ æˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­æ”¹æˆç”Ÿæˆå™¨ç‰ˆï¼š class LinkFinder: PATTERN = &amp;#34;(?&amp;lt;=href=\&amp;#34;).+?(?=\&amp;#34;)|(?&amp;lt;=href=\&amp;#39;).+?(?=\&amp;#39;)&amp;#34; def __init__(self, text): self.links = re.findall(self.PATTERN, text) def __iter__(self): for link in self.links: yield link éªŒè¯ä¸‹ï¼š In [40]: for link in LinkFinder(TEXT): ...: print(link) ...: https://blog.python.org http://feedproxy.google.com/~r/PythonSoftwareFoundationNew/~3/T3r7qZxo-xg/python-software-foundation-fellow.html http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/lE0u-5MIUQc/why-sponsor-pycon-2020.html http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/jAMRqiPhWSs/seeking-developers-for-paid-contract.html ä¼˜åŒ– æœ¬å°èŠ‚å…¶å®å±äºå¤šä½™éƒ¨åˆ†ï¼Œå…³äºè¿­ä»£åè®®çš„è®¨è®ºåŸºæœ¬å·²ç»ç»“æŸï¼Œä½†é€šè¿‡ä¸Šé¢å…³äºç”Ÿæˆå™¨çš„ä»‹ç»æˆ‘ä»¬å‘ç°ï¼Œç”Ÿæˆå™¨è¿­ä»£å™¨ä¸æ™®é€šè¿­ä»£å™¨çš„ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«å°±æ˜¯ï¼Œå…¶å¾€å¾€æ˜¯éšç”¨éšç”Ÿæˆï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ¯•ï¼Œè¿™åœ¨è¿­ä»£å¤§é‡æ•°æ®æ—¶å°†éå¸¸æœ‰ç”¨ï¼Œä¸ç”¨ä¸€æ¬¡æ€§è®¡ç®—æˆ–è½½å…¥å…¨éƒ¨çš„æ•°æ®åˆ°å†…å­˜ã€‚æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­è¿˜æœ‰å¾…ä¼˜åŒ–ã€‚å› ä¸º links åˆ—è¡¨æ˜¯ä¸€æ¬¡æ€§è®¡ç®—å¥½çš„ã€‚å¯ä»¥ä½¿ç”¨ re.finditer æ–¹æ³•ï¼Œå¯¹ links è¿›è¡Œæƒ°æ€§æ±‚å€¼ï¼š class LinkFinder: PATTERN = &amp;#34;(?&amp;lt;=href=\&amp;#34;).+?(?=\&amp;#34;)|(?&amp;lt;=href=\&amp;#39;).+?(?=\&amp;#39;)&amp;#34; def __init__(self, text): self.links = re.finditer(self.PATTERN, text) def __iter__(self): for link in self.links: yield link.group() è¿˜å¯ä»¥ä½¿ç”¨ä¸€ç§æ›´åŠ ç®€æ´çš„æ–¹å¼ï¼Œå³ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼š def __iter__(self): return (link.group() for link in self.links)</description>
    </item>
    
    <item>
      <title>é—²ä¾ƒ sys.path ä¸ buildout å®è·µ</title>
      <link>https://at7h.com/posts/py-syspath/</link>
      <pubDate>Mon, 15 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/py-syspath/</guid>
      <description>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è®¨è®ºä¸‹ Python ä¸­çš„ sys.pathï¼Œä»¥åŠå…¶åœ¨ buildout ä¸­çš„åº”ç”¨ä¸å®è·µï¼Œæœ€ååˆ†äº«ä¸‹åœ¨ neo/vim ä¸­ç»™ python-mode å’Œ coc-python æ·»åŠ è‡ªå®šä¹‰æœ¬åœ° Python åŒ…è·¯å¾„çš„æ–¹æ³•ã€‚ sys.path Python ä¸­çš„ sys.path æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œç”¨äºæŒ‡å®š Python Runtime çš„æ¨¡å—æœç´¢è·¯å¾„ã€‚ &amp;gt;&amp;gt;&amp;gt; import sys &amp;gt;&amp;gt;&amp;gt; sys.path [ &amp;#39;&amp;#39;, &amp;#39;/usr/local/lib/python27.zip&amp;#39;, &amp;#39;/usr/local/lib/python2.7&amp;#39;, &amp;#39;/usr/local/lib/python2.7/plat-darwin&amp;#39;, &amp;#39;/usr/local/lib/python2.7/plat-mac&amp;#39;, &amp;#39;/usr/local/lib/python2.7/plat-mac/lib-scriptpackages&amp;#39;, &amp;#39;/usr/local/lib/python2.7/lib-tk&amp;#39;, &amp;#39;/usr/local/lib/python2.7/lib-old&amp;#39;, &amp;#39;/usr/local/lib/python2.7/lib-dynload&amp;#39;, &amp;#39;/Users/jiawei/.local/lib/python2.7/site-packages&amp;#39;, &amp;#39;/usr/local/lib/python2.7/site-packages&amp;#39;, &amp;#39;/usr/local/lib/python2.7/site-packages/install-1.3.3-py2.7.egg&amp;#39; ] è¯¥åˆ—è¡¨ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œåˆå§‹åŒ–: 1. ç¬¬ä¸€éƒ¨åˆ† sys.path[0] æ˜¯ä½ å½“å‰è°ƒç”¨ python è§£é‡Šå™¨çš„è„šæœ¬çš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ä½ å½“å‰çš„ Python é¡¹ç›®è·¯å¾„ï¼Œå¦‚æœæ˜¯åœ¨ REPL ç¯å¢ƒä¸­ï¼Œå…¶ä¸ºç©ºå­—ç¬¦ä¸² &amp;quot;&amp;quot;ã€‚ 2. ç¬¬äºŒéƒ¨åˆ†æ˜¯å¼€å‘è€…å¯ä»¥ä¿®æ”¹æ§åˆ¶çš„ï¼Œé€šè¿‡å‡ ç§æ–¹å¼è¯»å–å¼€å‘è€…å®šä¹‰çš„æ¨¡å—è·¯å¾„ï¼Œä¾‹å¦‚é€šè¿‡è¯»å–ç¯å¢ƒå˜é‡ PYTHONPATH ç­‰ï¼Œä¸‹é¢å…·ä½“ä»‹ç»ã€‚ 3. æœ€åä¸€éƒ¨åˆ†æ˜¯ä½  Python å®‰è£…ç›¸å…³çš„é»˜è®¤ç¯å¢ƒã€‚ å½“æˆ‘ä»¬åœ¨ç¨‹åºä¸­å¯¼å…¥ import m æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ° ImportError: No module named m è¿™ç§ç±»ä¼¼çš„åŒ…æ— æ³•å¯¼å…¥çš„é—®é¢˜æ—¶ï¼ŒåŸå› åœ¨äºå®ƒæ‰€åœ¨çš„è·¯å¾„ä¸åœ¨ sys.path é‡Œï¼Œä¸‹é¢æˆ‘å°†åˆ—ä¸¾å‘ sys.path æ·»åŠ è‡ªå®šä¹‰æ¨¡å—è·¯å¾„å‡ ç§æ–¹æ³•ã€‚ 1. é€šè¿‡åˆ›å»º .pth æ–‡ä»¶ï¼Œå°†ç›®å½•åˆ—å‡ºæ¥ï¼Œä¾‹å¦‚ï¼š /my/prodir1 /my/prodir2 ä½†è¿™ç§æ–¹å¼æˆ‘ä»¬é€šå¸¸æ˜¯ä¸æå€¡çš„ï¼Œå…³äºæ›´å¤šå¦‚ä½•ä½¿ç”¨ .pth æ–‡ä»¶æ‹“å±• sys.path çš„ä»‹ç»å¯ä»¥é˜…è¯» site æ¨¡å—çš„æè¿°ã€‚ 2. é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ PYTHONPATHï¼Œå†™è¿‡ Go çš„æœ‹å‹åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œç±»ä¼¼äº Golang ä¸­æœ‰ GOROOT å’Œ GOPATHã€‚ export PYTHONPATH=/my/prodir1:/my/prodir2 ç°åœ¨å†æ¥çœ‹çœ‹æˆ‘ä»¬çš„ sys.path &amp;gt;&amp;gt;&amp;gt; import sys &amp;gt;&amp;gt;&amp;gt; sys.path [ &amp;#39;&amp;#39;, &amp;#39;/my/prodir1&amp;#39;, &amp;#39;/my/prodir2&amp;#39;, &amp;#39;/usr/local/lib/python27.zip&amp;#39;, &amp;#39;/usr/local/lib/python2.7&amp;#39;, &amp;#39;/usr/local/lib/python2.7/plat-darwin&amp;#39;, &amp;#39;/usr/local/lib/python2.7/plat-mac&amp;#39;, &amp;#39;/usr/local/lib/python2.7/plat-mac/lib-scriptpackages&amp;#39;, &amp;#39;/usr/local/lib/python2.7/lib-tk&amp;#39;, &amp;#39;/usr/local/lib/python2.7/lib-old&amp;#39;, &amp;#39;/usr/local/lib/python2.7/lib-dynload&amp;#39;, &amp;#39;/Users/jiawei/.local/lib/python2.7/site-packages&amp;#39;, &amp;#39;/usr/local/lib/python2.7/site-packages&amp;#39;, &amp;#39;/usr/local/lib/python2.7/site-packages/install-1.3.3-py2.7.egg&amp;#39; ] 3. è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å†™è„šæœ¬æ¥æ‰‹åŠ¨æ·»åŠ ï¼Œåœ¨è¿›å…¥ä½ ç¨‹åºçš„ work runtime ä¹‹å‰å°†è·¯å¾„æ’å…¥åˆ° sys.pathä¸­ï¼Œ è¿™ç§æ–¹å¼å¯ä»¥åšåˆ°é¡¹ç›®çº§ï¼Œæ¯”è¾ƒçµæ´»ï¼š import sys sys.path.insert(0, &amp;#39;/my/prodir1&amp;#39;) sys.path.insert(0, &amp;#39;/my/prodir2&amp;#39;) å½“ç„¶ï¼Œä¸Šé¢åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®è·µä¸­éœ€è¦å°½é‡é¿å…ç¡¬ç¼–ç ï¼Œå¯¼è‡´æ·»åŠ é”™è¯¯çš„è·¯å¾„ã€‚ buildout å¯¹äºä¸€ä¸ª Python å¼€å‘è€…æ¥è¯´ï¼Œè™šæ‹Ÿç¯å¢ƒå·¥å…·ä½ ä¸€å®šä¸é™Œç”Ÿï¼Œä¾‹å¦‚ virtualenvï¼Œvirtualenvwrapperï¼Œpipenv ç­‰ï¼Œå®ƒä»¬é€šå¸¸æä¾›äº†ä¸€ä¸ªç›¸å¯¹éš”ç¦»çš„ç¯å¢ƒæ¥å­˜æ”¾å’Œç®¡ç†ä½ éœ€è¦çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶ä¸ºä½ è®¾ç½®å¥½ sys.pathã€‚ä¸å¯¹ï¼Œè²Œä¼¼æœ‰ç‚¹è·‘é¢˜äº†ï¼Œå…³äºè™šæ‹Ÿç¯å¢ƒçš„å·¥ä½œåŸç†æˆ‘å°†åœ¨åé¢å•ç‹¬åˆ†äº«ï¼Œä¸‹é¢è¯·å‡ºæœ¬èŠ‚çš„ä¸»è§’å¤§å“¥å¤§ buildoutã€‚ Buildout æ˜¯ä¸€ä¸ª Python é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºæ‰“åŒ…å·¥å…·ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥ä¸ºå¤§å‹ç³»ç»Ÿåˆ›å»ºå¤æ‚ä½†å¯é‡ç”¨çš„è®¾ç½®ã€‚å…¶ä¸»è¦æ ¹æ®é…ç½®å°†é¡¹ç›®çš„ä¾èµ–ä»¥ egg åŒ…çš„å½¢å¼å…¨éƒ¨å½’åœ¨ç»Ÿä¸€çš„ä¸€ä¸ª eggs ç›®å½•ä¸‹ï¼Œè¿™æ ·å°±ä¸ç”¨ä¾èµ–ä»»ä½•å¤–éƒ¨çš„èµ„æºï¼Œæ¯”è™šæ‹Ÿç¯å¢ƒæ¥å¾—æ›´å½»åº•ã€‚egg åŒ… ç±»ä¼¼äº Java ä¸­çš„ jar åŒ…ï¼Œæƒ³äº†è§£æ›´å¤šä»‹ç»çš„åŒå­¦å¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚ å…³äº buildout çš„æ›´å¤šä»‹ç»å’Œä»¥åŠå¦‚ä½•é…ç½®ï¼Œå®˜æ–¹æ–‡æ¡£ä¸Šéƒ½æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œè€Œä¸”å› ä¸ºæœ¬æ–‡çš„ä¸»é¢˜æ˜¯ sys.pathï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒå®ƒåŒ…çš„ç»„ç»‡ï¼Œeggs ä¼šç”Ÿæˆåˆ°ä½ é¡¹ç›®ä¸‹çš„ buildout.cfg é…ç½®ä¸­çš„ eggs-directory ç›®å½•ä¸‹ï¼Œè€Œä¸€èˆ¬æˆ‘ä»¬å¹¶ä¸éœ€è¦é¢å¤–å»é…ç½®ï¼Œé»˜è®¤ä¼šç”Ÿæˆåœ¨å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œä¸ºä½ çš„é¡¹ç›®ä½¿ç”¨ã€‚ å½“ç„¶ buildout ä¹Ÿæ”¯æŒåœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å…±äº« eggsã€‚è¿™éœ€è¦ä½ æ–°å»º $HOME/.buildout/default.cfg æ–‡ä»¶ï¼Œè®¾ç½®ç”¨æˆ·çº§çš„é»˜è®¤é…ç½®ï¼š [buildout] eggs-directory = ~/.buildout/eggs download-cache = ~/.buildout/downloads é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡æ¯ä¸ª parts ä¸‹çš„ extra-paths é…ç½®ä½ æœ¬åœ°çš„åŒ…ï¼š [buildout] parts = app [app] recipe = zc.recipe.egg interpreter = python eggs = my-pro-name extra-paths = ${buildout:directory}/my-extra-pkg å¥½ï¼Œå›åˆ°ä¸»é¢˜ï¼Œæ—¢ç„¶æ˜¯å°†ä¾èµ–åŒ…æ‰“åœ¨é¡¹ç›®é‡Œï¼Œæ‰€ä»¥è¦æ­£ç¡®å¯åŠ¨æœåŠ¡ï¼Œbuildout è‚¯å®šè¦å°†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–åŒ… eggs ä¸­çš„åŒ…è·¯å¾„ä»¥åŠ extra-paths åŠ å…¥åˆ° sys.path ä¸­ï¼Œå®ƒé‡‡ç”¨çš„æ–¹å¼æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„ç¬¬ä¸‰ç§ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ bin ä¸‹ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸€çœ‹ä¾¿çŸ¥ï¼š #!/Path/to/your/local/python import os, sys base = os.path.dirname(os.path.abspath(os.path.realpath(__file__))) base = os.path.dirname(base) sys.path[0:0] = [ base, &amp;#39;/path/to/local/pro/eggs/pkg1.egg&amp;#39;, &amp;#39;/path/to/local/pro/eggs/pkg2.egg&amp;#39;, # ... &amp;#39;/path/to/local/pro/my-extra-pkg&amp;#39; ] # ... å¦‚æœæ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›åŒ…æ˜¯ä½ å·²ç»å®‰è£…äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸Šé¢è°ˆåˆ°çš„ sys.path çš„ç¬¬ä¸‰éƒ¨åˆ†çš„ä¸­çš„æŸä¸ªè·¯å¾„ä¸‹ï¼Œæ¯”å¦‚ /usr/local/lib/python2.7/site-packages, é‚£ä¹ˆåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­å°±ä¸ä¼šç”Ÿæˆç›¸åº”çš„ egg åŒ…äº†ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸Šè¿° sys.path ä¹Ÿä¼šåŠ ä¸Šè¿™ä¸ªè·¯å¾„ï¼Œå› ä¸º buildout å¿…é¡»ä¿è¯é¡¹ç›®ä¾èµ–åŒ…çš„å®Œå¤‡æ€§ã€‚ vim æ’ä»¶æ”¯æŒ buildout è™½ç„¶å¾ˆå®Œç¾ï¼Œä½†è¿™ä¹Ÿç»™ neo/vim ä¸‹çš„ Python ç¯å¢ƒæ­å»ºå¸¦æ¥äº†ä¸€ç‚¹éº»çƒ¦ï¼Œæ®æˆ‘æ‰€çŸ¥ç›®å‰çš„ä¸€äº› Python ç›¸å…³çš„æ’ä»¶å¹¶æ²¡æœ‰ç›´æ¥æ”¯æŒ buildout çš„ï¼ˆPyCharm æ˜¯æ”¯æŒçš„ï¼Œç›´æ¥é…ç½®å³å¯ï¼‰ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½æ­£ç¡®è¯†åˆ« buildout çš„é…ç½®æ¥åŠ è½½æˆ‘ä»¬é¡¹ç›®çš„é‚£äº›ä¾èµ–åŒ…ï¼Œåœ¨ rope init æˆ–è€… lint æ—¶ä¼šæŠ¥é”™æ‰¾ä¸åˆ°åŒ…ï¼Œå› æ­¤ä»£ç è·³è½¬è¡¥å…¨ç­‰åŸºç¡€åŠŸèƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦è‡ªå·±æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå°†ä¸Šè¿°ä¾èµ–åŒ…åŠ å…¥åˆ°å…¶è¿è¡Œæ—¶ç¯å¢ƒä¸­ã€‚ å½“ç„¶ä½ å¯ä»¥ç›´æ¥é€šè¿‡æˆ‘ä»¬ä¸Šè¿°çš„å‡ ç§æ–¹æ³•æ¥å®ç°ï¼Œä½†è¿™ä¸æ˜¯æˆ‘æ¨èçš„ï¼Œå› ä¸ºé…ç½®ç¯å¢ƒå˜é‡ç­‰ç­‰éƒ½æ˜¯å…¨å±€çš„ï¼Œå¹¸å¥½ç›®å‰æˆ‘ç”¨çš„å‡ ä¸ªæ’ä»¶éƒ½æ”¯æŒè‡ªå®šä¹‰åŒ…çš„æ‹“å±•é…ç½®ï¼Œæ¯”å¦‚ python-mode å’Œ coc-pythonã€‚ 1. å¯¹äº pymode pymode æä¾›äº† g:pymode_paths æ•°ç»„æ¥å­˜æ”¾é¢å¤–çš„åŒ…è·¯å¾„ï¼Œæ‰€ä»¥åœ¨ä½ çš„ pymode é…ç½®ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®å³å¯ï¼š if $BUILDOUT_EGGS_PATH != &amp;#39;&amp;#39; let g:pymode_paths = reverse(split(globpath($BUILDOUT_EGGS_PATH, &amp;#39;*&amp;#39;), &amp;#39;\n&amp;#39;)) else let g:pymode_paths = reverse(split(globpath(getcwd().&amp;#39;/eggs&amp;#39;, &amp;#39;*&amp;#39;), &amp;#39;\n&amp;#39;)) endif åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œå¦‚æœä½ çš„ buildout ä½¿ç”¨äº†å¤šä¸ªé¡¹ç›®å…±äº« eggs æ¨¡å¼çš„è¯ï¼Œä¸º BUILDOUT_EGGS_PATH é…ç½®å…±äº« eggs çš„è·¯å¾„å³å¯: export BUILDOUT_EGGS_PATH=/path/to/buildout/eggs/path è€Œå¦‚æœå¹¶ä¸æ˜¯å…±äº« eggs çš„æ¨¡å¼ï¼Œé‚£ä¹ˆé¡¹ç›®çš„åŒ…éƒ½ä¼šåœ¨å½“å‰ç›®å½•ä¸‹çš„ eggs ä¸­ï¼Œå°±ä¸ç”¨ä»»ä½•é…ç½®ï¼Œé…ç½®ä¼šèµ°åˆ° else é€»è¾‘è‡ªåŠ¨è·å–åŒ…è·¯å¾„ã€‚ å¯¹äºä¸Šè¿°é…ç½®åœ¨ extra-paths ä¸‹çš„åŒ…å¯ä»¥: let g:pymode_paths = g:pymode_paths + reverse(split(getcwd().&amp;#39;/my-extra-pkg&amp;#39;, &amp;#39;\n&amp;#39;) 2. å¯¹äº coc-python åŒæ ·çš„ï¼Œcoc-python ä¹Ÿæä¾›äº†ç›¸åº”çš„é…ç½®ï¼š python.autoComplete.extraPaths: List of paths to libraries and the like that need to be imported by auto complete engine. E.g. when using Google App SDK, the paths are not in system path, hence need to be added into this list., default: [] æ‰€ä»¥æˆ‘ä»¬åªéœ€åœ¨ coc-settings.json ä¸­åŠ å…¥ç›¸åº”é…ç½®å³å¯ï¼Œæˆ‘ä»¬ä¾æ—§ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼š { // ... &amp;#34;python.autoComplete.extraPaths&amp;#34;:[ &amp;#34;/path/to/local/pro/eggs/pkg1.egg&amp;#34;, &amp;#34;/path/to/local/pro/eggs/pkg2.egg&amp;#34;, &amp;#34;my-extra-pkg&amp;#34; ] // ... } åŠ å…¥é…ç½®ä¹‹åå¯ä»¥åœ¨ neo/vim COMMAND æ¨¡å¼ä¸‹ä½¿ç”¨ CocInfo å‘½ä»¤æ¥æŸ¥çœ‹ path çš„æŸ¥æ‰¾è¯¦æƒ…ã€‚ æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹æˆ‘çš„é…ç½®ï¼ŒåŒæ—¶ä¹Ÿæ¬¢è¿å¤§å®¶è¯„è®ºç•™è¨€ï¼Œä¸æˆ‘äº¤æµã€‚</description>
    </item>
    
    <item>
      <title>Python3 åç¨‹(coroutine)ä»‹ç»</title>
      <link>https://at7h.com/posts/coroutine/</link>
      <pubDate>Wed, 10 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/coroutine/</guid>
      <description>ç›®å‰ Python è¯­è¨€çš„åç¨‹ä»å®ç°æ¥è¯´å¯åˆ†ä¸ºä¸¤ç±»ï¼š ä¸€ç§æ˜¯åŸºäºä¼ ç»Ÿç”Ÿæˆå™¨çš„åç¨‹ï¼Œå«åš generator-based coroutinesï¼Œé€šè¿‡åŒ…è£… generator å¯¹è±¡å®ç°ã€‚ å¦ä¸€ç§åœ¨ Python 3.5 ç‰ˆæœ¬ PEP 492 è¯ç”Ÿï¼Œå«åš native coroutinesï¼Œå³é€šè¿‡ä½¿ç”¨ async è¯­æ³•æ¥å£°æ˜çš„åç¨‹ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»ç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§åŸºäºç”Ÿæˆå™¨çš„åç¨‹å·²åœ¨ Python 3.8 ä¸­å¼ƒç”¨ï¼Œå¹¶è®¡åˆ’åœ¨ Python 3.10 ä¸­ç§»é™¤ã€‚æœ¬æ–‡æ˜¯ã€Œä»‹ç»ã€ï¼Œå°±å…ˆä¸è®¨è®ºå¤ªå¤šå®ç°åŸç†çš„ä¸œè¥¿ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥ç»§ç»­å…³æ³¨åé¢çš„æ–‡ç« ã€‚ åç¨‹(coroutine) é¦–å…ˆï¼Œæ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼š import asyncio async def c(): await asyncio.sleep(1) return &amp;#39;Done ğŸ‘Œ&amp;#39; è¿™ä¸ªè¢« async ä¿®é¥°çš„å‡½æ•° c å°±æ˜¯ä¸€ä¸ªåç¨‹å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ã€‚ In [1]: asyncio.iscoroutinefunction(c) Out[1]: True In [2]: c() Out[2]: &amp;lt;coroutine object c at 0x107b0f748&amp;gt; In [3]: asyncio.iscoroutine(c()) Out[3]: True ä¸€èˆ¬æ¥è¯´ï¼Œåç¨‹å‡½æ•° c åº”å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š ä¸€å®šä¼šè¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼Œè€Œä¸ç®¡å…¶ä¸­æ˜¯å¦æœ‰ await è¡¨è¾¾å¼ã€‚ å‡½æ•°ä¸­ä¸èƒ½å†ä½¿ç”¨ yield fromã€‚ å‡½æ•°å†…éƒ¨å¯é€šè¿‡ await è¡¨è¾¾å¼æ¥æŒ‚èµ·è‡ªèº«åç¨‹ï¼Œå¹¶ç­‰å¾…å¦ä¸€ä¸ªåç¨‹å®Œæˆç›´åˆ°è¿”å›ç»“æœã€‚ await è¡¨è¾¾å¼åé¢å¯ä»¥è·Ÿçš„ä¸€å®šæ˜¯ä¸€ä¸ªå¯ç­‰å¾…å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯åç¨‹å¯¹è±¡ã€‚ ä¸å¯åœ¨ async ä¿®é¥°çš„åç¨‹å‡½æ•°å¤–ä½¿ç”¨ await å…³é”®å­—ï¼Œå¦åˆ™ä¼šå¼•å‘ä¸€ä¸ª SyntaxErrorã€‚ å½“å¯¹åç¨‹å¯¹è±¡è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¦‚æœä»æœªç­‰å¾…è¿‡å®ƒï¼Œåˆ™ä¼šå¼•å‘ä¸€ä¸ª RuntimeWarningï¼ˆå¦‚æœä½ åˆšå¼€å§‹å†™ asyncï¼Œé‚£ä½ ä¸€å®šé‡å¾—åˆ°ï¼Œä¸ç»æ„é—´å°±ä¼šå¿˜æ‰ä¸€ä¸ª await)ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæ¦‚å¿µï¼Œå¯ç­‰å¾…å¯¹è±¡å’Œåç¨‹å¯¹è±¡ã€‚ å¯ç­‰å¾…å¯¹è±¡(awaitable) æˆ‘ä»¬æ¥çœ‹ collections.abc æ¨¡å—ä¸­å¯¹ Awaitable ç±»çš„å®šä¹‰ï¼š class Awaitable(metaclass=ABCMeta): __slots__ = () @abstractmethod def __await__(self): yield @classmethod def __subclasshook__(cls, C): if cls is Awaitable: return _check_methods(C, &amp;#34;__await__&amp;#34;) return NotImplemented å¯è§ï¼Œå¯ç­‰å¾…å¯¹è±¡ä¸»è¦å®ç°äº†ä¸€ä¸ª __await__ æ–¹æ³•ã€‚ä¸”è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªè¿­ä»£å™¨(iterator) â‘ ï¼Œå¦åˆ™å°†ä¼šå¼•å‘ä¸€ä¸ª TypeErrorã€‚ æ³¨æ„ï¼šä¸»è¦å®ç°æ˜¯å› ä¸º await è¡¨è¾¾å¼éœ€è¦è·Ÿè€çš„åŸºäºç”Ÿæˆå™¨çš„åç¨‹ç›¸å…¼å®¹ï¼Œå³é€šè¿‡ä½¿ç”¨ types.coroutine() æˆ– asyncio.coroutine() è£…é¥°å™¨è¿”å›çš„ç”Ÿæˆå™¨è¿­ä»£å™¨å¯¹è±¡(generator iterator)ä¹Ÿå±äºå¯ç­‰å¾…å¯¹è±¡ï¼Œä½†å®ƒä»¬å¹¶æœªå®ç° __await__ æ–¹æ³•ã€‚ åç¨‹å¯¹è±¡(Coroutine) åŒæ ·çš„ï¼Œæˆ‘ä»¬æ¥çœ‹ collections.abc æ¨¡å—ä¸­å¯¹ Coroutine ç±»çš„å®šä¹‰ï¼š class Coroutine(Awaitable): __slots__ = () @abstractmethod def send(self, value): &amp;#34;&amp;#34;&amp;#34;Send a value into the coroutine. Return next yielded value or raise StopIteration. &amp;#34;&amp;#34;&amp;#34; raise StopIteration @abstractmethod def throw(self, typ, val=None, tb=None): &amp;#34;&amp;#34;&amp;#34;Raise an exception in the coroutine. Return next yielded value or raise StopIteration. &amp;#34;&amp;#34;&amp;#34; if val is None: if tb is None: raise typ val = typ() if tb is not None: val = val.with_traceback(tb) raise val def close(self): &amp;#34;&amp;#34;&amp;#34;Raise GeneratorExit inside coroutine. &amp;#34;&amp;#34;&amp;#34; try: self.throw(GeneratorExit) except (GeneratorExit, StopIteration): pass else: raise RuntimeError(&amp;#34;coroutine ignored GeneratorExit&amp;#34;) @classmethod def __subclasshook__(cls, C): if cls is Coroutine: return _check_methods(C, &amp;#39;__await__&amp;#39;, &amp;#39;send&amp;#39;, &amp;#39;throw&amp;#39;, &amp;#39;close&amp;#39;) return NotImplemented ç”±ä¸Šå¯çŸ¥ï¼Œç”±äºç»§æ‰¿å…³ç³»ï¼Œåç¨‹å¯¹è±¡æ˜¯å±äºå¯ç­‰å¾…å¯¹è±¡çš„ã€‚ é™¤äº†åç¨‹ Coroutine å¯¹è±¡å¤–ï¼Œç›®å‰å¸¸è§çš„å¯ç­‰å¾…å¯¹è±¡è¿˜æœ‰ä¸¤ç§ï¼šasyncio.Task å’Œ asyncio.Futureï¼Œä¸‹æ–‡ä¸­ä»‹ç»ã€‚ åç¨‹çš„æ‰§è¡Œå¯é€šè¿‡è°ƒç”¨ __await__() å¹¶è¿­ä»£å…¶ç»“æœè¿›è¡Œæ§åˆ¶ã€‚å½“åç¨‹ç»“æŸæ‰§è¡Œå¹¶è¿”å›æ—¶ï¼Œè¿­ä»£å™¨ä¼šå¼•å‘ StopIteration å¼‚å¸¸ï¼Œå¹¶é€šè¿‡è¯¥å¼‚å¸¸çš„ value å±æ€§æ¥ä¼ æ’­åç¨‹çš„è¿”å›å€¼ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š In [4]: c().send(None) Out[4]: &amp;lt;Future pending&amp;gt; In [5]: async def c1(): ...: return &amp;#34;Done ğŸ‘Œ&amp;#34; ...: In [6]: c1().send(None) Out[6]: StopIteration: Done ğŸ‘Œ è¿è¡Œ åç¨‹çš„è¿è¡Œéœ€è¦åœ¨ä¸€ä¸ª EventLoop ä¸­è¿›è¡Œï¼Œç”±å®ƒæ¥æ§åˆ¶å¼‚æ­¥ä»»åŠ¡çš„æ³¨å†Œã€æ‰§è¡Œã€å–æ¶ˆç­‰ã€‚å…¶å¤§è‡´åŸç†æ˜¯ï¼š æŠŠä¼ å…¥çš„æ‰€æœ‰å¼‚æ­¥å¯¹è±¡(å‡†ç¡®çš„è¯´æ˜¯å¯ç­‰å¾…å¯¹è±¡ï¼Œå¦‚ Coroutineï¼ŒTask ç­‰ï¼Œè§ä¸‹æ–‡)éƒ½æ³¨å†Œåˆ°è¿™ä¸ª EventLoop ä¸Šï¼ŒEventLoop ä¼šå¾ªç¯æ‰§è¡Œè¿™äº›å¼‚æ­¥å¯¹è±¡ï¼Œä½†åŒæ—¶åªæ‰§è¡Œä¸€ä¸ªï¼Œå½“æ‰§è¡Œåˆ°æŸä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå®ƒæ­£åœ¨ç­‰å¾…å…¶ä»–å¯¹è±¡ï¼ˆI/O å¤„ç†ï¼‰ è¿”å›ï¼Œäº‹ä»¶å¾ªç¯ä¼šæš‚åœå®ƒçš„æ‰§è¡Œå»æ‰§è¡Œå…¶ä»–çš„å¯¹è±¡ã€‚å½“æŸä¸ªå¯¹è±¡å®Œæˆ I/O å¤„ç†åï¼Œä¸‹æ¬¡å¾ªç¯åˆ°å®ƒçš„æ—¶å€™ä¼šè·å–å…¶è¿”å›å€¼ç„¶åç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚è¿™æ ·ä»¥æ¥ï¼Œæ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡å°±å¯ä»¥ååŒè¿è¡Œã€‚ EventLoop æ¥å—çš„å¯¹è±¡å¿…é¡»ä¸ºå¯ç­‰å¾…å¯¹è±¡ï¼Œç›®å‰ä¸»è¦æœ‰ä¸‰ç§ç±»å‹å³ Coroutine, Task å’Œ Futureã€‚ ä¸‹é¢ç®€å•çš„ä»‹ç»ä¸‹ Task å’Œ Futureï¼š Future æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä½çº§çš„å¯ç­‰å¾…å¯¹è±¡ï¼Œç”¨æ¥æ”¯æŒåº•å±‚å›è°ƒå¼ä»£ç ä¸é«˜å±‚ async/await å¼çš„ä»£ç äº¤äº’ï¼Œæ˜¯å¯¹åç¨‹åº•å±‚å®ç°çš„å°è£…ï¼Œå…¶è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœã€‚å®ƒæä¾›äº†è®¾ç½®å’Œè·å– Future æ‰§è¡ŒçŠ¶æ€æˆ–ç»“æœç­‰æ“ä½œçš„æ¥å£ã€‚Future å®ç°äº† __await__ åè®®ï¼Œå¹¶é€šè¿‡ __iter__ = __await__ æ¥å…¼å®¹è€å¼åç¨‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™ç©æ„å„¿ï¼Œæ—¥å¸¸çš„å¼€å‘ä¹Ÿæ˜¯ä¸éœ€è¦è¦ç”¨åˆ°å®ƒçš„ã€‚å¦‚æœ‰éœ€è¦ï¼Œå°±ç”¨å…¶å­ç±» Taskã€‚ Task ç”¨æ¥ååŒçš„è°ƒåº¦åç¨‹ä»¥å®ç°å¹¶å‘ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„æ¥å£ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ åˆ›å»ºä¸€ä¸ª Task éå¸¸ç®€å•ï¼š In [6]: loop = asyncio.get_event_loop() In [7]: task = loop.create_task(c()) In [8]: task Out[8]: &amp;lt;Task pending coro=&amp;lt;c() running at &amp;lt;ipython-input-1-3afd2bbb1944&amp;gt;:3&amp;gt;&amp;gt; In [9]: task.done() Out[9]: False In [10]: task.cancelled() Out[10]: False In [11]: task.result() Out[11]: InvalidStateError: Result is not set. In [12]: await task Out[12]: &amp;#39;Done ğŸ‘Œ&amp;#39; In [13]: task Out[13]: &amp;lt;Task finished coro=&amp;lt;c() done, defined at &amp;lt;ipython-input-1-3afd2bbb1944&amp;gt;:3&amp;gt; result=&amp;#39;Done ğŸ‘Œ&amp;#39;&amp;gt; In [14]: task.done() Out[14]: True In [15]: task.result() Out[15]: &amp;#39;Done ğŸ‘Œ&amp;#39; In [16]: task = loop.create_task(c()) In [17]: task.cancel() Out[17]: True In [18]: await task Out[18]: CancelledError: ä¸Šé¢è¯´åˆ°ï¼Œåç¨‹çš„è¿è¡Œéœ€è¦åœ¨ä¸€ä¸ª EventLoop ä¸­è¿›è¡Œï¼Œåœ¨ Python 3.7 ä¹‹å‰ï¼Œä½ åªèƒ½è¿™ä¹ˆå†™ ğŸ˜” : In [19]: loop = asyncio.get_event_loop() In [20]: loop.run_until_complete(c()) Out[20]: &amp;#39;Done ğŸ‘Œ&amp;#39; In [21]: loop.close() Python 3.7 åŠä»¥ä¸Šç‰ˆæœ¬å¯ä»¥ç›´æ¥ä½¿ç”¨ asyncio.run() ğŸ‘ : In [22]: asyncio.run(c()) Out[22]: &amp;#39;Done ğŸ‘Œ&amp;#39; å¹¶å‘ æœ‰äº›ç«¥é‹å¯èƒ½æœ‰ç–‘é—®äº†ï¼Œæˆ‘å†™å¥½äº†ä¸€ä¸ªä¸ªåç¨‹å‡½æ•°ï¼Œæ€æ ·æ‰èƒ½å¹¶å‘çš„è¿è¡Œ ğŸ¤” ï¼Ÿ asyncio æä¾›äº†ç›¸åº”çš„ä¸¤ä¸ªæ¥å£ï¼šasyncio.gather å’Œ asyncio.wait æ¥æ”¯æŒ: async def c1(): await asyncio.sleep(1) print(&amp;#39;c1 done&amp;#39;) return True async def c2(): await asyncio.sleep(2) print(&amp;#39;c2 done&amp;#39;) return True async def c12_by_gather(): await asyncio.gather(c1(), c2()) async def c12_by_awit(): await asyncio.wait([c1(), c2()]) In [23]: asyncio.run(c12_by_gather()) c1 done c2 done In [24]: asyncio.run(c12_by_awit()) c1 done c2 done å…¶å®ƒ ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº† PEP 492 coroutine çš„åŸºç¡€ä½¿ç”¨ï¼ŒåŒæ—¶ PEP 492 ä¹Ÿç›¸åº”æå‡ºäº†åŸºäº async with å’Œ async for è¡¨è¾¾å¼çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨(asynchronous context manager)å’Œå¼‚æ­¥è¿­ä»£å™¨(asynchronous iterator)ã€‚ ä¸‹é¢çš„ä»‹ç»çš„ç¤ºä¾‹å°†åŸºäº Python å¯è¿­ä»£å¯¹è±¡, è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ é‡Œçš„ç¤ºä¾‹å±•å¼€ï¼Œå»ºè®®æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ã€‚ å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬å¸¸ä¼šé€šè¿‡å®ç° __enter__() å’Œ __exit__() æ–¹æ³•æ¥å®ç°ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š In [1]: class ContextManager: ...: ...: def __enter__(self): ...: print(&amp;#39;enter...&amp;#39;) ...: ...: def __exit__(slef, exc_type, exc_val, exc_tb): ...: print(&amp;#39;exit...&amp;#39;) ...: In [2]: with ContextManager(): ...: print(&amp;#39;Do something...&amp;#39;) ...: enter... Do something... exit... åŒæ ·çš„ï¼Œåœ¨å¼‚æ­¥ç¼–ç¨‹æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° __aenter__() å’Œ __aexit__() æ–¹æ³•æ¥å®ç°ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå¹¶é€šè¿‡ async with è¡¨è¾¾å¼æ¥ä½¿ç”¨ã€‚ In [1]: class AsyncContextManager: ...: ...: async def __aenter__(self): ...: print(&amp;#39;async enter...&amp;#39;) ...: ...: async def __aexit__(slef, exc_type, exc_val, exc_tb): ...: print(&amp;#39;async exit...&amp;#39;) ...: In [2]: async with AsyncContextManager(): ...: print(&amp;#39;Do something...&amp;#39;) ...: async enter... Do something... async exit... å¼‚æ­¥è¿­ä»£ åœ¨ä¹‹å‰çš„æ–‡ç«  Python å¯è¿­ä»£å¯¹è±¡, è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†é€šè¿‡å®ç° __iter__() æ–¹æ³•æ¥å®ç°ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œé€šè¿‡å®ç°è¿­ä»£å™¨åè®® __iter__() å’Œ __next__() æ–¹æ³•æ¥å®ç°ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚ä¸‹é¢æˆ‘ä»¬æ”¹é€ ä¸‹ä¹‹å‰çš„ä¾‹å­ï¼Œå®ç°ä¸€ä¸ªå¼‚æ­¥çš„ç‰ˆæœ¬ã€‚ class AsyncLinkFinder: PATTERN = &amp;#34;(?&amp;lt;=href=\&amp;#34;).+?(?=\&amp;#34;)|(?&amp;lt;=href=\&amp;#39;).+?(?=\&amp;#39;)&amp;#34; def __init__(self, text): self.links = re.findall(self.PATTERN, text) def __aiter__(self): return AsyncLinkIiterator(self.links) class AsyncLinkIiterator: def __init__(self, links): self.links = links self.index = 0 async def _gen_link(self): try: link = self.links[self.index] self.index += 1 except IndexError: link = None return link def __aiter__(self): return self async def __anext__(self): link = await self._gen_link() if link is None: raise StopAsyncIteration return link In [7]: async for s in AsyncLinkFinder(TEXT): ...: print(s) https://blog.python.org http://feedproxy.google.com/~r/PythonSoftwareFoundationNew/~3/T3r7qZxo-xg/python-software-foundation-fellow.html http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/lE0u-5MIUQc/why-sponsor-pycon-2020.html http://feedproxy.google.com/~r/PythonSoftwareFoundationNews/~3/jAMRqiPhWSs/seeking-developers-for-paid-contract.html ä¾‹å­ä¸­å®ç°äº† __aiter__() æ–¹æ³•çš„ AsyncLinkFinder å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ï¼Œ__aiter__() æ–¹æ³•è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ï¼Œå¦‚ AsyncLinkIiteratorã€‚å¼‚æ­¥è¿­ä»£å™¨å¿…é¡»åŒæ—¶å®ç° __aiter__() å’Œ __anext__() æ–¹æ³•ã€‚ä¸€ä¸ªä¸åŒçš„ç‚¹æ˜¯ï¼Œå¼‚æ­¥è¿­ä»£ä¸­ï¼Œå½“è¿­ä»£å™¨è€—å°½æ—¶ï¼Œéœ€è¦å¼•å‘ä¸€ä¸ª StopAsyncIteration è€Œä¸æ˜¯ StopIterationã€‚ åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå®ç°ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨ç‰ˆæœ¬çš„ï¼š class LinkFinder: PATTERN = &amp;#34;(?&amp;lt;=href=\&amp;#34;).+?(?=\&amp;#34;)|(?&amp;lt;=href=\&amp;#39;).+?(?=\&amp;#39;)&amp;#34; def __init__(self, text): self.links = re.finditer(self.PATTERN, text) async def __aiter__(self): return (link.group() for link in self.links) æ³¨ â‘  å…³äºè¿­ä»£å™¨çš„ä»‹ç»å¯é˜…è¯» Python å¯è¿­ä»£å¯¹è±¡, è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ã€‚ â‘¡ å…³äºç¤ºä¾‹ä¸­ __slots__ çš„ä»‹ç»è¯·æŸ¥çœ‹ ç†è§£ Python ç±»å±æ€§ä¹‹ __slots__ã€‚ å‚è€ƒ PEP 492: Coroutines with async and await syntax PEP 342: Coroutines via Enhanced Generators</description>
    </item>
    
    <item>
      <title>Sentry æœåŠ¡çš„æ­å»ºå’Œä½¿ç”¨</title>
      <link>https://at7h.com/posts/sentry-install/</link>
      <pubDate>Wed, 03 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/sentry-install/</guid>
      <description>Sentry æ˜¯ä¸€ä¸ªå¼€æºçš„éå¸¸å¼ºå¤§çš„å®æ—¶å¼‚å¸¸æ”¶é›†ç³»ç»Ÿï¼Œå¯ä»¥ä¸ºå¼€å‘è€…çš„æä¾›å¸®åŠ©ã€è¯Šæ–­ï¼Œä¿®å¤å’Œä¼˜åŒ–å…¶ä»£ç çš„æ€§èƒ½çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨å®ƒæ¥ç›‘æ§çº¿ä¸ŠæœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå®æ—¶æ”¶é›†çš„å¼‚å¸¸å †æ ˆä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå‘ç°ã€å®šä½å’Œä¿®å¤é—®é¢˜ã€‚æ”¯æŒ Web å‰åç«¯ã€ç§»åŠ¨åº”ç”¨ä»¥åŠæ¸¸æˆï¼Œ90 ä½™ç§ä¸»æµè¯­è¨€å’Œç›¸å…³æ¡†æ¶ï¼ŒåŒæ—¶è¿˜æä¾›äº†éå¸¸å‹å¥½çš„ç®¡ç†é¡µé¢ï¼Œé”™è¯¯å‘Šè­¦ã€æŒ‡æ´¾ã€ç»Ÿè®¡ç­‰å…¶ä»–ä¸°å¯Œçš„åŠŸèƒ½ã€‚æ›´å¤šä»‹ç»å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ Sentry æä¾›äº†å•†ç”¨çš„æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥åœ¨å®˜ç½‘è´­ä¹°ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å¼€æºç‰ˆæœ¬ï¼Œå¯ä»¥è‡ªè¡Œæ­å»ºå®‰è£…ã€‚æœ€è¿‘åˆšå¥½ä¸ºç»„é‡Œçš„å‡ ä¸ªæœåŠ¡æ­å»ºå’Œå¼•å…¥ Sentryï¼Œå°±è®°å½•ä¸‹æ¥ä¸å¤§å®¶åˆ†äº«ã€‚ Sentry æä¾›äº†ä¸¤ç§å®‰è£…æ–¹å¼ï¼šdocker å’Œ Python åŒ…ã€‚ æˆ‘è¿™é‡Œæ¨èæ­å»ºä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼Œæ¯”è¾ƒç®€ä¾¿ï¼Œå¦åˆ™ä½ éœ€è¦è‡ªè¡Œå®‰è£…å’Œå¯åŠ¨ PostgreSQLã€Redisã€Kafka ç­‰ä¸€ç³»åˆ—æœåŠ¡å’Œåˆ›å»ºè¡¨ç­‰æ“ä½œã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨ docker çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œ éƒ¨ç½² Sentry ç¯å¢ƒå‡†å¤‡ 1. å®‰è£… docker $ curl -sSL https://get.daocloud.io/docker | sh å¦‚æœå·²ç»å®‰è£…äº†å…¶ä»–å†å²ç‰ˆæœ¬ï¼Œè¯·åœ¨å®‰è£…å‰å…ˆå¸è½½ã€‚ 2. å®‰è£… docker-compose $ sudo curl -L &amp;quot;https://github.com/docker/compose/releases/download/1.27.1/docker-compose-$(uname -s)-$(uname -m)&amp;quot; -o /usr/local/bin/docker-compose $ sudo chmod +x /usr/local/bin/docker-compose æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š $ docker -v Docker version 19.03.1, build 74b1e89 $ docker-compose -v docker-compose version 1.27.1, build 1110ad01 å®‰è£… Sentry 1. è·å– onpremise $ git clone https://github.com/getsentry/onpremise.git 2. æ‰§è¡Œå®‰è£…è„šæœ¬ è¿›å…¥ onpremise ç›®å½•æ‰§è¡Œè„šæœ¬ï¼š $ cd onpremise $ ./install.sh è¿™ä¸ªè¿‡ç¨‹ç¨å¾®æœ‰ç‚¹æ…¢ï¼Œå®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºä½ åˆ›å»ºç®¡ç†è€…ï¼ˆadmin/ownerï¼‰çš„è´¦å·å’Œå¯†ç ï¼Œè¯·æ³¨æ„ç•™æ„ï¼ŒæŒ‰ç…§æç¤ºè¾“å…¥å³å¯ã€‚ 3. è®¾ç½®é‚®ä»¶ç­‰é…ç½® è¿™ä¸€æ­¥éª¤æ˜¯éå¿…é¡»çš„ï¼Œå¯åŠ¨æ—¶ä¼šæœ‰ä¸€ä¸ªé…ç½®çš„é¡µé¢ï¼Œåˆ°æ—¶å€™å†æ ¹æ®æç¤ºå¡«å†™ä¹Ÿæ˜¯å¯ä»¥çš„ é…ç½®æ–‡ä»¶ä¸º sentry/config.ymlï¼Œéœ€è¦è®¾ç½®é‚®ä»¶ã€åŸŸåç­‰ï¼Œå…·ä½“é…ç½®å¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£ã€‚ å¯åŠ¨æœåŠ¡ å®‰è£…å®Œæˆåå¯åŠ¨æœåŠ¡: $ docker-compose up -d ç„¶åè®¿é—® http://localhost:9000ï¼Œä½¿ç”¨åˆšåˆšåˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•ã€‚ ç™»å½•ä¹‹åä¼šæœ‰ä¸€ä¸ªè®¾ç½®é¡µé¢è¾“å…¥å¿…éœ€çš„é…ç½®ï¼Œéœ€è¦ä½ è¾“å…¥ä¸€äº›å¿…éœ€çš„é…ç½®ï¼Œå¦‚ Root URLã€ SMTP æœåŠ¡å™¨ç­‰ï¼Œå…·ä½“é…ç½®å‚æ•°çš„æ„æ€å¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£ã€‚ å¦‚æœä½ åœ¨ä¸Šé¢çš„ç¬¬ 3 æ­¥å·²ç»åœ¨ sentry/config.yml ä¸­é…ç½®äº†ç›¸å…³çš„å‚æ•°ï¼Œè¿™é‡Œå°±æ²¡æœ‰ç›¸åº”çš„é€‰é¡¹äº†ã€‚æ¯”å¦‚ä½ å·²ç»é…ç½®äº† system.url-prefixï¼ˆéƒ¨ç½²æœåŠ¡çš„åŸŸåï¼‰ é‚£ä¹ˆè¿™é‡Œå°±æ²¡æœ‰ç¬¬ä¸€é¡¹ Root URL è¾“å…¥é¡¹äº†ã€‚ æµ‹è¯•/ä¿®æ”¹é…ç½® ä¸ºä¿è¯é‚®ç®±ï¼ˆSMTP æœåŠ¡å™¨ï¼‰é…ç½®æ­£ç¡®ï¼Œæœ€å¥½æµ‹è¯•ä¸€ä¸‹ï¼Œè¿›å…¥ admin -&amp;gt; Mail å‘é€ä¸€å°æµ‹è¯•é‚®ä»¶çœ‹çœ‹: æµ‹è¯• SMTP é…ç½® -- å¦‚æœä½ æƒ³æ›´æ”¹é…ç½®ï¼Œä¸Šå›¾ç›®å½•è§†å›¾ä¸‹ç‚¹å‡» Settings ä¿®æ”¹å³å¯ï¼Œä¿®æ”¹å®Œæˆååˆ«å¿˜è®°é‡å¯å“¦: $ docker-compose down &amp;amp;&amp;amp; docker-compose up -d æ¥å…¥ Sentry å®‰è£…å¹¶éƒ¨ç½²å¥½ sentry æœåŠ¡åï¼Œå°±å¯ä»¥ä¸ºä½ çš„æœåŠ¡åˆ›å»ºä¸€ä¸ª projectï¼Œé€‰æ‹©ä½ çš„è¯­è¨€æˆ–è€…æ¡†æ¶: æ¥ç€åœ¨ä½ çš„æœåŠ¡é¡¹ç›®ä¸­æ¥å…¥ sentry å³å¯: å…·ä½“è¯­è¨€æˆ–æ¡†æ¶çš„æ¥å…¥æ–‡æ¡£å‚è§å®˜æ–¹æ¥å…¥æ–‡æ¡£ã€‚ é—®é¢˜ 1. æ­£å¸¸æƒ…å†µä¸‹å®‰è£…è¿‡ç¨‹ä¸­æ˜¯ä¼šå‡ºç°è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç çš„æ­¥éª¤çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ›å»º admin è´¦æˆ·ï¼Œå¯ä»¥æ‰§è¡Œï¼š $ docker-compose run --rm web createuser å…·ä½“å¯ä»¥æŸ¥é˜…è¿™ä¸ª issueã€‚ æš‚æ—¶æ²¡é‡åˆ°å…¶ä»–é—®é¢˜ï¼Œå¦‚æœæ‚¨é‡åˆ°äº†æ¬¢è¿ç•™è¨€ï¼Œä¸€èµ·æ¢è®¨ï¼Œå†è¡¥å……ã€‚</description>
    </item>
    
    <item>
      <title>åœ¨ tmux ç¯å¢ƒä¸­ä½¿ç”¨ tmux-256color</title>
      <link>https://at7h.com/posts/install-tmux256-formac/</link>
      <pubDate>Mon, 11 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/install-tmux256-formac/</guid>
      <description>åœ¨ macOS ä¸­ï¼Œæˆ‘ä»¬ iTerm2 ä¸­çš„ terminal color ä¸€èˆ¬éƒ½è®¾ç½®ä¸º xterm-256colorï¼Œè¿™æ²¡æ¯›ç—…ï¼Œä½†é—®é¢˜æ˜¯å®ƒä¸èƒ½åœ¨ tmux ç¯å¢ƒä¸­ä½¿ç”¨: $TERM should be &amp;quot;screen-256color&amp;quot; or &amp;quot;tmux-256color&amp;quot; in tmux. Colors might look wrong. ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ zshrc ä¸­åŠ ä¸Šè¿™æ ·ä¸€æ®µé…ç½®ï¼š if [[ $TMUX != &amp;#34;&amp;#34; ]] then export TERM=&amp;#34;tmux-256color&amp;#34; else export TERM=&amp;#34;xterm-256color&amp;#34; fi è€Œåœ¨ tmux ç¯å¢ƒä¸­ä¸€èˆ¬é»˜è®¤ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ screen-256colorï¼Œè¿™åœ¨å¤§å¤šæ•°æƒ…å†µæ˜¯å¤Ÿç”¨çš„ï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒä»»ä½•æ–œä½“å­—ä½“æ ·å¼ï¼Œæ‰€ä»¥åœ¨ Vim ä¸­ç±»ä¼¼ä»£ç é«˜äº®è¿™ç§å°±ä¼šå¾ˆæœ‰é—®é¢˜ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ tmux.conf ä¸­åŠ ä¸Šè®¾ç½®ï¼š set -g default-terminal &amp;#34;tmux-256color&amp;#34; set-option -a terminal-overrides &amp;#34;,*256col*:RGB&amp;#34; æ–°å»ºä¸€ä¸ª session æµ‹è¯•ä¸€ä¸‹ï¼š tnew test # tmux new -s test å‘ç°æŠ¥é”™: can&#39;t find terminal definition for tmux-256colorã€‚ åŸå› æ˜¯ç³»ç»Ÿé»˜è®¤æ˜¯æ²¡æœ‰ tmux-256color çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ï¼ŒåŠ ä¸Šç›¸åº”çš„ terminfo å°±å¯ä»¥äº†ã€‚ tmux-256color è¯¦ç»†å®‰è£…æ•™ç¨‹ï¼šInstalling tmux-256color for macOS æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒæˆ‘çš„é…ç½®ï¼Œæ¬¢è¿å¤§å®¶è¯„è®ºç•™è¨€ï¼Œä¸æˆ‘äº¤æµã€‚</description>
    </item>
    
    <item>
      <title>Mac ç¥å™¨ Karabiner-Elements æ¨è</title>
      <link>https://at7h.com/posts/karabiner/</link>
      <pubDate>Wed, 06 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/karabiner/</guid>
      <description>ä»Šå¤©ç»™å¤§å®¶æ¨èä¸€æ¬¾ Mac ä¸‹çš„é”®ç›˜é”®ä½å®šåˆ¶åŒ–ç¥å™¨ Karabiner-Elementsï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å°½æƒ…éšæ„çš„ä¿®æ”¹ä½ çš„é”®ä½è®¾ç½®ã€‚ å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œé”®ç›˜ âŒ¨ï¸ å¯è°“æ˜¯æœ€äº²è¿‘çš„ä¸œè¥¿äº†ï¼Œæ¯•ç«Ÿæ¯å¤©æ‘¸çš„æœ€å¤šçš„å°±æ˜¯å®ƒ ğŸŒï¼Œå¾ˆå¤šåŒå­¦éƒ½ä¼šå°è¯•æ ¹æ®è‡ªå·±çš„ä½¿ç”¨ä¹ æƒ¯æ¥æ›´æ”¹é”®ä½ï¼Œä»¥æé«˜è¾“å…¥ä½“éªŒã€‚ æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢å°é”®ç›˜ï¼Œä¹‹å‰ä½¿ç”¨ poker2 æ—¶å°±é€šè¿‡ Mac ç³»ç»Ÿè‡ªå¸¦çš„ã€Œä¿®é¥°é”®æ›´æ”¹ã€åŠŸèƒ½å°†å¤§å†™é”å®šé”®æ”¹æˆäº† Controlï¼Œå› ä¸ºå¤§å†™é”å®šé”®å‡ ä¹æ²¡ä»€ä¹ˆç”¨ï¼Œåè€Œå æ®äº†ä¸€ä¸ªç»å¥½çš„ä½ç½®ã€‚ è¿‘æœŸå…¥æ‰‹äº† hhkbï¼Œå”¯ä¸€ç¾ä¸­ä¸è¶³çš„æ˜¯å®ƒçš„æ–¹å‘é”®æœ‰ç‚¹é¸¡è‚‹ï¼Œè™½ç„¶æˆ‘æ˜¯ vim ç”¨æˆ·ï¼Œå¯¹æ–¹å‘é”®çš„ä¾èµ–æ¯”è¾ƒå°ä¸€äº›ï¼Œä½†è¿˜æ˜¯æ„Ÿè§‰ä¸å¤ªæ–¹ä¾¿ã€‚ä¸€é€šæœç´¢ï¼Œå‘ç°äº†ä¸€æ¬¾ Mac ä¸‹çš„é”®ä½å®šåˆ¶åŒ–ç¥å™¨ Karabiner-Elementsã€‚å°†æ–¹å‘é”®æ”¹ä¸º command+hjklï¼Œå°±ç›´æ¥èµ·é£ ğŸ˜ã€‚ ä½ å¯ä»¥æ ¹æ®éœ€è¦æ›´æ¢ä»»ä½•é”®ä½: æç¤ºï¼š å¦‚æœä½ ä¸æ¸…æ¥šä½ è¦ä¿®æ”¹çš„é”®å«ä»€ä¹ˆåå­—ï¼Œå¯ä»¥ä½¿ç”¨å®ƒè‡ªå¸¦çš„ Karabiner-EventViewer æ¥æŸ¥çœ‹ã€‚ å¦‚ä¸‹å›¾ï¼Œä½ ä¹Ÿå¯ä»¥æ·»åŠ åˆ«äººé…ç½®å¥½çš„ Rule Modeï¼Œç‚¹å‡» ã€Add ruleã€å³å¯é€‰æ‹©ï¼š æ²¡æœ‰æƒ³è¦çš„ï¼Ÿè¯•è¯• ã€Import more &amp;hellip;ã€å§ï¼š ç°åœ¨å¾ˆå¤šé”®ç›˜éƒ½ä¼šæœ‰ä¸€äº›å†…ç½®ä¸€äº›é”®ä½æ›´æ”¹çš„é€‰é¡¹ï¼Œå¦‚ pokerï¼Œhhkb ç­‰ï¼Œä½†æ”¯æŒå¾ˆæœ‰é™ã€‚å¦‚æœä½ æƒ³è‡ªå®šä¹‰é”®ä½ï¼Œé‚£ä¹ˆ Karabiner-Elements å¯ä»¥æ»¡è¶³ä½ çš„ä»»ä½•éœ€æ±‚ã€‚ å…³äºä¸‹è½½å®‰è£…å’Œä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</description>
    </item>
    
    <item>
      <title>Chrome ç½‘é¡µæˆªå›¾å°æŠ€å·§</title>
      <link>https://at7h.com/posts/screenshot/</link>
      <pubDate>Wed, 25 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://at7h.com/posts/screenshot/</guid>
      <description>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æœ‰ç½‘é¡µæˆªå›¾çš„éœ€æ±‚ï¼Œè€Œé€šå¸¸æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ç³»ç»Ÿæˆªå›¾å·¥å…·ï¼Œæˆ–æ˜¯é€šè¿‡ QQã€å¾®ä¿¡ç­‰ç¬¬ä¸‰æ–¹è½¯ä»¶çš„æˆªå›¾åŠŸèƒ½æ¥å®Œæˆã€‚è€Œæœ‰æ—¶å€™ï¼Œéœ€è¦æˆªå–æ•´ä¸ªç½‘é¡µï¼Œå¯¹äºé‚£äº›æœ‰æ»šåŠ¨æ¡çš„é¡µé¢æ¥è¯´ï¼Œä¸Šè¿°çš„æˆªå›¾å·¥å…·åªèƒ½æˆªå–å½“å‰å±å¹•æ˜¾ç¤ºçš„é¡µé¢ï¼Œå¹¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚è¿™ä¸ªæ—¶å€™ä½ å¯èƒ½æƒ³å€ŸåŠ©ä¸€äº›å·¥å…·æ’ä»¶æ¥å®Œæˆï¼Œä½†å…¶å® Chrome å¼€å‘è€…å·¥å…·ä¸­å·²ç»è‡ªå¸¦äº†æˆªå›¾å‘½ä»¤ï¼Œä¸ªäººè§‰å¾—æ•ˆæœä¹Ÿä»¤äººæ»¡æ„ã€‚ æ‰€ä»¥ï¼Œä¸‹é¢å°±æ¥ä»‹ç»ä¸‹ Chrome å¼€å‘è€…å·¥å…·æˆªå›¾å‘½ä»¤çš„ä½¿ç”¨(mac)ï¼š æç¤ºï¼šåœ¨æ­¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿ Chrome å·²å‡çº§è‡³ 59 æˆ–æ›´é«˜ç‰ˆæœ¬ 1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼šåœ¨ä½ æƒ³è¦æˆªå›¾çš„ç½‘é¡µä¸Šï¼ŒæŒ‰ä¸‹ F12 æˆ– âŒ˜Command + âŒ¥Option + jï¼Œä¹Ÿæˆ–è€…å³é”®ç„¶åé€‰æ‹©ã€Œæ£€æŸ¥ã€ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚ 2. è¾“å…¥æˆªå›¾å‘½ä»¤ï¼šéšåï¼ŒæŒ‰ âŒ˜Command + â‡§Shift + P è°ƒå‡ºå‘½ä»¤è¾“å…¥æ¡†ï¼Œç„¶åè¾“å…¥ Capture full size screenshotï¼ˆåªè¾“å‰å‡ ä¸ªå­—æ¯å°±èƒ½æ‰¾åˆ°ï¼‰ï¼Œæ‰¾åˆ°å¯¹åº”åé¡¹ç„¶åå›è½¦å³å¯ã€‚ é™¤äº†æ•´ä¸ªç½‘é¡µé•¿æˆªå›¾ä»¥å¤–ï¼Œå¦‚æœä½ æƒ³å‡†ç¡®æˆªå–ç½‘é¡µçš„æŸä¸€éƒ¨åˆ†ï¼Œæ²¡é—®é¢˜ï¼æŒ‰ âŒ˜Command + â‡§Shift + C å—…æ¢å…ƒç´ ï¼ˆå³ä¸Šå›¾ä¸­çº¢è‰²æ¡†ä¸­çš„é‚£ä¸ªå°ç®­å¤´ï¼‰ï¼Œé€‰ä¸­æƒ³è¦çš„éƒ¨åˆ†åï¼Œå†è¿è¡Œåˆšæ‰çš„å‘½ä»¤ï¼Œå°±å¯ä»¥äº†ã€‚ æœ€åï¼Œä½ è¿˜å¯ä»¥è¿›å…¥ç§»åŠ¨è®¾å¤‡æ¨¡æ‹Ÿçš„æ¨¡å¼ä¸‹è·å–æ‰‹æœºæˆ–è€…å¹³æ¿çš„æˆªå›¾ï¼ŒæŒ‰ âŒ˜Command + â‡§Shift + M(å³ä¸Šå›¾ä¸­çº¢è‰²æ¡†ä¸­çš„é‚£ä¸ªæ‰‹æœºçš„æ ‡è¯†)ï¼Œç„¶åè¿è¡Œåˆšæ‰çš„å‘½ä»¤å°±å¯ä»¥å•¦ï¼Œåœ¨é¡¶éƒ¨çš„å·¥å…·æ ä¸­ï¼Œä½ è¿˜å¯ä»¥é€‰æ‹©è¦æ¨¡æ‹Ÿçš„è®¾å¤‡å’Œåˆ†è¾¨ç‡ç­‰ã€‚</description>
    </item>
    
  </channel>
</rss>